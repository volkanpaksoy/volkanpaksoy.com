<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/page/13/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996"
  crossorigin="anonymous"></script>

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-35583486-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@volkan_paksoy">
  <meta name="twitter:creator" content="@Volkan Paksoy">
  <meta name="twitter:title"   content="">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary">
  <meta name="twitter:image" content=""> -->
  
  <!-- end of Twitter cards -->


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
<br>
<br>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
<!-- vp.com - default -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5266062674794996" data-ad-slot="6750480330" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">



    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2018/07/28/Setting-up-RAID1-in-Ubuntu-18.04-and-Monitoring-Disk-Health/" itemprop="url">Setting up RAID1 in Ubuntu 18.04 and Monitoring Disk Health</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2018-07-28T07:00:00+01:00" itemprop="datePublished">July 28, 2018</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/linuxsysops">linux</a></span> -->

<!-- linux, sysops -->




    <a href="/category/linux">linux</a>
    , 

    <a href="/category/sysops">sysops</a>
    
</span>
	<span class="tags">raid</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p><img src="/images/vpblogimg/2018/07/linux-raid1-01-tux.svg" alt=""></p>

<p>AWS and cloud computing are awesome but I still enjoy having a server at home. I’ve decided to reinstate my old desktop. Replaced the disks with shiny new ones (A 500GB SSD and 2 4TB drives for data) and installed Ubuntu 18.04.</p>

<p>My primary goals were:</p>

<ul>
  <li>Partition SSD drive and use it for data that needs performance</li>
  <li>Set up RAID1 on 2 4TB disks so that 1 disk failure wouldn’t result in data loss</li>
  <li>Set up some sort of notifications to monitor SSD disk health</li>
  <li>Set up some sort of notifications to monitor RAID disk health</li>
</ul>

<p>Having all these in place was important for me to have a solid, reliable system before I started building stuff on top of it.</p>

<h2 id="partitioning">Partitioning</h2>

<p>By default Ubuntu only adds a 512MB /boot/efi partition and leaves the rest for root (/). But since I recently had some free space issues in the boot drive recently I decided to create a boot partition as well. Also added a 32GB Swap partition. Swap is is virtual memory and it should have the same size as the computer’s memory.</p>

<p>So I ended up allocating 32GB for home as well and left the rest for the root. Going forward now I have more than 300GB to use for application data, Docker images etc.</p>

<p><img src="/images/vpblogimg/2018/07/linux-raid1-02-partitions.png" alt=""></p>

<h2 id="raid1">RAID1</h2>
<p>Now it’s time to set up a RAID array to have some redundancy. They are shiny new disks but you can never fully rely on them and they will eventually fail. Probably it’s not the best idea to install 2 identical disks at the same time as their lifecycle will likely end at similar times. So I’ll need to keep an eye on them and set up some monitoring and notifications (more on that later).</p>

<p>As my guide I started using this article called <a href="https://www.tecmint.com/create-raid1-in-linux/" target="_blank" rel="noopener noreferrer">Setting up RAID 1 (Mirroring) using ‘Two Disks’ in Linux – Part 3</a> to set up my RAID.</p>

<p>This is a very nice article and explains everything step by step already so I’m not going to duplicate it here. But I bumped into an issue while following the guide: 4TB drives. My disks were MBR which only supported up to 2TB and I had to convert them into GPT disks.</p>

<p>The answer was <strong>parted</strong>. I followed the steps in this <a href="https://askubuntu.com/a/586721" target="_blank" rel="noopener noreferrer">answer</a> and managed to partition the drives to 4TB (3.7 to be exact!)</p>

<h2 id="testing-raid1">Testing RAID1</h2>

<p>Now that I had a RAID it was time to go out and test it. First thing I wanted to see was it mounted automatically after a reboot. It did mount the drives but there was a problem with RAID. At boot the device was showing as md127 instead of md0 and it was failing to sync.</p>

<p>My mdadm.conf file looked like this when this was happening:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ARRAY /dev/md0 level=raid1 num-devices=2 metadata=1.2 name=asgard:0 UUID={device id}
   devices=/dev/sda1,/dev/sdb1
</code></pre></div></div>

<p>After some Googling I found the answere <a href="https://ubuntuforums.org/showthread.php?t=1764861" target="_blank" rel="noopener noreferrer">here</a></p>

<p>The solution was simply removing the name parameter from the file!. After that, when I rebooted and entered the following commands I was able to see a healthy RAID:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /proc/mdstat
</code></pre></div></div>

<p><img src="/images/vpblogimg/2018/07/linux-raid1-03-mdadm-stat.png" alt=""></p>

<p>and</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mdadm -D /dev/md0
</code></pre></div></div>

<p><img src="/images/vpblogimg/2018/07/linux-raid1-04-mdadm-status.png" alt=""></p>

<h2 id="monitoring-system-disk-with-smartmontols">Monitoring System Disk with smartmontols</h2>
<p>Now that everything looked in place, I needed to ensure it stays that way!</p>

<p>To achieve that goal, I edited this file /etc/smartd.conf and added this line:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DEVICESCAN -o on -H -l error -l selftest -t -m my.email@address.com -M test
</code></pre></div></div>

<h3 id="set-up-sending-emails-from-server">Set up sending emails from server</h3>
<p>When I first installed smartmontools, it asked Postfix configuration which looks like this:</p>

<p><img src="/images/vpblogimg/2018/07/linux-raid1-05-postfix-configuration.png" alt=""></p>

<p>Since I was interested in getting results fast, I selected No Configuration and moved on. Now it’s time to configure it.</p>

<p>To bring up this screen again I entered the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dpkg-reconfigure postfix
</code></pre></div></div>

<p>I followed the wizard, entered my email domain. Then followed this documentation from AWS: <a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/postfix.html" target="_blank" rel="noopener noreferrer">Integrating Amazon SES with Postfix</a></p>

<p>As always, I ended up having some issues :-).</p>

<p>First problem was it didn’t work! It wasn’t finding the SES SMTP server as relay server and was always trying to send emails from localhost. The solution was <a href="https://devanswers.co/postfix-statusbounced-unknown-user-user/" target="_blank" rel="noopener noreferrer">here</a></p>

<p>As the instructions say, I updated /etc/postfix/main.cf with the values below:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>myhostname = localhost
mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
</code></pre></div></div>

<p>and I was able to send emails to the SMTP server. But the SES didn’t like my IP address and the email bounced. The solution to that was to create an IP filter in SES and allow the traffic from that address.</p>

<p><img src="/images/vpblogimg/2018/07/linux-raid1-06-aws-ses-create-filter.png" alt=""></p>

<p>Then I restarted the service to test</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>service smartmontools restart
</code></pre></div></div>

<p>and received the notification. Actually received 3 emails for some reason.</p>

<p><img src="/images/vpblogimg/2018/07/linux-raid1-07-aws-ses-notifications.png" alt=""></p>

<p>The service runs at startup so this way I can be notified whenever it reboots too.</p>

<h2 id="monitoring-raid-with-mdadm">Monitoring RAID with mdadm</h2>

<p>Took some time to complete synchronizing 4TB disks but finally I was ready to rock:</p>

<p><img src="/images/vpblogimg/2018/07/linux-raid1-08-mdadm-status-complete.png" alt=""></p>

<p>Apart from smartmontools, mdadm application is also capable of sending emails when a disk fails.</p>

<p>The documentation tells to add MAILADDR followed by an email address to specify target email address but in my tests adding the line didn’t change anything.</p>

<p>In fact, turns out by default it’s sending the notifications. As my server was set up to send emails now, by just entering the following command to send out a test email I was able to receive it</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mdadm --monitor --scan --test -1
</code></pre></div></div>

<p>The problem is it’s now using root@mydomain.com all the time now. I wasn’t able to change it. But as long as that mailbox exists at least I can receive notifications.</p>

<h2 id="conclusion">Conclusion</h2>
<p>All hardware eventually fails. Disk failure is especially annoying because it may cause some precious data loss. Apart from good backup practices, it’s also helpful to have a good monitoring system and redundancy on the disks we use.</p>

<p>It took me some time to set up my system but now at least I have 1 disk redundancy for large amounts of data and the ability to be notified whenever something goes wrong with the disks which gives me some peace of mind (not too much though :-)).</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://www.tecmint.com/create-raid1-in-linux/" target="_blank" rel="noopener noreferrer">Setting up RAID 1 (Mirroring) using ‘Two Disks’ in Linux – Part 3</a></li>
  <li><a href="https://askubuntu.com/a/586721" target="_blank" rel="noopener noreferrer">Create GUID partition table (GPT) during Ubuntu Server install</a></li>
  <li><a href="https://ubuntuforums.org/showthread.php?t=1764861" target="_blank" rel="noopener noreferrer">RAID starting at md127 instead of md0</a></li>
  <li><a href="https://dustymabe.com/2012/03/10/hard-drive-monitoring-and-e-mail-alerts-using-smartd/" target="_blank" rel="noopener noreferrer">Hard Drive Monitoring and E-mail Alerts Using smartd</a></li>
  <li><a href="https://help.ubuntu.com/community/Smartmontools" target="_blank" rel="noopener noreferrer">Smartmontools documentation</a></li>
  <li><a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/postfix.html" target="_blank" rel="noopener noreferrer">Integrating Amazon SES with Postfix</a></li>
  <li><a href="https://devanswers.co/postfix-statusbounced-unknown-user-user/" target="_blank" rel="noopener noreferrer">Can’t send mail to own domain. Postfix: status=bounced (unknown user: “user”)</a></li>
  <li><a href="https://www.systutorials.com/docs/linux/man/5-mdadm.conf/" target="_blank" rel="noopener noreferrer">mdadm.conf (5) - Linux Man Pages</a></li>
</ul>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2018/07/21/Row-Against-the-Machine-Getting-Rowing-Data-Out-of-Concept2-Model-D/" itemprop="url">Row Against the Machine: Getting Rowing Data Out of Concept2 Model D</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2018-07-21T07:00:00+01:00" itemprop="datePublished">July 21, 2018</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/hobby">hobby</a></span> -->

<!-- hobby -->




    <a href="/category/hobby">hobby</a>
    
</span>
	<span class="tags">fitness, concept2, rowing</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>I’ve been using a Concept2 Model D rowing machine for some time now and quite enjoying it as a form of workout. (Primarily because I can still watch Netflix or Youtube while rowing!)</p>

<p><img src="/images/vpblogimg/2018/07/concept2-model-c.jpg" alt="Concept2 Model C Rowing Machine"></p>

<p>Since I have some data accumulated in it I decided to have a look into ways of getting it and working on it hoping that it give me some insights about possible ways of improving my stats.</p>

<h2 id="official-tools">Official Tools</h2>
<p>To be honest the existing toolset that comes out of the box is quite sufficient.</p>

<h3 id="logbook">LogBook</h3>
<p>This is the official web application where you can monitor your workouts.</p>

<p><img src="/images/vpblogimg/2018/07/concept2-logbook.png" alt="Concept LogBook"></p>

<p>This application is quite good really. You can manually enter your workouts, view the existing history. Create teams and participate in challenges so there’s also a social aspect to it.</p>

<h3 id="ios-app-ergdata">iOS App: ErgData</h3>
<p>The monitor connected to the rowing machine (Performance Monitor - PM5) supports Bluetooth connection which can be easily paired with an iPhone. If you install ErgData app on your phone you can sync the device with your phone  and get them out that way very easily. Better yet, it allows you to upload your workouts to LogBook. After you complete a workout, you can easily upload the results by clicking Sync.</p>

<p><img src="/images/vpblogimg/2018/07/concept2-ergdata.jpeg" alt="Concept2 ErgData app"></p>

<h2 id="unofficial-tools">Unofficial Tools</h2>

<h3 id="raspirowing">RasPiRowing</h3>
<p>I found this nice Raspberry Pi based project called <a href="https://raspirowing.com/" target="_blank" rel="noopener noreferrer">RasPiRowing</a> developed one of the staff members of Concept.</p>

<p>Since I’m a fan of Raspberry Pi have a whole bunch of them lyting around, it didn’t take me long to install it and use it. It works just fine and comes with a fun fish game too:</p>

<p><img src="/images/vpblogimg/2018/07/concept2-fish-pi-game.jpg" alt="FishPi Game"></p>

<p>It’s a nice way of interacting with the Concept2. Since it can be accessed by a Python application I can build my own applications as well to get data out of the erg.</p>

<h2 id="developer-tools">Developer Tools</h2>

<h3 id="sdk">SDK</h3>
<p>There is an <a href="http://www.concept2.co.uk/service/software/software-development-kit" target="_blank" rel="noopener noreferrer">SDK</a> available to download for both Mac and Windows.</p>

<p>I installed the Mac version which extracts the files under /Users/{username}/C2 PM SDK/</p>

<p>But I couldn’t find much useful stuff in there:</p>

<p><img src="/images/vpblogimg/2018/07/concept2-sdk.png" alt="SDK contents"></p>

<p>Tried to build the XCode project but gave a build error and I just left it at that.</p>

<h3 id="api">API</h3>
<p>They also provide an API wich can be used to get the data out. This sounds the most interesting part to me as I can develop my own custom tools based on this API.</p>

<p>In the documentation, they advise to use the dev site first while trying out the API and then request using the live data. Also you need to register your application with Concept2 to be able to use their APIs.</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://log.concept2.com/login" target="_blank" rel="noopener noreferrer">Concept2 Logbook</a></li>
  <li><a href="http://www.concept2.co.uk/service/software/software-development-kit" target="_blank" rel="noopener noreferrer">Concept2 SDK</a></li>
  <li><a href="http://log.concept2.com/developers/documentation/" target="_blank" rel="noopener noreferrer">Logbook API Documentation</a></li>
  <li><a href="https://raspirowing.com/" target="_blank" rel="noopener noreferrer">RasPiRowing</a></li>
</ul>


		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2018/07/20/Verifying-Data-Integrity-with-AWS-S3/" itemprop="url">Verifying Data Integrity with AWS S3</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2018-07-20T06:00:00+01:00" itemprop="datePublished">July 20, 2018</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/devaws">dev</a></span> -->

<!-- dev, aws -->




    <a href="/category/dev">dev</a>
    , 

    <a href="/category/aws">aws</a>
    
</span>
	<span class="tags">s3, csharp</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>When it comes to transferring files over network, there’s always a risk of ending up with corrupted files. To prevent this on transfers to and from S3, AWS provides us with some tools we can leverage to guarantee correctness of the files.</p>

<h2 id="verifying-files-while-uploading">Verifying files while uploading</h2>

<p>In order to verify the file is uploaded successfully, we need to provide AWS the MD5 hash value of our file. Once upload has been completed, AWS calculates the MD5 hash on their end and compares the both values. If they match, it means it went through successfully. So our request looks like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PutObjectRequest</span>
<span class="p">{</span>
    <span class="n">MD5Digest</span> <span class="p">=</span> <span class="n">md5</span><span class="p">,</span>
    <span class="n">BucketName</span> <span class="p">=</span> <span class="n">bucketName</span><span class="p">,</span>
    <span class="n">Key</span> <span class="p">=</span>  <span class="n">key</span><span class="p">,</span>
    <span class="n">FilePath</span> <span class="p">=</span> <span class="n">inputPath</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div></div>

<p>where we calculate MD5 hash value like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FileStream</span><span class="p">(</span><span class="n">fullPath</span><span class="p">,</span> <span class="n">FileMode</span><span class="p">.</span><span class="n">Open</span><span class="p">,</span> <span class="n">FileAccess</span><span class="p">.</span><span class="n">Read</span><span class="p">,</span> <span class="n">FileShare</span><span class="p">.</span><span class="n">Read</span><span class="p">))</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">md5</span> <span class="p">=</span> <span class="n">MD5</span><span class="p">.</span><span class="nf">Create</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">hash</span> <span class="p">=</span> <span class="n">md5</span><span class="p">.</span><span class="nf">ComputeHash</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToBase64String</span><span class="p">(</span><span class="n">hash</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In my tests, it looks like if you don’t provide a valid MD5 hash, you get a <em>WinHttpException</em> with the inner exception message “The connection with the server was terminated abnormally”</p>

<p>If you provide a valid but incorrect MD5, the exception thrown is of type <em>AmazonS3Exception</em> with the message “The Content-MD5 you specified did not match what we received”.</p>

<p>Amazon SDK comes with 2 utility methods named <em>GenerateChecksumForContent</em> and <em>GenerateChecksumForStream</em>. At the time of this writing, GenerateChecksumForStream wasn’t available in the AWS SDK for .NET Core. So the only method worked for me to calculate the hash was the way as shown above.</p>

<h2 id="verifying-files-while-downloading">Verifying files while downloading</h2>

<p>When downloading we use EtagToMatch property of GetObjectRequest to have the verification:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="n">GetObjectRequest</span>
<span class="p">{</span>
	<span class="n">BucketName</span> <span class="p">=</span> <span class="n">bucketName</span><span class="p">,</span>
    <span class="n">Key</span> <span class="p">=</span>  <span class="n">key</span><span class="p">,</span>
    <span class="n">EtagToMatch</span> <span class="p">=</span> <span class="s">"\"278D8FD9F7516B4CA5D7D291DB04FB20\""</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">()</span> <span class="c1">// Case-sensitive</span>
<span class="p">};</span>

<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_s3Client</span><span class="p">.</span><span class="nf">GetObjectAsync</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
<span class="p">{</span>
    <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="nf">WriteResponseStreamToFileAsync</span><span class="p">(</span><span class="n">outputPath</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="n">CancellationToken</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>When we request the object this way and if the the MD5 hash we send doesn’t match the one on the server we get an exception with the following message: <em>“At least one of the pre-conditions you specified did not hold”</em></p>

<p>Once important point to keep in mind is that AWS keeps the hashes in lowerc-ase and the comparison is case-sensitive so make sure to convert everything to lower-case before you send it out.</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://github.com/volkanpaksoy/lab/tree/master/blog/VerifyingDataIntegrityWithAWSS3" target="_blank" rel="noopener noreferrer">Sample source code</a></li>
  <li><a href="https://aws.amazon.com/premiumsupport/knowledge-center/data-integrity-s3/" target="_blank" rel="noopener noreferrer">How do I ensure data integrity of objects uploaded to or downloaded from Amazon S3?</a></li>
  <li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/get-filehash?view=powershell-6" target="_blank" rel="noopener noreferrer">Powershell Get-FileHash cmdlet reference</a></li>
  <li><a href="https://docs.aws.amazon.com/cli/latest/topic/s3-faq.html" target="_blank" rel="noopener noreferrer">AWS CLI S3 FAQ</a></li>
</ul>


		
		
	</div>


    </article>


</div>
<nav id="pagenavi">
    
        <a href="/page/12" class="prev">Prev</a>
    
    
        <a href="/page/14" class="next">Next</a>
    
    <div class="center"><a href="/archive">Blog Archives</a></div>
</nav>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright © 2021 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>

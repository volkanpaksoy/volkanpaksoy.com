<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/page/8/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996"
  crossorigin="anonymous"></script>

  

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y3V7V2XX9Q"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y3V7V2XX9Q');
</script>

<!-- <script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'G-Y3V7V2XX9Q']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script> -->



  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@volkan_paksoy">
  <meta name="twitter:creator" content="@Volkan Paksoy">
  <meta name="twitter:title"   content="">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary">
  <meta name="twitter:image" content=""> -->
  
  <!-- end of Twitter cards -->


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
<br>
<br>

<!-- <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="volkanpaksoy" data-color="#005050" data-emoji=""  data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#ffffff" data-font-color="#ffffff" data-coffee-color="#FFDD00" ></script> -->

<a href="https://www.buymeacoffee.com/volkanpaksoy" target="_blank" rel="noopener noreferrer"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-green.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a>

<div id="ezoic-pub-ad-placeholder-102">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
<!-- ezoic-00 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5266062674794996" data-ad-slot="4902272427" data-ad-format="auto"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">



    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2019/06/10/Docker-in-Depth/" itemprop="url">Docker in Depth</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2019-06-10T07:00:00+01:00" itemprop="datePublished">June 10, 2019</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/dockerdevops">docker</a></span> -->

<!-- docker, devops -->




    <a href="/category/docker">docker</a>
    , 

    <a href="/category/devops">devops</a>
    
</span>
	<span class="tags"></span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>In this post I’d like to cover a wider variery of Docker commands and features. My goal is to be able to use it as a quick reference while working with Docker without duplicating the official documentation. It consists of the notes I took at various times.</p>

<h2 id="docker-commands">Docker commands</h2>

<ul>
  <li>
<strong>docker ps</strong>: Shows the list of running containers</li>
  <li>
<strong>docker ps -a</strong>: Shows all containers including the stopped ones</li>
  <li>
<strong>docker images</strong>: Shows the list of local images</li>
  <li>
    <p><strong>docker inspect {container id}</strong>: Gets information about the container. It can be filtered by providing –format flag.</p>

    <p>Example:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>    Command: docker inspect --format="{{ .Image }}" abcdabcdabcd
	
  Output: sha256:abcdabcdabcdabcdabcdabcd.....
</code></pre></div>    </div>

    <p>The data is in JSON format so it can be filtered by piping to <a href="https://stedolan.github.io/jq/" target="_blank" rel="noopener noreferrer">jq</a>.</p>

    <p>Example:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker inspect 7c1297c30159 | jq -r '.[0].Path'
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>docker rm {container id or name}</strong>: Deletes the container</p>

    <p>run command accepts –rm parameter which deletes the container right after it finishes.</p>

    <p>To delete all the containers the following command can be used:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker rm $(docker ps -aq) 
</code></pre></div>    </div>

    <p>where docker ps -aq only returns the container ids.</p>
  </li>
  <li>
    <p><strong>docker rmi {image id or name}</strong>: Seletes the image (provided that there are no containers created off that image)</p>

    <p>To delete all images the following command can be used:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker rmi $(docker images -q)
</code></pre></div>    </div>

    <p>This command is equivalent of</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker image rm {image name or id}
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>docker build</strong>: Creates a new image from Dockerfile</p>

    <p>It is equivalent of</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker image build ...
</code></pre></div>    </div>

    <p>It can be used to build images straight from GitHub:</p>

    <p>Example:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker build https://github.com/docker/rootfs.git#container:docker
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>docker history {image name}</strong>: Shows the history of an image</p>
  </li>
  <li>
    <p><strong>docker run -it {image name} bash</strong>: Runs a container in interactive mode with bash shell</p>

    <p>Same as:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker container run -it ...
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>docker start/stop</strong>: Starts/stops an existing container</p>

    <p>If a command is specified the first time the container was run, then it uses the same command when it’s started.</p>

    <p>Example:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker run -it {image name} bash
</code></pre></div>    </div>

    <p>This creates a container in interactive mode</p>

    <p>We can exit the container by running exit in the terminal (leaving the container running in the background) ???? (or Ctrl P+Q??). We can then stop the container:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker stop {container id}
</code></pre></div>    </div>

    <p>Stop command sends a signal to the process with pid = 1 in the container to stop gracefully. Docker gives the container 10 seconds to stop before it forcefully stops it itself.</p>

    <p>We can start it again with interactive flag to run bash again	
      docker run -i {container id}</p>

    <p>This runs bash automatically because that was the command we used while creating the container.</p>
  </li>
  <li>
<strong>docker run -p {host port}:{container port}</strong>: Forwards a host port to container</li>
</ul>

<div id="ezoic-pub-ad-placeholder-101">
<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
<!-- ezoic-00 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5266062674794996" data-ad-slot="4902272427" data-ad-format="auto"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<ul>
  <li>
    <p><strong>docker run -v {host path}:{container path}</strong>: Maps a path on host to a path on container.</p>

    <p>If the container path exists it will be overwritten by the contents of host path. In other words, the container will see the host files while accessing that path incestead of its local files.</p>
  </li>
  <li>
    <p><strong>docker diff</strong>: Lists the differences between the container and the base image. Shows the added, deleted and changed files.</p>
  </li>
  <li>
    <p><strong>docker commit</strong>: Creates a new image based on the container</p>
  </li>
  <li>
    <p><strong>docker logs {container id}</strong>: Shows the logs of the container.</p>

    <p>Docker logging mechanism listens to stdout and stderr. We can link other logs to stdout and stderr so that we can view them using docker logs {container id}</p>

    <p>Example:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  RUN ln -sf /dev/stdout /var/log/nginx/access.log &amp;&amp; ln -sf /dev/stderr /var/log/nginx/error.log
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>docker network</strong>:</p>

    <p><strong>docker network create {network name}</strong>: Creates a new network</p>

    <p><strong>docker network ls</strong>: Lists all networks</p>

    <p><strong>docker network inspect {network name}</strong>: Gets information of a specific network</p>

    <p><strong>docker run –network {network name}</strong>: Creates a container inside the specified network</p>

    <p>Containers can address each other by name within the network.</p>
  </li>
  <li>
    <p><strong>docker container exec</strong>: Can be used to run commands in a running container. Also can be used to connect to the container by running a shell</p>

    <p>Example:</p>

    <p>docker container exec {container id} sh</p>
  </li>
</ul>

<p>It starts a new process inside the container</p>

<h2 id="docker-compose">Docker Compose</h2>
<p>A tool for defining and running multi-container Docker applications.</p>

<ul>
  <li>Instead of stand-alone containers, “services” are defined in “docker-compose.yml” file</li>
  <li>
<strong>docker-compose up</strong> command will create the entire application with all the components (containers, networks, volumes etc)</li>
  <li>
<strong>docker-compose config</strong>: It is used to verify a docker-compose yml file.</li>
  <li>
<strong>docker-compose up -d</strong>: Starts the services in detached mode. Uses the current directory name to prepend the objects (networks, volumes, containers etc) created.</li>
  <li>
<strong>docker-compose ps</strong>: Shows the full stack with names, commands, states and ports</li>
  <li>
<strong>docker-compose logs -f</strong>: Shows logs of the whole stack. tails and shows the updates.</li>
  <li>
<strong>docker-compose down</strong>: Stops and removes the containers and networks. Volumes are NOT deleted.</li>
</ul>

<p>Environment variables can be used in docker-compose.yml files in ${VAR_NAME} format.</p>

<ul>
  <li>
<strong>docker-compose -f {filename}</strong>: Used to specify non-default config files.</li>
  <li>
    <p>Multiple YML files can be used and can be extended using “extends:” key in the following format:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  extends: 
      file: original.yml
      service: service name
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="general-concepts">General Concepts</h2>

<p><strong>Container:</strong> Isolated area of an OS with resource usage limits applied. VMs virtualize hardware resources, containers virtualize OS resources (file system, network stack etc)</p>

<p><strong>Namespaces:</strong> Isolation (like hypervisors)</p>

<p><strong>Control groups:</strong> Grouping objects and setting limits. In Windows they are also called Job Objects.</p>

<p><strong>Daemon:</strong> Includes REST API.</p>

<p><strong>containerd:</strong> Handles container operations like start, stop etc.. on Windows, Compute Services, includes runc</p>

<p><strong>runtime:</strong> OCI (Linux -&gt; runc) runc creates the container than exits</p>

<p>containerd cannot create containers by itself. That capability is with the OCI layer.</p>

<p>Windows containers are 2 kinds:</p>

<ul>
  <li>Native containers</li>
  <li>
    <p>Hyper-V</p>
  </li>
  <li>Layering
    <ul>
      <li>Base Layer: At the bottom (OS Files &amp; objects)</li>
      <li>App Code: Built on top of base layer</li>
    </ul>

    <p>Each layer is located under /var/lib/docker/aufs/diff/{layer id}</p>

    <p>Layer id is different from the hash value of the layer</p>
  </li>
  <li>
    <p>Images live in registries. Docker defaults to Docker Hub</p>
  </li>
  <li>
    <p>Docker Trusted Registry comes with Docker Enterprise Edition</p>
  </li>
  <li>
    <p>Official images can be addressed as docker.io/image name or just the image name</p>
  </li>
  <li>
    <p>Naming convention: Registry / Repo / Image (Tag)</p>
  </li>
  <li>Registry: docker.io is default</li>
  <li>
    <p>Image: latest is default</p>
  </li>
  <li>
    <p>Image layers are read-only. Containers have their read-write layers. Container adds a writable layer on top of the read-only layers from the image.
If they need to change something on a read-only layer, they use copy-on-write operation and create a copy of the existing layer and apply the change on that new layer. Anytime container needs to change a file, creates a copy of the file in its own writable layer and changes it there.</p>
  </li>
  <li>
    <p>Cmd vs entrypoint: runtime arguments overrides default arguments. Entrypoint runtime arguments are appended</p>
  </li>
  <li>Dockerfile commands
    <ul>
      <li>FROM is always the first instruction</li>
      <li>Good practice to label with maintainer email address</li>
      <li>RUN: Executes command and creates a layer</li>
      <li>COPY: Copies files into image in a new layer</li>
      <li>EXPOSE: Specifies which port to liste to. Doesn’t create a new layer. Adds metadata.</li>
      <li>ENTRYPOINT: Specifies what to run when a container starts.</li>
      <li>WORKDIR: Specifies the default directory. Doesn’t create layer.</li>
    </ul>
  </li>
  <li>Multi-stage builds
    <ul>
      <li>Helps to remove unnecessary packages / files from the final production image.</li>
      <li>It can get specific files from intermediary builds</li>
    </ul>
  </li>
</ul>

<h2 id="notes">Notes</h2>
<ul>
  <li>A container will run one process only</li>
  <li>If the command is a background process, the container will stop right after it ran. It needs to be something like a shell and not like a web server.</li>
  <li>As of v1.12 Docker runs in either single-image mode or swarm mode.</li>
  <li>Recent Docker versions support logging drivers. They forward the logs to external systems such as dusk of, splunk etc (–log-driver and –log-opts)</li>
</ul>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://serversforhackers.com/shipping-docker" target="_blank" rel="noopener noreferrer">Online course: Shipping Docker</a></li>
  <li><a href="https://www.pluralsight.com/courses/docker-deep-dive-update" target="_blank" rel="noopener noreferrer">Online course: Docker Deep Dive</a></li>
</ul>


		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2019/05/22/Developing-a-Web-API-with-ASP.NET-Core/" itemprop="url">Developing a Web API with ASP.NET Core</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2019-05-22T05:00:00+01:00" itemprop="datePublished">May 22, 2019</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/dev">dev</a></span> -->

<!-- dev -->




    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">asp.net, dotnet_core</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Developing projects is fun and a great way to learn new stuff. The things is everything moves so fast, you constantly need to maintain the projects as well. In that spirit, I decided to re-write my old AngularJS DomChk53.</p>

<p>First, I developed an API. This way I won’t have to maintain my AWS Lambda functions. Even though nobody uses them, still opening a public API poses risks and maintenance hassle. Now everybody can run their own system locally using their own AWS accounts.</p>

<h2 id="api-implementation">API Implementation</h2>

<p></p>
<div class="github-widget" data-repo="volkanpaksoy/domchk53"></div>

<p>Full source code of the API can be found in DomChk53 repo under <em>aspnet-api</em> folder. There’s not much benefit in covering the code line by line but I want to talk about some of the stuff that stood out in one way or the other:</p>

<h3 id="cs5001-program-does-not-contain-a-static-main-method-error">CS5001: Program does not contain a static ‘Main’ method” error</h3>
<p>I started this API with the intention of deploying it to Docker so right after I created a new project I tested Docker deployment but it kept giving the error above. After some searching I found that the Dockerfile was in the wrong folder! I moved it one level up as suggested in <a href="https://developercommunity.visualstudio.com/content/problem/344880/dotnet-core-build-linux-returns-error-cs5001-progr.html" target="_blank" rel="noopener noreferrer">this</a> answer and it worked like a charm!</p>

<h3 id="reading-config-values">Reading config values</h3>
<p>I appreciated the ease of using configuration files. IConfiguration provider is provided out-of-the-box which handles appsettings.json config file.</p>

<p>So for example I was able to inject it easily:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="nf">TldService</span><span class="p">(</span><span class="n">IConfiguration</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">IFetchHtmlService</span> <span class="n">fetchHtmlService</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">configuration</span> <span class="p">=</span> <span class="n">configuration</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="n">fetchHtmlService</span> <span class="p">=</span> <span class="n">fetchHtmlService</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>and use it like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">awsDocumentationUrl</span> <span class="p">=</span> <span class="n">configuration</span><span class="p">[</span><span class="s">"AWS.DocumentationURL"</span><span class="p">];</span>
</code></pre></div></div>

<div id="ezoic-pub-ad-placeholder-101">
<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
<!-- ezoic-00 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5266062674794996" data-ad-slot="4902272427" data-ad-format="auto"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<h3 id="using-dependency-injection">Using dependency injection</h3>
<p>ASP.NET Core Web API has built-in dependency injection so when I needed to use it all I had to do was register my classes in ConfigureServices method:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// This method gets called by the runtime. Use this method to add services to the container.</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">services</span><span class="p">.</span><span class="nf">AddMvc</span><span class="p">().</span><span class="nf">SetCompatibilityVersion</span><span class="p">(</span><span class="n">CompatibilityVersion</span><span class="p">.</span><span class="n">Version_2_1</span><span class="p">);</span>

    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">ITldService</span><span class="p">,</span> <span class="n">TldService</span><span class="p">&gt;();</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddTransient</span><span class="p">&lt;</span><span class="n">IFetchHtmlService</span><span class="p">,</span> <span class="n">FetchHtmlService</span><span class="p">&gt;();</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="documentation">Documentation</h3>
<p>Adding Swagger documentation was a breeze. I just followed the steps in the <a href="https://docs.microsoft.com/en-us/aspnet/core/tutorials/getting-started-with-swashbuckle" target="_blank" rel="noopener noreferrer">documentation</a> and now I have a pretty documentation. More on that in the usage section below.</p>

<h2 id="aws-implementation">AWS Implementation</h2>
<p>Even though the code will run locally in a Docker container, you still need to setup an IAM user with the appropriate permissions. So make sure the policy below is attached to the user:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": "route53domains:CheckDomainAvailability",
            "Resource": "*"
        }
    ]
}
</code></pre></div></div>

<h2 id="usage">Usage</h2>
<p>Nice thing about Swagger is it can used as a full-blown API client as well. So instead of developing a dummy client I just used Swagger UI for simple domain availability enquiries. This is until I develop a better frontend on my own. For now at least it works.</p>

<p>To use Swagger, simply run the Domchk53.API application and change the URL to https://localhost:{port number}/docs, port number being whatever your local web server is running on.</p>

<p><img src="/images/vpblogimg/2019/05/aspnet-webapi-swagger-01.png" alt=""></p>

<h3 id="curl-usage">curl usage:</h3>
<p>Windows:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -i -X POST -H "Content-Type: application/json" -d "{\"domainList\": [\"volkan\"], \"tldList\": [\"com\", \"net\"]}" https://localhost:5001/api/domain
</code></pre></div></div>

<p>Mac:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl --insecure -X POST -H "Content-Type: application/json" -d '{"domainList": ["volkan"], "tldList": ["com", "net"]}' https://localhost:5001/api/domain
</code></pre></div></div>

<h3 id="example-test-data">Example Test data:</h3>
<p>This is just a quick reference to be used as template:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "domainList": ["domain1", "domain2"],
  "tldList": ["com", "net"]
}
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{ "domainList": ["volkan"], "tldList": ["com", "net"] }
</code></pre></div></div>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://developercommunity.visualstudio.com/content/problem/344880/dotnet-core-build-linux-returns-error-cs5001-progr.html" target="_blank" rel="noopener noreferrer">Solution for “CS5001: Program does not contain a static ‘Main’ method” error</a></li>
  <li><a href="https://weblog.west-wind.com/posts/2018/Feb/18/Accessing-Configuration-in-NET-Core-Test-Projects" target="_blank" rel="noopener noreferrer">Accessing Configuration in .NET Core Test Projects</a></li>
  <li><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-2.1" target="_blank" rel="noopener noreferrer">Dependency injection in ASP.NET Core</a></li>
  <li><a href="https://docs.microsoft.com/en-us/aspnet/core/tutorials/getting-started-with-swashbuckle" target="_blank" rel="noopener noreferrer">Get started with Swashbuckle and ASP.NET Core</a></li>
</ul>


		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2019/04/03/Unit-Testing-in-JavaScript-Part-2-Mocking/" itemprop="url">Unit Testing in Javascript - Part 2: Mocking</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2019-04-03T07:00:00+01:00" itemprop="datePublished">April  3, 2019</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/dev">dev</a></span> -->

<!-- dev -->




    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">javascript, tdd, unit_testing</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>As applications get more complex, they come with more dependencies. Mocking helps us isolate the subject under test so that our unit tests can run any external dependencies. In this example, I’d like to show a simple mocking example using Jasmine and Karma in an Angular app.</p>

<h2 id="case-study-mocking-a-http-dependency">Case study: Mocking a HTTP dependency</h2>

<p>In this example the service I want to test is called TldService. It basically gets a raw HTML from a URL and extracts some data using regex.</p>

<p>It looks something like this</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export class TldService {

  constructor(private fetchHtmlService: FetchHtmlService) { }

  getAllSupportedTlds(): string[] {
    const rawHtml = this.fetchHtmlService.getRawHtml();
    const supportedTlds = this.parseHtml(rawHtml);
    return supportedTlds;
  }

  private parseHtml(html: string): string[] {
    const pattern = /some-regex-pattern/g;
    const regEx = new RegExp(pattern);
    let tldList = [];

    let match = regEx.exec(html);
    console.log(match);

    while (match !== null) {
      tldList.push(match[1]);
      match = regEx.exec(html);
    }

    return tldList;
  }
}
</code></pre></div></div>

<p>This service depends on FetchHtmlService which does the getting HTML part. Nice thing about injecting this dependency is that we can replace it with a fake one while testing. This way we can test it without even having to implement the dependency.</p>

<div id="ezoic-pub-ad-placeholder-101">
<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
<!-- ezoic-00 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5266062674794996" data-ad-slot="4902272427" data-ad-format="auto"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import { TestBed } from '@angular/core/testing';
import { TldService } from './tld.service';
import { FetchHtmlService } from './fetch-html.service';

describe('TldService', () =&gt; {
  beforeEach(() =&gt; TestBed.configureTestingModule({

  }));

  it('should be created', () =&gt; {
    const service: TldService = TestBed.get(TldService);
    expect(service).toBeTruthy();
  });

  it('should parse html and extract TLD list', () =&gt; {
    const fetchHtmlService: FetchHtmlService = new FetchHtmlService();
    spyOn(fetchHtmlService, 'getRawHtml').and.returnValue('&lt;a href="registrar-tld-list.html#academy"&gt;.academy&lt;/a&gt;');
    const service: TldService = new TldService(fetchHtmlService);
    expect(service.getAllSupportedTlds().length).toBe(1);
  });
});
</code></pre></div></div>

<p>In the 2nd test above we are creating a new FetchHtmlService and overriding the <em>getRawHtml</em> function behaviour by using Jasmine’s <strong>spyOn</strong> method.</p>

<p>That’s it! Now we don’t need a network connection to make actual calls while testing our code. We can develop and test our service in isolation independent from the dependency!</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://github.com/volkanpaksoy/lab/tree/master/blog/UnitTestingInJavaScriptPart2" target="_blank" rel="noopener noreferrer">Source code</a></li>
  <li><a href="https://jasmine.github.io/" target="_blank" rel="noopener noreferrer">Jasmine JS</a></li>
  <li><a href="https://karma-runner.github.io/latest/index.html" target="_blank" rel="noopener noreferrer">Karma JS</a></li>
</ul>

		
		
	</div>


    </article>


</div>
<nav id="pagenavi">
    
        <a href="/page/7" class="prev">Prev</a>
    
    
        <a href="/page/9" class="next">Next</a>
    
    <div class="center"><a href="/archive">Blog Archives</a></div>
</nav>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright © 2022 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>

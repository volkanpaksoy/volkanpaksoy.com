<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/page/36/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <script data-ad-client="ca-pub-0414743900624675" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-35583486-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
<br>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0414743900624675" crossorigin="anonymous"></script>
<!-- AdUnit01 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-0414743900624675" data-ad-slot="9604018233" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">



    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2014/12/12/homebrew-security-camera-with-raspberry-pi/" itemprop="url">Homebrew Security Camera with Raspberry Pi</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2014-12-12T12:45:00+00:00" itemprop="datePublished">December 12, 2014</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/securityawsdev">security</a></span> -->

<!-- security, aws, dev -->




    <a href="/category/security">security</a>
    , 

    <a href="/category/aws">aws</a>
    , 

    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">raspberry_pi, gadget, powershell, s3</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>I know there are very cheap security cameras that you can setup in a few minutes. They may provide security but they cannot provide the satisfaction you get after a DIY project! So let’s dig in just for the fun of it.</p>

<h3 id="ingredients">Ingredients</h3>

<table>
  <thead>
    <tr>
      <th>Component</th>
      <th>Price</th>
      <th>Where to buy?</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Raspberry Pi Starter Kit</td>
      <td>£36</td>
      <td><a href="http://www.amazon.co.uk/Raspberry-Pi-Motherboard-Starter-Kit/dp/B00LU2FDG8/" target="_blank" rel="noopener noreferrer">Amazon</a></td>
    </tr>
    <tr>
      <td>Camera module</td>
      <td>£17</td>
      <td><a href="http://www.amazon.co.uk/gp/product/B00E1GGE40" target="_blank" rel="noopener noreferrer">Amazon</a></td>
    </tr>
    <tr>
      <td>Protective case for the camera module</td>
      <td>£4</td>
      <td><a href="http://www.amazon.co.uk/gp/product/B00IJZOT5A" target="_blank" rel="noopener noreferrer">Amazon</a></td>
    </tr>
    <tr>
      <td>Wireless adaptor</td>
      <td>£6</td>
      <td><a href="http://www.amazon.co.uk/gp/product/B003MTTJOY" target="_blank" rel="noopener noreferrer">Amazon</a></td>
    </tr>
  </tbody>
</table>

<p>Once all put together this is what you are going to end up with:</p>

<p><img src="/images/vpblogimg/2014/12/raspberry-pi-security-camera-1.png" alt="Raspberry Pi Security Camera"></p>

<h3 id="bring-it-to-life">Bring it to life</h3>
<ol>
  <li>Download a standard distro for Raspberry Pi. I used <a href="http://www.raspberrypi.org/downloads/" target="_blank" rel="noopener noreferrer">Rasbian</a>.</li>
  <li>Write the image to the SD card. I use <a href="http://sourceforge.net/projects/win32diskimager/" target="_blank" rel="noopener noreferrer">Win32 Disk Imager</a> on Windows.</li>
</ol>

<h3 id="main-course-motion">Main course: Motion</h3>
<p>There is a great tutorial <a href="http://www.instructables.com/id/Raspberry-Pi-as-low-cost-HD-surveillance-camera/" target="_blank" rel="noopener noreferrer">here</a> for converting your Pi into a security camera  which I mostly followed. Basically you enable WiFi, install Motion software and tweak the configuration a bit (image size, framerate etc) and it’s (hopefully) good to go.</p>

<p>The video didn’t work for me unfortunately. It was recording something but only the first frame was visible so it wasn’t any better than a still image. So I decided to ignore videos completely.</p>

<p>Instead of using a network share I decided to upload footage to AWS S3 directly using <a href="http://s3tools.org/s3cmd" target="_blank" rel="noopener noreferrer">Amazon S3 Tools</a>. Also don’t forget to clear old footage. Otherwise you can run out of space very quickly. I added a few cron jobs to carry out these tasks for me:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* * * * * s3cmd sync /var/surv/*.jpg s3://{BUCKET NAME}/
* */2 * * * sudo rm /var/surv/*.avi
* */6 * * *  find /var/surv/* -mtime +1 -exec rm {} \;
</code></pre></div></div>

<p>It syncs the local folder with S3 bucket, deletes all local video files and files older than a day. I delete the video files more frequently as they take up a lot of space.</p>

<h3 id="monitoring-and-notifications">Monitoring and Notifications</h3>
<p>No system is complete without proper monitoring and notifications. It’s especially important for systems like this that’s supposed to run quietly in the background.</p>

<p>Unfortunately in my case it stopped working a few times which made monitoring even more important. I don’t know what’s causing the issue. Maybe it’s because I’m using an older version of Raspberry Pi and it’s not capable of handling all the motion software and S3 uploads etc.</p>

<p>To keep an eye on it, I decided to create a small PowerShell script to check S3 for incoming files and send me a notification if it seems to have stopped uploading.</p>

<h3 id="powershell-as-the-glue">PowerShell as the glue</h3>
<p>Built on .NET framework PowerShell is a very powerful (no pun intended) tool to write quick and dirty solutions. So first here’s the Send-Mail function:</p>

<noscript><pre>400: Invalid request</pre></noscript>
<script src="https://gist.github.com/672433f21d0748c1a399a1bd574e1687.js"> </script>

<p>I created a separate function for it as it’s a general-purpose feature which can be used in many places. To make it even more generic you can take out the from and to email addresses and add them as parameters to the function.</p>

<p>And here’s the actual notification logic:</p>

<noscript><pre>400: Invalid request</pre></noscript>
<script src="https://gist.github.com/c711c19e19799b1ba4193d79d364dc76.js"> </script>

<p>It finds the latest image by sorting them by LastModified field and compares this date with the current date. If it’s been more than 1 day it sends an email. Depending on how often you expect images to be uploaded you can change the alert condition.</p>

<p>To use these scripts you’ll AWS accounts with S3 and SES privileges. Also you have to change the path of the send-mail.ps1 in the line it’s included.</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="http://www.instructables.com/id/Raspberry-Pi-as-low-cost-HD-surveillance-camera/" target="_blank" rel="noopener noreferrer">Tutorial on Instructables.com</a></li>
  <li><a href="http://www.fl3m.com/2012/08/sending-email-through-amazon-ses-with.html" target="_blank" rel="noopener noreferrer">PowerShell script to send email</a></li>
  <li><a href="http://www.raspberrypi.org/downloads/" target="_blank" rel="noopener noreferrer">Raspberry Pi downloads</a></li>
  <li><a href="http://s3tools.org/s3cmd" target="_blank" rel="noopener noreferrer">Amazon S3 Tools</a></li>
</ul>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2014/12/12/update-aws-security-groups-with-powershell/" itemprop="url">Update AWS Security Groups with PowerShell</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2014-12-12T00:30:00+00:00" itemprop="datePublished">December 12, 2014</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/awssecurity">aws</a></span> -->

<!-- aws, security -->




    <a href="/category/aws">aws</a>
    , 

    <a href="/category/security">security</a>
    
</span>
	<span class="tags">powershell, ec2</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Here’s the scenario:</p>

<ul>
  <li>You use AWS</li>
  <li>You don’t have a static IP</li>
  <li>You connect to your EC2 instances via SSH and/or RDP only from your IP</li>
  <li>You are too lazy to update the security groups manually when your IP changes!</li>
</ul>

<p>You’ve come to the right place: I’ve got the solution.</p>

<p>Let’s have a look how it’s built step-by-step:</p>

<h3 id="step-1-create-an-iam-account-to-access-security-groups">Step 1: Create an IAM account to access security groups</h3>
<p>As a general rule of thumb always grant the minimum privileges possible to the accounts you use. Create a new user and go to the user’s details. Select <em>Attach User Policy</em> and then <em>Policy Generator</em>. Select <em>AWS EC2</em> from the services list. For our script to run we need 3 privileges: List security groups (<em>DescribeSecurityGroups</em>), delete old IP permissions (<em>RevokeSecurityGroupIngress</em>) and add new IP permissions (<em>AuthorizeSecurityGroupIngress</em>).</p>

<p><img src="/images/vpblogimg/2014/12/iam-security-group-user.png" alt=""></p>

<p>Alternatively you can just attach the following policy to your user:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "Stmt1418339796000",
      "Effect": "Allow",
      "Action": [
        "ec2:AuthorizeSecurityGroupIngress",
        "ec2:DescribeSecurityGroups",
        "ec2:RevokeSecurityGroupIngress"
      ],
      "Resource": [
        "*"
      ]
    }
  ]
}
</code></pre></div></div>

<p>IAM has a very nice simulation feature. Before you proceed I recommend you run it and verify only 3 actions are allowed.</p>

<p><img src="/images/vpblogimg/2014/12/aws-iam-policy-simulator.png" alt=""></p>

<h3 id="step-2-modify-the-powershell-script">Step 2: Modify the PowerShell script</h3>
<p>The script I created is on Gist as seen below. Before you can use it you have to update it with the access and secret keys of the user created above.</p>

<p>Also since fiddling with security groups can become messy very quickly I’d strongly recommend you perform a dry run first. By default <em>$dryRun</em> is set to true. Unless you set it to <em>$false</em> it will only display what it is going to do but will not take any action. So make sure you know what you’re doing before you give it a go. I don’t think this script will be a ready-made script for anyone. Probably would need some tweaking here and there to tailor to your needs. But this version works for me so here it is:</p>

<noscript><pre>400: Invalid request</pre></noscript>
<script src="https://gist.github.com/c99400aec7e519626d9b6d0d1cf409aa.js"> </script>

<p>First it gets a list of security groups that have SSH and RDP permissions in them. Then loops through these permissions and compares the IP address with the current one. I used my own external IP checker service that I’ve recently developed as I <a href="https://volkanpaksoy.com/archive/2014/12/08/simple-api-with-nodejs/">blogged here</a>. You can use other services as well. Just make sure you change the URL in the script. My service returns a JSON object so if the method you use returns a different format you need to modify the parsing code as well.</p>

<p>If the IP addresses are different, it revokes the old permission and creates a new one with your current IP. Protocol and ports remain intact.</p>

<p>This is the output of the script:</p>

<p><img src="/images/vpblogimg/2014/12/aws-security-group-update-script.png" alt=""></p>

<p>If the IP addresses for port 22 an 3389 are up-to-date it just displays “<em>Security group is up-to-date</em>” so it can be run consecutively. So you can schedule it to run as often as you want.</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="http://docs.aws.amazon.com/powershell/latest/userguide/pstools-welcome.html" target="_blank" rel="noopener noreferrer">AWS PowerShell Tools documentation</a></li>
</ul>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2014/12/08/simple-api-with-nodejs/" itemprop="url">A simple REST API with Node.js</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2014-12-08T21:30:00+00:00" itemprop="datePublished">December  8, 2014</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/dev">dev</a></span> -->

<!-- dev -->




    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">nodejs, javascript</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<h3 id="enter-nodejs">Enter Node.js</h3>
<p><a href="http://nodejs.org/" target="_blank" rel="noopener noreferrer">Node.js</a> is a popular platform to develop JavaScript applications. Internally it uses Google’s <a href="https://code.google.com/p/v8/" target="_blank" rel="noopener noreferrer">V8 JavaScript Engine</a> and enables to develop fast, scalable and event-driven JavaScript applications. I’ve recently developed my first REST API using Node and in this post I’ll talk about the steps required to develop and deploy a Node application.</p>

<h3 id="learn">Learn</h3>
<p>Needless to say there are many resources to learn Node (as with any such popular environment). I found the <a href="http://www.microsoftvirtualacademy.com/training-courses/building-apps-with-node-js-jump-start" target="_blank" rel="noopener noreferrer">Microsoft Virtual Academy’s training</a> quite useful. It’s very enjoyable and free. I’ll provide more recommendations as I go deeper.</p>

<h3 id="setup">Setup</h3>
<p>I used my main dev machine for this project which is running Windows 8.1. A nice thing about Node.js is that it’s cross-platform so you can use Linux, Mac or Windows.</p>

<p>On Windows, simply download and run installer on <a href="http://nodejs.org/download/" target="_blank" rel="noopener noreferrer">this</a> page. Alternativaly if you like Chocolatey you can run the following command in a command-prompt (you may need to run it as administrator)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>choco install nodejs.install
</code></pre></div></div>

<h3 id="develop">Develop</h3>
<p>There is a module that makes life a lot easier if are planning to develop an API with Node and it’s called <a href="http://expressjs.com/" target="_blank" rel="noopener noreferrer">Express</a></p>

<p>We’re going to use express in our API so first we need to install it using Node Package Manager (NPM)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install express 
</code></pre></div></div>

<p>Now that we have everything we need, we can write the actual code for the endpoint:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">remoteAddress</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s1">'x-forwarded-for'</span><span class="p">]</span> <span class="o">||</span> 
    				  <span class="nx">req</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="s2">"ipAddress"</span><span class="p">:</span> <span class="nx">remoteAddress</span> <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">80</span><span class="p">);</span>
</code></pre></div></div>

<p>Just getting remoteAddress wouldn’t work when your applications is not accepting connections from the users directly –which is generally the case in large applications where load balancers face the clients.</p>

<p><img src="/images/vpblogimg/2014/12/heroku-output.png" alt=""></p>

<p>For example, in the sample output above it’s obviously getting a 10.x.x.x IP from remoteAddress. So we check for the <em>x-forwarded-for</em> HTTP header and use it if present.</p>

<h3 id="deploy">Deploy</h3>
<p>First I installed Node on Linux box on AWS by simple running</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -sL https://deb.nodesource.com/setup | sudo bash -
sudo apt-get install -y nodejs
</code></pre></div></div>

<p>but then I recalled I could use Heroku to host node.js applications for free. Why would I keep an eye on the service when the nice guys at Heroku are volunteering to do it for me for free, right? So I created an application on Heroku by following <a href="https://devcenter.heroku.com/articles/getting-started-with-nodejs" target="_blank" rel="noopener noreferrer">this guide</a>.</p>

<p>Basically you can deploy by just following these simple steps:</p>

<ol>
  <li>Download and install Heroku Toolbelt from <a href="https://toolbelt.heroku.com/" target="_blank" rel="noopener noreferrer">here</a>
</li>
  <li>Clone your git repository and navigate to that folder using a command prompt.</li>
  <li>
    <p>Create an app on heroku by running</p>

    <div class="highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> heroku create --http-git
</code></pre></div>    </div>

    <p>This will add a remote to your git repository</p>

    <p><img src="/images/vpblogimg/2014/12/heroku-remote.png" alt="Heroku remote"></p>
  </li>
  <li>
    <p>Now as you have the remote you can push your code to that</p>

    <div class="highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> git push heroku master
</code></pre></div>    </div>

    <p><img src="/images/vpblogimg/2014/12/heroku-deploy-app.png" alt="Heroku deploy app"></p>
  </li>
  <li>
    <p>[Optional] Add a custom domain and change the application name</p>

    <p>If you don’t want to use Heroku domain and/or the application name is assigns automatically you can change them. First go to Dashboard –&gt; Personal Apps and click on the application. Then click Settings. You can rename the application there directly but it breaks your git remote. So I suggest doing it via the command line by running</p>

    <div class="highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> heroku apps:rename newname --app oldname
</code></pre></div>    </div>

    <p>On the same page you can add your custom domain. Of course you have to redirect your domain/subdomain to heroku’s URL by adding a CNAME record to your zone file.</p>

    <p><img src="/images/vpblogimg/2014/12/heroku-custom-domain.png" alt="Heroku custom domain"></p>
  </li>
</ol>

<h3 id="test">Test</h3>
<p>So we have an up-and-running REST API and let’s see it in action. One way to test it with several IP addresses is using free proxy servers that float around the net (for some reason). I visited <a href="http://proxylist.hidemyass.com/" target="_blank" rel="noopener noreferrer">HideMyAss</a> to quickly get a few. It may take a few tries to find a working proxy but here is what we’re looking for:</p>

<p><img src="/images/vpblogimg/2014/12/check-ip-output.png" alt=""></p>

<p>My external IP is the same as the proxy address I just set. While testing with a few different proxy servers I came across this rather unexpected result:</p>

<p><img src="/images/vpblogimg/2014/12/heroku-output-with-forwarded-header.png" alt=""></p>

<p>I deployed a version with more detailed output to understand what was going on. Looks like the <em>X-Forwarded-For</em> header was set to <em>“127.0.0.1, 177.99.93.214”</em> My service currently doesn’t support extracting the actual external IP from such comma-separated lists. First I need to look into it and see whether it’s a common and acceptable practice conforming with the standards or just a weird behaviour from a random server. But the solution is obviously simple to implement: Just split the string from commas and get the last entry.</p>

<h3 id="enjoy">Enjoy!</h3>
<p>So now instead of <a href="http://whatismyip.com" target="_blank" rel="noopener noreferrer">whatismyip.com</a> I can use the service I built with my own two hands: <a href="http://check-ip.herokuapp.com/" target="_blank" rel="noopener noreferrer">http://check-ip.herokuapp.com/</a>. It’s open-source so feel free to fiddle at will!</p>

<p>It’s a simple API anyway but it feels nice to see it running so quickly. Also no maintenance is required thanks to Heroku. For me it was a nice introduction to Node.js world. I hope this post comes in handy to other people as well.</p>

<h3 id="update">UPDATE</h3>
<p>As I pointed out in one example above during my tests I got comma separated IP addresses in <em>x-forwarded-for</em> field. Turns out it’s not a weird behaviour and perfectly legitimate as described in the RFC for the header:</p>

<blockquote>
  <p>The “for” parameter is used to disclose information about the client that initiated the request 
and subsequent proxies in a chain of proxies.  When proxies choose to use the “for” parameter, 
its default configuration SHOULD contain an obfuscated identifier as described in Section 6.3.</p>
</blockquote>

<p>So I updated the application to split the proxy chain from comma and return the last entry in the list.</p>

<p><img src="/images/vpblogimg/2014/12/check-ip-output2.png" alt=""></p>

<p>As shown above there are two entries in the forwarded for header but the result IP address is the one I set in Firefox.</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="http://www.microsoftvirtualacademy.com/training-courses/building-apps-with-node-js-jump-start" target="_blank" rel="noopener noreferrer">Microsoft Virtual Academy course</a></li>
  <li><a href="https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager#debian-and-ubuntu-based-linux-distributions" target="_blank" rel="noopener noreferrer">Node.js Linux installation</a></li>
  <li><a href="https://devcenter.heroku.com/articles/getting-started-with-nodejs" target="_blank" rel="noopener noreferrer">Deploying Node.js application to Heroku</a></li>
  <li><a href="https://github.com/volkanpaksoy/check-external-ip" target="_blank" rel="noopener noreferrer">Source code</a></li>
  <li><a href="http://check-ip.herokuapp.com/" target="_blank" rel="noopener noreferrer">Application on Heroku</a></li>
  <li><a href="http://tools.ietf.org/html/rfc7239#section-5.2" target="_blank" rel="noopener noreferrer">RFC for Forwarded For header</a></li>
  <li><a href="http://en.wikipedia.org/wiki/X-Forwarded-For" target="_blank" rel="noopener noreferrer">WikiPedia Article for X-Forwarded-For</a></li>
</ul>

		
		
	</div>


    </article>


</div>
<nav id="pagenavi">
    
        <a href="/page/35" class="prev">Prev</a>
    
    
        <a href="/page/37" class="next">Next</a>
    
    <div class="center"><a href="/archive">Blog Archives</a></div>
</nav>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright © 2021 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>

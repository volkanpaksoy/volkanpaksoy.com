<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/page/22/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996"
  crossorigin="anonymous"></script>

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-35583486-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@volkan_paksoy">
  <meta name="twitter:creator" content="@Volkan Paksoy">
  <meta name="twitter:title"   content="">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary">
  <meta name="twitter:image" content=""> -->
  
  <!-- end of Twitter cards -->


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
<br>
<br>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
<!-- vp.com - default -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5266062674794996" data-ad-slot="6750480330" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">



    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2015/10/19/design-patterns-abstract-factory/" itemprop="url">Design Patterns: Abstract Factory</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2015-10-19T12:30:00+01:00" itemprop="datePublished">October 19, 2015</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/designdev">design</a></span> -->

<!-- design, dev -->




    <a href="/category/design">design</a>
    , 

    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">design_patterns, csharp</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>A few days ago I published a <a href="https://volkanpaksoy.com/archive/2015/10/16/design-patterns-factory-method">post discussing Factory Method pattern</a>. This article is about the other factory design pattern: Abstract Factory.</p>

<h3 id="use-case-switching-between-configuration-sources-easily">Use case: Switching between configuration sources easily</h3>
<p>Imagine in a C# application you accessed ConfigurationManager.AppSettings whenever you needed a value from the configuration. This would essentially be hardcoding the configuration source and it would be hard to change if you needed to switch to another configuration source (database, web service, etc). A nicer way would be to <em>“outsource”</em> the creation of configuration source to another class.</p>

<h3 id="what-is-abstract-factory">What is Abstract Factory?</h3>
<p>Here’s the official definition from GoF:</p>

<blockquote>
  <p>Provide an interface for creating families of related or dependent objects without specifying their concrete classes.</p>
</blockquote>

<h3 id="implementation">Implementation</h3>
<p>The application first composes the main class (ArticleFeedGenerator) with the services it will use and starts the process.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">IConfigurationFactory</span> <span class="n">configFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AppConfigConfigurationFactory</span><span class="p">();</span>

    <span class="n">IApiSettings</span> <span class="n">apiSettings</span> <span class="p">=</span> <span class="n">configFactory</span><span class="p">.</span><span class="nf">GetApiSettings</span><span class="p">();</span>
    <span class="n">IFeedSettings</span> <span class="n">feedSettings</span> <span class="p">=</span> <span class="n">configFactory</span><span class="p">.</span><span class="nf">GetFeedSettings</span><span class="p">();</span>
    <span class="n">IFeedServiceSettings</span> <span class="n">feedServiceSettings</span> <span class="p">=</span> <span class="n">configFactory</span><span class="p">.</span><span class="nf">GetFeedServiceSettings</span><span class="p">();</span>
    <span class="n">IS3PublisherSettings</span> <span class="n">s3PublishSettings</span> <span class="p">=</span> <span class="n">configFactory</span><span class="p">.</span><span class="nf">GetS3PublisherSettings</span><span class="p">();</span>
    <span class="n">IOfflineClientSettings</span> <span class="n">offlineClientSettings</span> <span class="p">=</span> <span class="n">configFactory</span><span class="p">.</span><span class="nf">GetOfflineClientSettings</span><span class="p">();</span>

    <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">OfflineClient</span><span class="p">(</span><span class="n">offlineClientSettings</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">articleFeedService</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ArticleFeedService</span><span class="p">(</span><span class="n">feedServiceSettings</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">publishService</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">S3PublishService</span><span class="p">(</span><span class="n">s3PublishSettings</span><span class="p">,</span> <span class="n">feedSettings</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">feedGenerator</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ArticleFeedGenerator</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">articleFeedService</span><span class="p">,</span> <span class="n">publishService</span><span class="p">,</span> <span class="n">feedSettings</span><span class="p">);</span>

    <span class="n">feedGenerator</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This version uses AppConfigConfigurationFactory to get the values from the App.config. When I need to switch to DynamoDB which I used in this example all I have to do is replace one line of code in the application:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">configFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DynamoDBConfigurationFactory</span><span class="p">();</span>
</code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5266062674794996" data-ad-slot="9650311114"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>With this change alone we are essentially replacing a whole family of related classes.</p>

<h3 id="on-the-factory-floor">On the factory floor</h3>
<p>The abstract factory and the concrete factories implement it are shown below:</p>

<p><img src="/images/vpblogimg/2015/10/design-pattern-abstract-factory-class-diagram-1.png" alt=""></p>

<p>Concrete configuration factories create the classes that deal with specific configuration values (<em>concrete products</em>). For instance AppConfigConfigurationFactory looks like this (simplified for brevity):</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">AppConfigConfigurationFactory</span> <span class="p">:</span> <span class="n">IConfigurationFactory</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">IApiSettings</span> <span class="nf">GetApiSettings</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">AppConfigApiSettings</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IFeedServiceSettings</span> <span class="nf">GetFeedServiceSettings</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">AppConfigFeedServiceSettings</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Similarly, DynamoDBConfigurationFactory is responsible for creating concrete classes that access DynamoDB values:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">DynamoDBConfigurationFactory</span> <span class="p">:</span> <span class="n">IConfigurationFactory</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="n">Table</span> <span class="n">_configTable</span><span class="p">;</span>
    
    <span class="k">public</span> <span class="nf">DynamoDBConfigurationFactory</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">AmazonDynamoDBClient</span> <span class="n">dynmamoClient</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AmazonDynamoDBClient</span><span class="p">(</span><span class="s">"accessKey"</span><span class="p">,</span> <span class="s">"secretKey"</span><span class="p">,</span> <span class="n">RegionEndpoint</span><span class="p">.</span><span class="n">EUWest1</span><span class="p">);</span>
        <span class="n">_configTable</span> <span class="p">=</span> <span class="n">Table</span><span class="p">.</span><span class="nf">LoadTable</span><span class="p">(</span><span class="n">dynmamoClient</span><span class="p">,</span> <span class="s">"tableName"</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="n">IApiSettings</span> <span class="nf">GetApiSettings</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DynamoDBApiSettings</span><span class="p">(</span><span class="n">_configTable</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IFeedServiceSettings</span> <span class="nf">GetFeedServiceSettings</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DynamoDBFeedServiceSettings</span><span class="p">(</span><span class="n">_configTable</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Notice all the “concrete products” implement the same “abstract product” interface and hence they are interchangable. With the product classes in the picture the diagram now looks like this:</p>

<p><img src="/images/vpblogimg/2015/10/design-pattern-abstract-factory-class-diagram-2.png" alt=""></p>

<p>Finally let’s have a look at the concrete objects that carry out the actual job. For example the IApiSettings exposes 2 string properties:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IApiSettings</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">ApiKey</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">string</span> <span class="n">ApiEndPoint</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If we want to read these values from App.config it’s very straightforward:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">AppConfigApiSettings</span> <span class="p">:</span> <span class="n">IApiSettings</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">ApiKey</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">"ApiKey"</span><span class="p">];</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">ApiEndPoint</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">"ApiEndPoint"</span><span class="p">];</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The DynamoDB version is fairly more complex but it makes no difference from the consumer’s point of view. Here GetValue is a method in the base class that returns the value from the encapsulated <em>Amazon.DynamoDBv2.DocumentModel.Table</em> object.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">DynamoDBApiSettings</span> <span class="p">:</span> <span class="n">DynamoDBSettingsBase</span><span class="p">,</span> <span class="n">IApiSettings</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">DynamoDBApiSettings</span><span class="p">(</span><span class="n">Table</span> <span class="n">configTable</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span> <span class="p">(</span><span class="n">configTable</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">ApiKey</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">GetValue</span><span class="p">(</span><span class="s">"ApiKey"</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">ApiEndPoint</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">GetValue</span><span class="p">(</span><span class="s">"ApiEndPoint"</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The concrete factory is responsible for creating the concrete classes it uses. So the client is completely oblivious to the classes such as DynamoDBApiSettings or AppConfigApiSettings. This means we can add a whole new set of configuration classes (i.e. a web service) and all we have to change in the client code will be one line where we instantiate the concrete factory.</p>

<p>This approach also allows us to be more flexible with the concerete class implementations. For example DynamoDB config class family requires a Table object in their constructors. To avoid code repetition I derived them all from a base class and moved the table to the base but the that doesn’t change anything in the client code.</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://github.com/volkanpaksoy/design-pattern-workout" target="_blank" rel="noopener noreferrer">Sample project source code</a></li>
  <li><a href="https://github.com/volkanpaksoy/rss-feed-generator" target="_blank" rel="noopener noreferrer">RSS feed generator source code</a></li>
  <li><a href="http://www.amazon.co.uk/Design-patterns-elements-reusable-object-oriented/dp/0201633612/" target="_blank" rel="noopener noreferrer">Book: GoF Book</a></li>
  <li><a href="http://www.amazon.co.uk/Head-First-Design-Patterns-Freeman/dp/0596007124/" target="_blank" rel="noopener noreferrer">Book: Head First Design Patterns</a></li>
</ul>


		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2015/10/16/design-patterns-factory-method/" itemprop="url">Design Patterns: Factory Method</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2015-10-16T01:30:00+01:00" itemprop="datePublished">October 16, 2015</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/designdev">design</a></span> -->

<!-- design, dev -->




    <a href="/category/design">design</a>
    , 

    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">design_patterns, csharp</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>I recently developed a toy project. It basically creates an RSS feed. One challenge I had was picking the feed formatter class (RSS vs Atom). I utilised Factory Method design pattern to solve that and this post discusses the usage of the pattern over that use case.</p>

<h3 id="use-case-creating-rss-feed-formatter">Use case: Creating RSS feed formatter</h3>
<p>I wanted my feed generator to support both RSS and Atom feeds based on the value specified in the configuration. In order to pass the XML validations they needed to modified a bit and I wanted these details hidden from the client code.</p>

<h3 id="what-is-factory-method">What is Factory Method?</h3>
<p>Here’s the official definition from GoF:</p>

<blockquote>
  <p>Define an interface for creating an object, but let subclasses decide which class to instantiate. Factory Method lets a class defer instantiation to subclasses</p>
</blockquote>

<p>Factory Method pattern is one of the creational patterns which make it easy to separate object creation from the actual system. The actual business logic doesn’t need to care about these object creation details.</p>

<h3 id="implementation">Implementation</h3>
<p>To see the implementation at a glance let’s have a look at the class diagram:</p>

<p><img src="/images/vpblogimg/2015/10/design-pattern-factory-method-class-diagram-1.png" alt=""></p>

<p>The base abstract class is called ArticleFeedGenerator (it corresponds to <em>Creator</em> in the GoF book). Here’s a shortened version:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">ArticleFeedGenerator</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">SyndicationFeedFormatter</span> <span class="n">_feedFormatter</span><span class="p">;</span>

    <span class="c1">// Factory method</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="n">SyndicationFeedFormatter</span> <span class="nf">CreateFeedFormatter</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">allArticles</span> <span class="p">=</span> <span class="n">_feedDataClient</span><span class="p">.</span><span class="nf">GetAllArticles</span><span class="p">();</span>
        <span class="n">_feed</span> <span class="p">=</span> <span class="n">_feedService</span><span class="p">.</span><span class="nf">GetFeed</span><span class="p">(</span><span class="n">allArticles</span><span class="p">);</span>

        <span class="n">_feedFormatter</span> <span class="p">=</span> <span class="nf">CreateFeedFormatter</span><span class="p">();</span>

        <span class="n">_publishService</span><span class="p">.</span><span class="nf">Publish</span><span class="p">(</span><span class="n">_feedFormatter</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ArticleFeedGenerator does all the work except creating a conccrete implementation of SyndicationFeedFormatter. It delegates it to the derived class who provide the implementation for CreateFeedFormatter abstract method.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5266062674794996" data-ad-slot="9650311114"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>And here comes the concrete implementations (which correspond to <em>ConcreteCreator</em>)</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">AtomFeedGenerator</span> <span class="p">:</span> <span class="n">ArticleFeedGenerator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">AtomFeedGenerator</span><span class="p">(</span>
        <span class="n">IFeedDataClient</span> <span class="n">feedDataClient</span><span class="p">,</span>
        <span class="n">IFeedService</span> <span class="n">feedService</span><span class="p">,</span>
        <span class="n">IPublishService</span> <span class="n">publishService</span><span class="p">,</span>
        <span class="n">IFeedSettings</span> <span class="n">feedSettings</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span> <span class="p">(</span><span class="n">feedDataClient</span><span class="p">,</span> <span class="n">feedService</span><span class="p">,</span> <span class="n">publishService</span><span class="p">,</span> <span class="n">feedSettings</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="n">SyndicationFeedFormatter</span> <span class="nf">CreateFeedFormatter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Atom10FeedFormatter</span><span class="p">(</span><span class="n">_feed</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In order to pass RSS validations RSS formatter needed more “love” than the Atom version above:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">RssFeedGenerator</span> <span class="p">:</span> <span class="n">ArticleFeedGenerator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">RssFeedGenerator</span><span class="p">(</span>
        <span class="n">IFeedDataClient</span> <span class="n">feedDataClient</span><span class="p">,</span>
        <span class="n">IFeedService</span> <span class="n">feedService</span><span class="p">,</span>
        <span class="n">IPublishService</span> <span class="n">publishService</span><span class="p">,</span>
        <span class="n">IFeedSettings</span> <span class="n">feedSettings</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span> <span class="p">(</span><span class="n">feedDataClient</span><span class="p">,</span> <span class="n">feedService</span><span class="p">,</span> <span class="n">publishService</span><span class="p">,</span> <span class="n">feedSettings</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">override</span> <span class="n">SyndicationFeedFormatter</span> <span class="nf">CreateFeedFormatter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">formatter</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Rss20FeedFormatter</span><span class="p">(</span><span class="n">_feed</span><span class="p">);</span>
        <span class="n">formatter</span><span class="p">.</span><span class="n">SerializeExtensionsAsAtom</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">XNamespace</span> <span class="n">atom</span> <span class="p">=</span> <span class="s">"http://www.w3.org/2005/Atom"</span><span class="p">;</span>
        <span class="n">_feed</span><span class="p">.</span><span class="n">AttributeExtensions</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">XmlQualifiedName</span><span class="p">(</span><span class="s">"atom"</span><span class="p">,</span> <span class="n">XNamespace</span><span class="p">.</span><span class="n">Xmlns</span><span class="p">.</span><span class="n">NamespaceName</span><span class="p">),</span> <span class="n">atom</span><span class="p">.</span><span class="n">NamespaceName</span><span class="p">);</span>
        <span class="n">_feed</span><span class="p">.</span><span class="n">ElementExtensions</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">XElement</span><span class="p">(</span><span class="n">atom</span> <span class="p">+</span> <span class="s">"link"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">XAttribute</span><span class="p">(</span><span class="s">"href"</span><span class="p">,</span> <span class="n">_feedSettings</span><span class="p">.</span><span class="n">FeedUrl</span><span class="p">),</span> <span class="k">new</span> <span class="nf">XAttribute</span><span class="p">(</span><span class="s">"rel"</span><span class="p">,</span> <span class="s">"self"</span><span class="p">),</span> <span class="k">new</span> <span class="nf">XAttribute</span><span class="p">(</span><span class="s">"type"</span><span class="p">,</span> <span class="s">"application/rss+xml"</span><span class="p">)));</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Concerete creators create concrete products but the factory method returns the abstract product which ArticleFeedGenerator (abstract creator) works with.</p>

<p>To avoid hard-coding the class name, a helper method called CreateFeedGenerator is added. The client code calls this method to get either a AtomFeedGenerator or a RssFeedGenerator based on configuration value.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">feedSettings</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AppConfigFeedSettings</span><span class="p">();</span>
        <span class="n">ArticleFeedGenerator</span> <span class="n">feedGenerator</span> <span class="p">=</span> <span class="nf">CreateFeedGenerator</span><span class="p">(</span><span class="n">feedSettings</span><span class="p">);</span>
        <span class="n">feedGenerator</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="k">private</span> <span class="k">static</span> <span class="n">ArticleFeedGenerator</span> <span class="nf">CreateFeedGenerator</span><span class="p">(</span><span class="n">IFeedSettings</span> <span class="n">feedSettings</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">feedFormat</span> <span class="p">=</span> <span class="n">feedSettings</span><span class="p">.</span><span class="n">FeedFormat</span><span class="p">;</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">feedFormat</span><span class="p">.</span><span class="nf">ToLower</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">case</span> <span class="s">"atom"</span><span class="p">:</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">AtomFeedGenerator</span><span class="p">(</span><span class="k">new</span> <span class="nf">ApiClient</span><span class="p">(),</span> <span class="k">new</span> <span class="nf">rticleFeedService</span><span class="p">(),</span> <span class="k">new</span> <span class="nf">S3PublishService</span><span class="p">(),</span> <span class="n">feedSettings</span><span class="p">);</span>
            <span class="k">case</span> <span class="s">"rss"</span><span class="p">:</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">RssFeedGenerator</span><span class="p">(</span><span class="k">new</span> <span class="nf">ApiClient</span><span class="p">(),</span> <span class="k">new</span> <span class="nf">ArticleFeedService</span><span class="p">(),</span> <span class="k">new</span> <span class="nf">S3PublishService</span><span class="p">(),</span> <span class="n">feedSettings</span><span class="p">);</span>
            <span class="k">default</span><span class="p">:</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"Unknown feed format"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://github.com/volkanpaksoy/design-pattern-workout" target="_blank" rel="noopener noreferrer">Sample project source code</a></li>
  <li><a href="https://github.com/volkanpaksoy/rss-feed-generator" target="_blank" rel="noopener noreferrer">RSS feed generator source code</a></li>
  <li><a href="http://www.amazon.co.uk/Design-patterns-elements-reusable-object-oriented/dp/0201633612/" target="_blank" rel="noopener noreferrer">Book: GoF Book</a></li>
  <li><a href="http://www.amazon.co.uk/Head-First-Design-Patterns-Freeman/dp/0596007124/" target="_blank" rel="noopener noreferrer">Book: Head First Design Patterns</a></li>
</ul>


		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2015/10/12/design-patterns-strategy/" itemprop="url">Design Patterns: Strategy</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2015-10-12T15:00:00+01:00" itemprop="datePublished">October 12, 2015</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/designdev">design</a></span> -->

<!-- design, dev -->




    <a href="/category/design">design</a>
    , 

    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">design_patterns, csharp</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Often times we need to change some algorithm with another without changing the client code that’s consuming it. In this post I want to show a use case I came across and utilised Strategy pattern.</p>

<h3 id="what-is-it">What is it?</h3>
<p>Here’s the official definition of the pattern from GoF book:</p>

<blockquote>
  <p>Define a family of algorithms, encapsulate each one, and make them interchangeable. Strategy lets the algorithm vary independently from clients that use it.</p>
</blockquote>

<h3 id="use-case-get-external-ip-address">Use case: Get external IP address</h3>
<p>In an application I was working on I needed to get the external IP address of the computer the application is running on. There are various ways to achieve that. This looked like a good opprtunity to use the Strategy pattern as I wanted to be able switch between the different methods easily.</p>

<h3 id="implementation">Implementation</h3>
<p>The interface is quite simple:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IIpCheckStrategy</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="nf">GetExternalIp</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Some services return their data in JSON format, some have extra text in it. But encapsulating the algorithms in their own classes this way, the clint code doesn’t have to worry about parsing these various return values. It’s handled in each class. If one service changes it’s output and breaks the implementation I can recover just by changing the code instantiates the class.</p>

<p>The concrete implementations of the interface are below. They implement the IIpCheckStrategy and are responsible for getting the data and return parsed IP address as string.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5266062674794996" data-ad-slot="9650311114"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>AWS IP Checker:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">AwsIPCheckStrategy</span> <span class="p">:</span> <span class="n">IIpCheckStrategy</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetExternalIp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">client</span><span class="p">.</span><span class="n">BaseAddress</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="s">"http://checkip.amazonaws.com/"</span><span class="p">);</span>
            <span class="kt">string</span> <span class="n">result</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetStringAsync</span><span class="p">(</span><span class="s">""</span><span class="p">).</span><span class="n">Result</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="nf">TrimEnd</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>DynDns IP Checker:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">DynDnsIPCheckStrategy</span> <span class="p">:</span> <span class="n">IIpCheckStrategy</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetExternalIp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">client</span><span class="p">.</span><span class="n">BaseAddress</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="s">"http://checkip.dyndns.org/"</span><span class="p">);</span>
            <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="s">""</span><span class="p">).</span><span class="n">Result</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">HelperMethods</span><span class="p">.</span><span class="nf">ExtractIPAddress</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">().</span><span class="n">Result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Custom IP Checker:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">CustomIpCheckStrategy</span> <span class="p">:</span> <span class="n">IIpCheckStrategy</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetExternalIp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">client</span><span class="p">.</span><span class="n">BaseAddress</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="s">"http://check-ip.herokuapp.com/"</span><span class="p">);</span>
            <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="n">Accept</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>
            <span class="n">client</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="n">Accept</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">MediaTypeWithQualityHeaderValue</span><span class="p">(</span><span class="s">"application/json"</span><span class="p">));</span>

            <span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="s">""</span><span class="p">).</span><span class="n">Result</span><span class="p">;</span>
            <span class="kt">string</span> <span class="n">json</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="nf">ReadAsStringAsync</span><span class="p">().</span><span class="n">Result</span><span class="p">;</span>
            <span class="kt">dynamic</span> <span class="n">ip</span> <span class="p">=</span> <span class="n">Newtonsoft</span><span class="p">.</span><span class="n">Json</span><span class="p">.</span><span class="n">JsonConvert</span><span class="p">.</span><span class="nf">DeserializeObject</span><span class="p">(</span><span class="n">json</span><span class="p">);</span>
            <span class="kt">string</span> <span class="n">result</span> <span class="p">=</span> <span class="n">ip</span><span class="p">.</span><span class="n">ipAddress</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="choosing-the-algorithm">Choosing the algorithm</h3>
<p>The consumer of the algorithm can pick any class that implements IIpCheckStrategy and switch between them. For example:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">StrategyClient1</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Execute</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">IIpCheckStrategy</span> <span class="n">ipChecker</span><span class="p">;</span>

        <span class="n">ipChecker</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DynDnsIPCheckStrategy</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ipChecker</span><span class="p">.</span><span class="nf">GetExternalIp</span><span class="p">());</span>

        <span class="n">ipChecker</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AwsIPCheckStrategy</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ipChecker</span><span class="p">.</span><span class="nf">GetExternalIp</span><span class="p">());</span>

        <span class="n">ipChecker</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CustomIpCheckStrategy</span><span class="p">();</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ipChecker</span><span class="p">.</span><span class="nf">GetExternalIp</span><span class="p">());</span>

        <span class="n">Console</span><span class="p">.</span><span class="nf">ReadKey</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Also the class name to be used can be stored in the configuration in some cases so that it can be changed at runtime without recompiling the application. For instance:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">StrategyClient2</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Execute</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">ipcheckerTypeName</span> <span class="p">=</span> <span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s">"IPChecker"</span><span class="p">];</span>

        <span class="n">IIpCheckStrategy</span> <span class="n">ipchecker</span> <span class="p">=</span> <span class="n">Assembly</span><span class="p">.</span><span class="nf">GetExecutingAssembly</span><span class="p">().</span><span class="nf">CreateInstance</span><span class="p">(</span><span class="n">ipcheckerTypeName</span><span class="p">)</span> <span class="k">as</span> <span class="n">IIpCheckStrategy</span><span class="p">;</span>

        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ipchecker</span><span class="p">.</span><span class="nf">GetExternalIp</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>and the appSettings in the configuration would look like this:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;appSettings&gt;</span>
	<span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">"IPChecker"</span> <span class="na">value=</span><span class="s">"Strategy.AwsIPCheckStrategy"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/appSettings&gt;</span>
</code></pre></div></div>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://github.com/volkanpaksoy/design-pattern-workout" target="_blank" rel="noopener noreferrer">Sample source code</a></li>
  <li><a href="http://www.amazon.co.uk/Head-First-Design-Patterns-Freeman/dp/0596007124" target="_blank" rel="noopener noreferrer">Head First Design Patterns</a></li>
  <li><a href="http://www.amazon.co.uk/Design-patterns-elements-reusable-object-oriented/dp/0201633612" target="_blank" rel="noopener noreferrer">GoF Book: Design Patterns : Elements of Reusable Object-Oriented Software</a></li>
  <li><a href="http://www.pluralsight.com/courses/csharp-design-strategies" target="_blank" rel="noopener noreferrer">Pluralsight course: C# Design Strategies</a></li>
  <li><a href="http://www.dofactory.com/net/strategy-design-pattern" target="_blank" rel="noopener noreferrer">DoFactory Strategy Design Pattern</a></li>
</ul>


		
		
	</div>


    </article>


</div>
<nav id="pagenavi">
    
        <a href="/page/21" class="prev">Prev</a>
    
    
        <a href="/page/23" class="next">Next</a>
    
    <div class="center"><a href="/archive">Blog Archives</a></div>
</nav>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright © 2022 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>

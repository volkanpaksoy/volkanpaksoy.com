<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/page/19/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <script data-ad-client="ca-pub-0414743900624675" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-35583486-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">



    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2016/01/28/weight-tracking-with-fitbit-aria/" itemprop="url">Weight Tracking with Fitbit Aria</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2016-01-28T08:00:00+00:00" itemprop="datePublished">January 28, 2016</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/dev">dev</a></span> -->

<!-- dev -->




    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">csharp, gadget, fitbit, aria</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"What gets measured, gets managed." - Peter Drucker
</code></pre></div></div>

<p>It’s important to have goals, especially <a href="https://en.wikipedia.org/wiki/SMART_criteria" target="_blank" rel="noopener noreferrer">SMART</a> goals. The “M” in S.M.A.R.T. stands for <em>Measurable</em>. Having enough data about a process helps tremendously to improve that process. To this effect, I started to collect exercise data from my Microsoft band which I blogged about <a href="https://volkanpaksoy.com/archive/2016/01/18/playing-with-microsoft-band/">here</a>.</p>

<p>Weight tracking is also crucial for me. I used to record my weight manually on a piece of paper but, for the obvious reasons, I abandoned it quickly and decided to give Fitbit Aria a shot.</p>

<p><img src="/images/vpblogimg/2016/01/fitbit-aria-main.png" alt=""></p>

<h2 id="fitbit-aria-wi-fi-smart-scale">Fitbit Aria Wi-Fi Smart Scale</h2>

<p>Aria is basically a scale that can connect to your Wi-Fi network and send your weight results to Fitbit automatically which can then be viewed via Fitbit web application.</p>

<p><img src="/images/vpblogimg/2016/01/fitbit-aria-dashboard.png" alt=""></p>

<h2 id="setup">Setup</h2>

<p>Since it doesn’t have a keyboard or any other way to interact directly setup is carried out by running a program on your computer</p>

<p><img src="/images/vpblogimg/2016/01/fitbit-aria-setup-page.png" alt=""></p>

<p>It’s mostly just following the steps on the setup tool. You basically let it connect to your Wi-Fi network so that it can synchronize with Fitbit servers.</p>

<p><img src="/images/vpblogimg/2016/01/fitbit-aria-setup-application.png" alt=""></p>

<p>Putting the scale into setup mode proved to be tricky in the past though. Also it was not easy to change Wi-Fi so I had to reset the go back to factory settings and ran the setup tool again.</p>

<h2 id="getting-the-data-via-api">Getting the data via API</h2>

<p>Here comes the fun part! Similar to my <a href="https://github.com/volkanpaksoy/microsoft-band-workout" target="_blank" rel="noopener noreferrer">MS Band workout demo</a>, I developed a WPF program to get my data from Fitbit’s API. Ultimately the goal is to combine all these data in one application and make sense of it.</p>

<p>Like MS Health API, FitBit uses OAuth 2.0 authorization and  requires a registered application.</p>

<p><img src="/images/vpblogimg/2016/01/fitbit-aria-registered-application.png" alt=""></p>

<p>The endpoint that returns weight data accepts a few various formats depending on your needs. As I wanted a range instead of a single day I used the following format:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://api.fitbit.com/1/user/{user ID}/body/log/weight/date/{startDate}/{endDate}.json
</code></pre></div></div>

<p>This call returns an array of the following JSON objects:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
	</span><span class="s2">"bmi"</span><span class="p">:</span><span class="w"> </span><span class="err">xx.xx</span><span class="p">,</span><span class="w">
	</span><span class="s2">"date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"yyyy-mm-dd"</span><span class="p">,</span><span class="w">
	</span><span class="s2">"fat"</span><span class="p">:</span><span class="w"> </span><span class="err">xx.xxxxxxxxxxxxxxx</span><span class="p">,</span><span class="w">
	</span><span class="s2">"logId"</span><span class="p">:</span><span class="w"> </span><span class="err">xxxxxxxxxxxxx</span><span class="p">,</span><span class="w">
	</span><span class="s2">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Aria"</span><span class="p">,</span><span class="w">
	</span><span class="s2">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hh:mm:ss"</span><span class="p">,</span><span class="w">
	</span><span class="s2">"weight"</span><span class="p">:</span><span class="w"> </span><span class="err">xx.xx</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="sample-application">Sample application</h2>

<p>The bulk of the application is very similar to MS Band sample: It first opens an authorization window and once the client consents for the app to be granted some privileges it uses the access token to retrieve the actual data.</p>

<p>There are a few minor differences though:</p>

<ul>
  <li>Unlike MS Health API it requires Authorization header in the authorization code request calls which is basically Base64 encoded client ID and client secret</li>
</ul>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">string</span> <span class="n">base64String</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToBase64String</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">Settings</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">ClientID</span><span class="p">}</span><span class="s">:</span><span class="p">{</span><span class="n">Settings</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">ClientSecret</span><span class="p">}</span><span class="s">"</span><span class="p">));</span>
<span class="n">request</span><span class="p">.</span><span class="nf">AddHeader</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">,</span> <span class="s">$"Basic </span><span class="p">{</span><span class="n">base64String</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>It requires a POST request to redeem URL. Apparently RestSharp has a weird behaviour. You’d think a method called AddBody could be used to send the request body, right? Not quite! It doesn’t transmit the header so I kept getting a missing field error. So instead I used AddParameter:</li>
</ul>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">string</span> <span class="n">requestBody</span> <span class="p">=</span> <span class="s">$"client_id=</span><span class="p">{</span><span class="n">Settings</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">ClientID</span><span class="p">}</span><span class="s">&amp;grant_type=authorization_code&amp;redirect_uri=</span><span class="p">{</span><span class="n">_redirectUri</span><span class="p">}</span><span class="s">&amp;code=</span><span class="p">{</span><span class="n">code</span><span class="p">}</span><span class="s">"</span><span class="p">;</span>
<span class="n">request</span><span class="p">.</span><span class="nf">AddParameter</span><span class="p">(</span><span class="s">"application/x-www-form-urlencoded"</span><span class="p">,</span> <span class="n">requestBody</span><span class="p">,</span> <span class="n">ParameterType</span><span class="p">.</span><span class="n">RequestBody</span><span class="p">);</span>
</code></pre></div></div>

<p>I found a lot of SO questions and a hillarious <a href="http://matthewschrager.com/2013/02/19/restsharp-post-body/" target="_blank" rel="noopener noreferrer">blog post</a> addressing the issue. It’s good to know I wasn’t alone in this!</p>

<p>The rest is very straightforward. Make the request, parse JSON and assign the list to the chart:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">GetWeightData</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">endDate</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Today</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"yyyy-MM-dd"</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">startDate</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Today</span><span class="p">.</span><span class="nf">AddDays</span><span class="p">(-</span><span class="m">30</span><span class="p">).</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"yyyy-MM-dd"</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">url</span> <span class="p">=</span> <span class="s">$"https://api.fitbit.com/1/user/XXXXXX/body/log/weight/date/</span><span class="p">{</span><span class="n">startDate</span><span class="p">}</span><span class="s">/</span><span class="p">{</span><span class="n">endDate</span><span class="p">}</span><span class="s">.json"</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="nf">SendRequest</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>

    <span class="nf">ParseWeightData</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">void</span> <span class="nf">ParseWeightData</span><span class="p">(</span><span class="kt">string</span> <span class="n">rawContent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">weightJsonArray</span> <span class="p">=</span> <span class="n">JObject</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">rawContent</span><span class="p">)[</span><span class="s">"weight"</span><span class="p">].</span><span class="nf">ToArray</span><span class="p">();</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">weightJson</span> <span class="k">in</span> <span class="n">weightJsonArray</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">weight</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FitbitWeightResult</span><span class="p">();</span>
        <span class="n">weight</span><span class="p">.</span><span class="n">Weight</span> <span class="p">=</span> <span class="n">weightJson</span><span class="p">[</span><span class="s">"weight"</span><span class="p">]?.</span><span class="n">Value</span><span class="p">&lt;</span><span class="kt">decimal</span><span class="p">&gt;()</span> <span class="p">??</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">weight</span><span class="p">.</span><span class="n">Date</span> <span class="p">=</span> <span class="n">weightJson</span><span class="p">[</span><span class="s">"date"</span><span class="p">].</span><span class="n">Value</span><span class="p">&lt;</span><span class="n">DateTime</span><span class="p">&gt;();</span>
        <span class="n">WeightResultList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">weight</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And the output is:</p>

<p><img src="/images/vpblogimg/2016/01/fitbit-aria-weight-chart.png" alt=""></p>

<h2 id="conclusion">Conclusion</h2>

<p>So far I managed to collect walking data from MS Band, weight data from Fitbit Aria. In this demo I limited the scope with weight data only but Fitbit API can be used to track sleep, exercise and nutrition.</p>

<p>I currently use My Fitness Pal to log what I eat. They too have an API but even though I requested twice they haven’t given me a key yet! Good news is Fitbit has a key and I can get my MFP logs through Fitbit API. I also log my sleep on Fitbit manually so next step is to combine all these in one application to have a nice overview.</p>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://github.com/volkanpaksoy/fitbit-aria-workout" target="_blank" rel="noopener noreferrer">Source code for demo application </a></li>
  <li><a href="https://en.wikipedia.org/wiki/SMART_criteria" target="_blank" rel="noopener noreferrer">Wikipedia: SMART criteria</a></li>
  <li><a href="https://dev.fitbit.com/docs/" target="_blank" rel="noopener noreferrer">Fitbit API Reference</a></li>
  <li><a href="http://matthewschrager.com/2013/02/19/restsharp-post-body/" target="_blank" rel="noopener noreferrer">RestSharp POST Body Problems</a></li>
  <li><a href="https://www.fitbit.com/uk/setup/aria" target="_blank" rel="noopener noreferrer">Setup application</a></li>
</ul>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2016/01/18/playing-with-microsoft-band/" itemprop="url">Playing with Microsoft Band</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2016-01-18T19:00:00+00:00" itemprop="datePublished">January 18, 2016</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/dev">dev</a></span> -->

<!-- dev -->




    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">csharp, gadget, microsoft_band</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>I bought this about 6 months ago and in this post I’ll talk about my experiences so far. They released version 2 of it in last November so I thought I should write about it before it gets terribly outdated!</p>

<p><img src="/images/vpblogimg/2016/01/ms-band-unboxing.jpg" alt=""></p>

<h2 id="choosing-the-correct-size">Choosing the correct size</h2>

<p>It comes in 3 sizes: Small, Medium and Large and finding the correct size is the first challenge. They seem to have improved the <a href="http://go.microsoft.com/fwlink/?LinkID=627157" target="_blank" rel="noopener noreferrer">sizing guide</a> for version 2. In the original one they didn’t mention the appropriate size for wrist’s circumference.</p>

<p>To have the same effect I followed someone’s advice on a forum regarding the circumferences. Downloaded a <a href="http://printable-ruler.net/" target="_blank" rel="noopener noreferrer">printable ruler</a> to measure mine. It was at the border of medium and laarge and I decided to go with medium but even at the largest setting it’s not comfortable and irritates my skin. Most of the time I have to wear it on top of a <a href="http://www.boots.com/en/Elastoplast-Knee-&amp;-Elbow-Fabric-10-Plasters_1486423/" target="_blank" rel="noopener noreferrer">large plaster</a></p>

<h2 id="wearing-notes">Wearing notes</h2>

<p>I hope they fixed it in v2 but the first generation Band is quite bulky and uncomfortable. To be honest most of the time I just kept wearing it because I had spent £170 and didn’t come to terms with making a terrible investment. I wear it when I’m walking but as soon as I arrive at home or work I take it off because it’s almost impossible to type something with it.</p>

<h2 id="band-in-action">Band in action</h2>

<p>For solely getting fitness data purposes you can use it without pairing with your phone but pairing is helpful as you can read your texts on it, see emails and answer calls.</p>

<p>I also installed the Microsoft Health app and started using Microsoft Health dashboard:</p>

<p><img src="/images/vpblogimg/2016/01/ms-band-ms-health-dashboard.png" alt=""></p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>As soon as I started using it I noticed a discrepancy with the step count on the Microsoft Health dashboard. Turns out by default it was using phone’s motion tracker as well so it was doubling my steps. After I turned it off started getting the exact same results as on Band.</p>

<p><img src="/images/vpblogimg/2016/01/ms-band-turn-off-motion-tracking.png" alt="Turn off motion tracking to get accurate results"></p>

<h2 id="developing-with-band-and-cloud-api">Developing with Band and Cloud API</h2>

<p>Recording data about something helps tremendously to make it manageable. That’s why I like using these health &amp; fitness gadgets. But of course it doesn’t mean much if you don’t make sense of that data.</p>

<p>In my sample application I used Microsoft Health Cloud API to get the Band’s data. In order this to work Band needs to sync with Microsoft Health app on my phone and the app syncs with my MS account.</p>

<p>The API has a great guide <a href="http://developer.microsofthealth.com/Content/docs/MS%20Health%20API%20Getting%20Started.pdf" target="_blank" rel="noopener noreferrer">here</a> that can be downloaded as a PDF. It outlines all the necessary steps very clearly and in detail.</p>

<p>Long story short, firstly you need to go to <a href="https://account.live.com/developers/applications" target="_blank" rel="noopener noreferrer">Microsoft Account Developer Center</a> and register an application. This will give you a client ID and client secret that will be used for OAuth 2.0 authentication.</p>

<p>API uses OAuth 2.0 authentication. After the token has been acquired, using the actual API is quite simple, in my example app I used /Summaries endpoint to get the daily step counts.</p>

<h2 id="implementation">Implementation</h2>

<p>The sample application is a simple WPF desktop application. Upon launch it checks if the user has an access token stored, if not then it shows the OAuth window and the user need to login to their account.</p>

<p><img src="/images/vpblogimg/2016/01/ms-band-oauth-window.png" alt=""></p>

<p>To let the user login to their Microsoft account I added a web browser control to a window and navigated to authorization page:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">string</span> <span class="n">authUri</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="n">baseUrl</span><span class="p">}</span><span class="s">/oauth20_authorize.srf?client_id=</span><span class="p">{</span><span class="n">Settings</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">ClientID</span><span class="p">}</span><span class="s">&amp;scope=</span><span class="p">{</span><span class="n">_scope</span><span class="p">}</span><span class="s">&amp;response_type=code&amp;redirect_uri=</span><span class="p">{</span><span class="n">_redirectUri</span><span class="p">}</span><span class="s">"</span><span class="p">;</span>
<span class="n">webBrowser</span><span class="p">.</span><span class="nf">Navigate</span><span class="p">(</span><span class="n">authUri</span><span class="p">);</span>
</code></pre></div></div>

<p>Once the authorization is complete, the web browser is redirected to with a query parameter <strong>code</strong>. This is not the actual token we need. Now, we need to go to another URL (oauth20_token.srf) with this code and client secret as parameters and redeem the actual access token:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">webBrowser_Navigated</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Navigation</span><span class="p">.</span><span class="n">NavigationEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Uri</span><span class="p">.</span><span class="n">Query</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"code="</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">e</span><span class="p">.</span><span class="n">Uri</span><span class="p">.</span><span class="n">Query</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"lc="</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">code</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">Uri</span><span class="p">.</span><span class="n">Query</span><span class="p">.</span><span class="nf">Substring</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'&amp;'</span><span class="p">)[</span><span class="m">0</span><span class="p">].</span><span class="nf">Split</span><span class="p">(</span><span class="sc">'='</span><span class="p">)[</span><span class="m">1</span><span class="p">];</span>

        <span class="kt">string</span> <span class="n">authUriRedeem</span> <span class="p">=</span> <span class="s">$"/oauth20_token.srf?client_id=</span><span class="p">{</span><span class="n">Settings</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">ClientID</span><span class="p">}</span><span class="s">&amp;redirect_uri=</span><span class="p">{</span><span class="n">_redirectUri</span><span class="p">}</span><span class="s">&amp;client_secret=</span><span class="p">{</span><span class="n">Settings</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">ClientSecret</span><span class="p">}</span><span class="s">&amp;code=</span><span class="p">{</span><span class="n">code</span><span class="p">}</span><span class="s">&amp;grant_type=authorization_code"</span><span class="p">;</span>

        <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RestClient</span><span class="p">(</span><span class="n">baseUrl</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RestRequest</span><span class="p">(</span><span class="n">authUriRedeem</span><span class="p">,</span> <span class="n">Method</span><span class="p">.</span><span class="n">GET</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="p">(</span><span class="n">RestResponse</span><span class="p">)</span><span class="n">client</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">content</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">;</span>

        <span class="c1">// Parse content and get auth code</span>
        <span class="n">Settings</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">AccessToken</span> <span class="p">=</span> <span class="n">JObject</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">content</span><span class="p">)[</span><span class="s">"access_token"</span><span class="p">].</span><span class="n">Value</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
        <span class="n">Settings</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="nf">Save</span><span class="p">();</span>

        <span class="nf">Close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>After we get the authorization out of the way we can actually call the API and get some results. It’s a simple GET call (https://api.microsofthealth.net/v1/me/Summaries/daily) and the response JSON is pretty straightforward. The only thing to keep in mind is to add the access token to Authorization header:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">request</span><span class="p">.</span><span class="nf">AddHeader</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">,</span> <span class="s">$"bearer </span><span class="p">{</span><span class="n">Settings</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
</code></pre></div></div>

<p>Here’s a sample output for a daily summary:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
	</span><span class="s2">"userId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"67491ecc-c408-47b6-a3ad-041edb410524"</span><span class="p">,</span><span class="w">
	</span><span class="s2">"startTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-01-18T00:00:00.000+00:00"</span><span class="p">,</span><span class="w">
	</span><span class="s2">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-01-19T00:00:00.000+00:00"</span><span class="p">,</span><span class="w">
	</span><span class="s2">"parentDay"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-01-18T00:00:00.000+00:00"</span><span class="p">,</span><span class="w">
	</span><span class="s2">"isTransitDay"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
	</span><span class="s2">"period"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Daily"</span><span class="p">,</span><span class="w">
	</span><span class="s2">"duration"</span><span class="p">:</span><span class="w"> </span><span class="s2">"P1D"</span><span class="p">,</span><span class="w">
	</span><span class="s2">"stepsTaken"</span><span class="p">:</span><span class="w"> </span><span class="mi">2784</span><span class="p">,</span><span class="w">
	</span><span class="s2">"caloriesBurnedSummary"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		</span><span class="s2">"period"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Daily"</span><span class="p">,</span><span class="w">
		</span><span class="s2">"totalCalories"</span><span class="p">:</span><span class="w"> </span><span class="mi">1119</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="s2">"heartRateSummary"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		</span><span class="s2">"period"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Daily"</span><span class="p">,</span><span class="w">
		</span><span class="s2">"averageHeartRate"</span><span class="p">:</span><span class="w"> </span><span class="mi">77</span><span class="p">,</span><span class="w">
		</span><span class="s2">"peakHeartRate"</span><span class="p">:</span><span class="w"> </span><span class="mi">88</span><span class="p">,</span><span class="w">
		</span><span class="s2">"lowestHeartRate"</span><span class="p">:</span><span class="w"> </span><span class="mi">68</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="s2">"distanceSummary"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		</span><span class="s2">"period"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Daily"</span><span class="p">,</span><span class="w">
		</span><span class="s2">"totalDistance"</span><span class="p">:</span><span class="w"> </span><span class="mi">232468</span><span class="p">,</span><span class="w">
		</span><span class="s2">"totalDistanceOnFoot"</span><span class="p">:</span><span class="w"> </span><span class="mi">232468</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Since we now have the data, we can visualize it:</p>

<p><img src="/images/vpblogimg/2016/01/ms-band-step-chart.png" alt=""></p>

<p>If you want to play with the sample code don’t forget to register an app and update the settings with your client ID and secret</p>

<h2 id="next">Next</h2>

<p>I guess the most fun would be to develop something that actually runs on the device. My next goal with my Band is to develop a custom tile using its SDK. I hope I can finish it while a first-gen device is still fairly relevant.</p>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://github.com/volkanpaksoy/microsoft-band-workout" target="_blank" rel="noopener noreferrer">Sample project source code</a></li>
  <li><a href="http://go.microsoft.com/fwlink/?LinkID=627157" target="_blank" rel="noopener noreferrer">MS Band Sizing Guide</a></li>
  <li><a href="http://printable-ruler.net/" target="_blank" rel="noopener noreferrer">Online Ruler</a></li>
  <li><a href="http://developer.microsofthealth.com/Content/docs/MS%20Health%20API%20Getting%20Started.pdf" target="_blank" rel="noopener noreferrer">MS Health API Getting Started guide</a></li>
  <li><a href="https://developer.microsoftband.com/cloudAPI/Explorer" target="_blank" rel="noopener noreferrer">Microsoft Health Cloud API reference</a></li>
</ul>


		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2016/01/11/aws-gotchas/" itemprop="url">Top 3 AWS Gotchas</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2016-01-11T18:00:00+00:00" itemprop="datePublished">January 11, 2016</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/aws">aws</a></span> -->

<!-- aws -->




    <a href="/category/aws">aws</a>
    
</span>
	<span class="tags">s3, ec2, eip</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>I’ve been using AWS for a few years now and over the years I noticed there some questions that keep popping up. I was confused by these issues at first and as they look like they are tripping everybody up at some point I decided to compile of a small list of common gotchas. I’ll update this or post another when if I come across more of these.</p>

<h2 id="1-the-s3-folder-delusion">1. The S3 folder delusion</h2>

<p>When you AWS console you can create folders to group objects but this is just a delusion deliberately created by AWS to simplify the usage. In reality, S3 has a flat structure and all the objects are on the same level. Here’s the excerpt from AWS documentation that states this fact:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>In Amazon S3, buckets and objects are the primary resources, where objects are stored in buckets. Amazon S3 has a flat structure with no hierarchy like you would see in a typical file system. However, for the sake of organizational simplicity, the Amazon S3 console supports the folder concept as a means of grouping objects. Amazon S3 does this by using key name prefixes for objects.
</code></pre></div></div>

<p>So essentially AWS is just smart enough to recognize the standard folder notation we’ve been using for ages to make this things easier for us.</p>

<h2 id="2-reserved-instance-confusion">2. Reserved instance confusion</h2>

<p>Reserved instances cost less but require some resource planning and paying some money up-front. Although there is now an option to buy reserved instances with no upfront payment they generally shine on long-term commitments with heavy usage (always-on machines). The confusing bit you don’t reserve actual instances. Unfortunately management console doesn’t do a great job in bridging that gap and when you buy a reserved instance you don’t even know which running instance it covers.</p>

<p>Basically you just buy a subscription for 1 or 3 years and you pay less for any machine that meets that criteria. For instance, say you reserved 1 Linux t1.small instance for 12 months and you are running 2 t1.small Linux instances at the moment. You will pay reserved instance prices for one of them and on-demand price for the other. From a financial point of view it doesn’t matter which one is which. If you shut down one of those instances, again regardless of the instance, you still pay for reserved instance price as it matches your reserved instance criteria.</p>

<p>So that’s all there is to it really. Reserved instance is just about billing and has nothing to do with the actual running instances.</p>

<h2 id="3-publicelastic-ip-uncertainty">3. Public/Elastic IP uncertainty</h2>

<p>There are 3 types of IP addresses in AWS:</p>

<p>Private IPs are internal IP that every instance are assigned. They remain the same throughout the lifespan of the instance and as the name implies they are not addressable from the Internet.</p>

<p>Public IPs are optional. They remain the same as long as the instance is running but they are likely to change after a reboot. So they are not reliable for web-accessible applications.</p>

<p>Elastic IPs are basically static IPs that never change. By default AWS gives up to 5 EIPs. If you need more you have to contact their support. They come free of charge as long as they are associated with a running instance. It costs a small amount if you just want to keep them around without using them though.</p>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="http://docs.aws.amazon.com/AmazonS3/latest/UG/FolderOperations.html" target="_blank" rel="noopener noreferrer">AWS Documentation: Working with Folders</a></li>
  <li><a href="https://aws.amazon.com/ec2/faqs/#Reserved_Instances" target="_blank" rel="noopener noreferrer">Reserved Instances FAQ</a></li>
  <li><a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html" target="_blank" rel="noopener noreferrer">Amazon EC2 Instance IP Addressing</a></li>
</ul>

		
		
	</div>


    </article>


</div>
<nav id="pagenavi">
    
        <a href="/page/18" class="prev">Prev</a>
    
    
        <a href="/page/20" class="next">Next</a>
    
    <div class="center"><a href="/archive">Blog Archives</a></div>
</nav>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright © 2021 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>

<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/page/28/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <script data-ad-client="ca-pub-0414743900624675" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-35583486-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
<br>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0414743900624675" crossorigin="anonymous"></script>
<!-- AdUnit01 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-0414743900624675" data-ad-slot="9604018233" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">



    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2015/03/03/inside-the-graph-cypher/" itemprop="url">Inside the Graph: Cypher</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2015-03-03T16:00:00+00:00" itemprop="datePublished">March  3, 2015</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/dev">dev</a></span> -->

<!-- dev -->




    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">neo4j, graph_databases, cypher</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Visual tools are nice and all but they are not as fun as playing with a query language. When you write your own queries the possibilities are endless! In this post I’ll cover the basics of Cypher query language. Cypher is a declarative, SQL-like, pattern-matching query language for Neo4J graph databases.</p>

<h3 id="basic-crud-operations">Basic CRUD Operations</h3>

<h4 id="match">MATCH</h4>

<p>Match clause allows to define patterns to search the database. It is similar to <em>SELECT</em> in the RDBMS-world.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (n) RETURN n
</code></pre></div></div>

<p>The query above returns all nodes in the database. In this example n is a temporary variable to store the result. The results can be filtered based on labels such as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (n:Person) RETURN n
</code></pre></div></div>

<p>Property-based filters can be used in both MATCH and WHERE clauses. For example the two queries below return the same results:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (n:Movie {title: "Ninja Assassin"})
RETURN n
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (n:Movie)
WHERE n.title = "Ninja Assassin"
RETURN n
</code></pre></div></div>

<p>Instead of returning the entire node we can just select some specific properties. If a node doesn’t have the property it simply returns null.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (a:Person)
RETURN a.name, a.born
</code></pre></div></div>

<p><img src="/images/vpblogimg/2015/03/cypher-query-01.png" alt="Query returning all actors' names and years they were born in"></p>

<p>Results can be filtered by relationships as well. For example the query below returns the movies Tom Hanks acted in</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (p {name:"Tom Hanks"})-[:ACTED_IN]-&gt;(m)
RETURN p, m
</code></pre></div></div>

<p><img src="/images/vpblogimg/2015/03/cypher-query-00.png" alt="Query results for movies Tom Hanks acted in"></p>

<p>Sometimes we might need to learn the relationship from the query. In that case we can use <em>TYPE</em> function to get the name of the relationship:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (a)-[r1]-&gt;(m)&lt;-[r2]-(a)
RETURN a.name, m.title, type(r1), type(r2)
</code></pre></div></div>

<p><img src="/images/vpblogimg/2015/03/cypher-query-02.png" alt="Actors having multiple relationships with the same movie"></p>

<p>Relationship type and direction can be omitted in the queries. The following query returns the names of the movies that have “some sort of relationship” with Tom Hanks:</p>

<p><img src="/images/vpblogimg/2015/03/cypher-query-03.png" alt="Movie with Tom Hanks"></p>

<p><em>OPTIONAL MATCH</em>: OPTIONAL keyword fills in the missing parts in the results with nulls. For example the query below returns 1 row as null because there is no outgoing relationship from the movie <em>The Matrix</em>. If we didn’t use OPTIONAL we would have an empty resultset.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (a:Movie {title: 'The Matrix'})
OPTIONAL MATCH (a)-[]-&gt;(d)
RETURN d  
</code></pre></div></div>

<h4 id="create">CREATE</h4>

<p>To add new data <em>CREATE</em> query is used. In the simplest form the following query creates (a rather useless) node:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE ()
</code></pre></div></div>

<p>Labels and properties can be set while creating new nodes such as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE (a:Actor {name: "Leonard Nimoy", born: 1931, died: 2015})
</code></pre></div></div>

<p>Relationships are created with <em>CREATE</em> as well. For example the following query creates 2 nodes with Person label and creates a <em>MARRIED_TO</em> relationship between them:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE (NedStark:Person {firstname: "Eddard", lastname: "Stark", alias: "Ned", gender: "male"}),
	   (CatelynStark:Person {firstname: "Catelyn", lastname: "Stark", maidenName: "Tully", gender: "female"})
CREATE (NedStark)-[:MARRIED_TO]-&gt;(CatelynStark)
</code></pre></div></div>

<p>Relationships can have properties too:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE
	(WaymarRoyce)-[:MEMBER_OF {order:"Ranger"}]-&gt;(NightsWatch)
</code></pre></div></div>

<p>Properties can be added or updated by using SET keyword such as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (p:Person {firstname: "Eddard"})
SET p.title = "Lord of Winterfell"
RETURN p
</code></pre></div></div>

<p>The above query adds a “title” property to the nodes with label Person and with firstname “Eddard”.</p>

<p>An existing property can be deleted by REMOVE keyword</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (p:Person {firstname: "Eddard"})
REMOVE p.aliasList
</code></pre></div></div>

<h4 id="merge">MERGE</h4>

<p>Merge can be used to create new nodes/relationships or update them if they already exist. In the case of update, all the existing properties must match. For example the following query adds a new property to the node named <em>House Stark of Winterfell</em></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE (houseStark:House {name: "House Stark of Winterfell", words: "Winter is coming"})

MERGE (houseStark {name: "House Stark of Winterfell", words: "Winter is coming"})
SET houseStark.founded = "Age of Heroes"
</code></pre></div></div>

<p>The following one, on the other hand creates a new node with the same name (because the <em>words</em> properties don’t match):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MERGE (houseStark:House {name: "House Stark of Winterfell", words: "Winter is coming!!!"})
SET houseStark.founded = "Age of Heroes"
RETURN houseStark
</code></pre></div></div>

<p>I find helpful when you have a long Cyper query and you might run it multiple times. If you just use CREATE every time you run the query you will end up with new nodes. If you use MERGE it will not give any errors and will not create new nodes.</p>

<p>Another way to prevent this is unique constraints. For example the following query will enforce uniqueness on <em>_id</em> property for nodes labelled as <em>Book</em>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE CONSTRAINT ON (book:Book) ASSERT book._id IS UNIQUE
</code></pre></div></div>

<p>Now we can run this query and create the books:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE 
	(AGameOfThrones:Book {_id: "7abe0a1c-b9bd-4f00-b094-a82dfb32b053", title: "A Game of Thrones", orderInSeries: 1, released:"August 1996"}),
 	(AClashOfKings:Book {_id: "051dae64-dfdb-4134-bc43-f6d2b4b57d37", title: "A Clash of Kings", orderInSeries: 2, released:"November 1998"}),
 	(AStormOfSwords:Book {_id: "e9baa042-2fc8-49a6-adcc-6dd455f0ba12", title: "A Storm of Swords", orderInSeries: 3, released:"August 2000"}),
 	(AFeastOfCrows:Book {_id: "edffaa47-0110-455a-9390-ad8becf5c549", title: "A Feast for Crows", orderInSeries: 4, released:"October 2005"}),
 	(ADanceWithDragons:Book {_id: "5a21b80e-f4c4-4c15-bfa9-1a3d7a7992e3", title: "A Dance with Dragons", orderInSeries: 5, released:"July 2011"}),
 	(TheWindsOfWinter:Book {_id: "77144f63-46fa-49ef-8acf-350cdc20bf07", title: "The Winds of Winter", orderInSeries: 6 })
</code></pre></div></div>

<p>If we try to run it again we get the following error:</p>

<p><img src="/images/vpblogimg/2015/03/cypher-query-04.png" alt="Cypher constraint error"></p>

<p>Unique constraint enforces the existing data to be unique as well. So if we run the book creation query twice, before the constraint, then try to create the constraint we get an error:</p>

<p><img src="/images/vpblogimg/2015/03/cypher-query-05.png" alt=""></p>

<p>To delete the constraint we use DROP keyword such as</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DROP CONSTRAINT ON (book:Book) ASSERT book._id IS UNIQUE
</code></pre></div></div>

<h4 id="delete">DELETE</h4>

<p>To delete nodes first we find them by MATCH. Instead of RETURN in the above examples we use DELETE to remove them.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (b:Book {_id: "7abe0a1c-b9bd-4f00-b094-a82dfb32b053"})
DELETE b
</code></pre></div></div>

<p>The above query would only work if the node doesn’t have any relationships. To delete a node as well as its relationships we can use the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (b {_id: "7abe0a1c-b9bd-4f00-b094-a82dfb32b053"})-[r]-()
DELETE b, r
</code></pre></div></div>

<p>We can generalize the above query to clean the entire database:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (n)
OPTIONAL MATCH (n)-[r]-() 
DELETE n, r
</code></pre></div></div>

<p>I find this quite useful during test and development phase as I need to start over quite often.</p>

<h3 id="useful-keywords">Useful keywords</h3>

<ul>
  <li><strong>ORDER BY</strong></li>
</ul>

<p>It is almost mandatory in all SQL-variants. Eventually you have to sort the data. For example the following returns all actors order by their names in alphabetical order:</p>

<p><img src="/images/vpblogimg/2015/03/cypher-query-07.png" alt=""></p>

<ul>
  <li><strong>LIMIT</strong></li>
</ul>

<p>Sometimes your query may return a lot of values that you’re not interested in. For example you may want to get top n results. In this case you can restrict the number of rows returned by <em>LIMIT</em> keyword such as:</p>

<p><img src="/images/vpblogimg/2015/03/cypher-query-09.png" alt=""></p>

<p>The above query returns the top 3 actors who have the most <em>ACTED_IN</em> relationships with movies in descending order.</p>

<ul>
  <li><strong>UNION</strong></li>
</ul>

<p>Another similar keyword from RDBMS is <em>UNION</em>. Similar to standard SQL, the returned columns must have the same number and names. For example the following will fail:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (p:Person)
RETURN p.name
UNION
MATCH (m:Movie)
RETURN m.title
</code></pre></div></div>

<p><img src="/images/vpblogimg/2015/03/cypher-query-08.png" alt=""></p>

<p>But with using an alias it can be fixed like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MATCH (p:Person)
RETURN p.name AS name
UNION
MATCH (m:Movie)
RETURN m.title AS name
</code></pre></div></div>

<h3 id="measuring-query-performance">Measuring Query Performance</h3>

<p>PROFILE keyword is very helpful as it lets you see the query plan and optimize it. It is very simple to use: You just put it before the MATCH clause such as</p>

<p><img src="/images/vpblogimg/2015/03/cypher-query-06.png" alt=""></p>

<p>This is obviously a very simplistic example but I strongly recommend the <a href="http://graphaware.com/neo4j/2015/01/16/neo4j-graph-model-design-labels-versus-indexed-properties.html" target="_blank" rel="noopener noreferrer">GrapAware article on Labels vs Indexed Properties</a>. PROFILE is heavily used to identify which option performs better in a given scenario. Also a great read to learn more about modelling Neo4J database.</p>

<h3 id="conclusion">Conclusion</h3>

<p>Cypher is quite powerful and it can be very expressive in the right hands. It is quite comprehensive to cover in a blog post. I just wanted this post to contain various samples for the basic queries. I hope it can be of some help for someone new to Cypher in conjunction with the references I listed below.</p>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="http://www.amazon.co.uk/Learning-Cypher-Onofrio-Panzarino/dp/1783287756/" target="_blank" rel="noopener noreferrer">Book: Learning Cypher</a></li>
  <li><a href="http://neo4j.com/developer/cypher-query-language/" target="_blank" rel="noopener noreferrer">Neo4J Cypher Tutorial</a></li>
  <li><a href="http://neo4j.com/docs/stable/cypher-query-lang.html" target="_blank" rel="noopener noreferrer">Neo4J: Cypher Reference</a></li>
  <li><a href="http://assets.neo4j.org/download/Neo4j_CheatSheet_v3.pdf" target="_blank" rel="noopener noreferrer">Neo4J Cyper Cheat Sheet</a></li>
  <li><a href="http://graphaware.com/neo4j/2015/01/16/neo4j-graph-model-design-labels-versus-indexed-properties.html" target="_blank" rel="noopener noreferrer">Article: Modelling Data in Neo4j: Labels vs. Indexed Properties</a></li>
</ul>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2015/02/27/new-aws-features-and-improvements/" itemprop="url">New AWS features and improvements</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2015-02-27T15:00:00+00:00" itemprop="datePublished">February 27, 2015</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/aws">aws</a></span> -->

<!-- aws -->




    <a href="/category/aws">aws</a>
    
</span>
	<span class="tags">news</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>AWS team is certainly keeping themselves very busy. If you turn your head away for a while you end up falling behind the new features. In this post I’ll cover some of the fairly new features and improvements I’ve recently discovered and found useful and interesting.</p>

<h3 id="reserved-instance-pricing-model-improvements">Reserved Instance pricing model improvements</h3>
<p>In the new simplified model they introduced 3 options: <em>No upfront</em>, <em>partial upfront</em> and <em>full upfront</em>. No upfront is a great feature as you don’t need to pay big amounts and just start paying less. Reserved instances are generally great for servers that run 24/7. For example currently if you launch a t2.micro Linux instance in EU-Ireland region you pay $0.014/hour. If you switch to No Upfront option the hourly rate falls to $0.010. (This is assuming the server will run continuously. You pay $7.30/month regardless of the instance’s state.)</p>

<p><img src="/images/vpblogimg/2015/02/aws-reserved-instance-pricing.png" alt="AWS Reserved Instance Pricing"></p>

<h3 id="auto-recovery">Auto recovery</h3>
<p>This is a very cool feature that helps a great deal with system. maintenance. It’s not available in all regions yet (just N. Virginia as of this writing) but I’m guessing it will be rolled out to other regions soon. Now with this feature we can create an alarm for <em>StatusCheckFailed_System</em> metric and select <em>“Recover this instance”</em> as an action</p>

<p><img src="/images/vpblogimg/2015/02/aws-instance-recovery.png" alt="AWS Instance Recovery"></p>

<p>So when a machine is unresponsive it can be restarted automatically. Considering how many issues a simple restart can solve I think it’s a great feature :-)</p>

<h3 id="resource-groups">Resource Groups</h3>
<p>I’ve always found AWS Management Console a very dangerous place as all machines (dev, test prod) are all pooled and listed in the same place. In a careless moment you can easily terminate a production machine instead of a temporary test machine (that’s why I always turn on termination protection).</p>

<p>Resource groups, as the name implies, are meant to group related items. Although it’s primary goal is not to solve the problem I mentioned above (maybe it’s just me who sees it as a problem) but that’s I initially will use it for.</p>

<p><img src="/images/vpblogimg/2015/02/aws-resource-groups-overview.png" alt="AWS Resource Groups Overview"></p>

<p>Using resource groups is dead simple: Just add a tag to your resources (I added one called “type”) and create a resource group and use that tag as a filter. So now instead of listing the entire EC2 instancess I can just click on Dev group and play around with my development servers without even seeing the production machines.</p>

<p><img src="/images/vpblogimg/2015/02/aws-resource-groups-group-details.png" alt="AWS Resource Group Details"></p>

<h3 id="lambda">Lambda</h3>
<p>AWS Lambda is a compute service that allows you to execute your code without launching an EC2 instance. It’s in preview mode at the moment. It’s not meant to run full-blown applications and you have no control over the actual machines running the code. It’s great for simple even-handlers such as triggering a function when an image is uploaded etc. Currently I’m working on an application that’s going to use this service so more on that later.</p>

<h3 id="aurora">Aurora</h3>
<p>I haven’t tried this one myself yet and currently it’s in preview stage. The premise is it’s fully-compatible with MySQL and costs 1/10th of a regular MySQL instance. It’s not quite clear whether it’s a fork of MySQL like MariaDB or just an independent RDBMS but either way being able to use it directly as a MySQL replacement sounds good. As an AWS fan I’m sure performance-wise it would be everything they said it would so no doubts there. I signed up for the preview and waiting for approval. When I get to try it out I will post my impressions as a separate blog post.</p>

<h3 id="conclusion">Conclusion</h3>
<p>There is a big competition going on between the cloud computing platforms these days. Prices are constantly going down and new features are being added so it’s quite a lot of fun to follow the news in this market. I’ll try to keep an eye on new AWS features more closely from now on.</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://aws.amazon.com/blogs/aws/simplified-reserved-instances/" target="_blank" rel="noopener noreferrer">Announcement for the new reserved instance pricing model</a></li>
  <li><a href="http://aws.amazon.com/ec2/purchasing-options/reserved-instances/" target="_blank" rel="noopener noreferrer">Reserved instance pricing</a></li>
  <li><a href="http://docs.aws.amazon.com/awsconsolehelpdocs/latest/gsg/resource-groups.html" target="_blank" rel="noopener noreferrer">Documentation: Working with Resource Groups</a></li>
  <li><a href="http://aws.amazon.com/lambda/" target="_blank" rel="noopener noreferrer">AWS Lambda</a></li>
  <li><a href="http://aws.amazon.com/rds/aurora/" target="_blank" rel="noopener noreferrer">AWS Aurora</a></li>
</ul>


		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2015/02/25/beware-the-pineapple-an-overview-of-wifi-pineapple-mark-v/" itemprop="url">Beware the Pineapple: An overview of WiFi Pineapple Mark V</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2015-02-25T14:30:00+00:00" itemprop="datePublished">February 25, 2015</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/security">security</a></span> -->

<!-- security -->




    <a href="/category/security">security</a>
    
</span>
	<span class="tags">gadget, wifi_pineapple</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Wifi Pineapple has been around for quite some time now. Almost two years ago I posted a short review <a href="https://volkanpaksoy.com/archive/2013/04/22/wifi-pineapple/">here</a> but with the latest version (Mark V) it’s got badder than ever and they keep adding more features so it’s a nice time to catch up.</p>

<h3 id="what-is-it">What is it?</h3>
<p>Basically Wifi Pineapple is a WiFi honeypot that allows users to carry out man-in-the-middle attacks. Connected clients’ traffic go through the attacker which makes the attacker capable of pulling a number of tricks.</p>

<p>Mark IV was based on <a href="http://www.amazon.co.uk/ALFA-Network-AP121U-Wireless-Repeater/dp/B00RKPD6MM" target="_blank" rel="noopener noreferrer">Alfa AP121U</a>. Instead of buying a pineapple you could just buy an AP121U and create your own DIY pineapple by installing the firmware. Mark V, on the other hand, is a whole new animal.</p>

<p><img src="/images/vpblogimg/2015/02/wifi-pineapple-features.png" alt="Wifi Pineapple Mark V"></p>

<p>Equipped with 2 radios it can work in client mode meaning it can piggyback on a nearby WiFi network and bridge the victim’s connections (In Mark IV the only way to provide internet access was 3G which is also still supported).</p>

<h3 id="how-does-it-work">How does it work?</h3>

<p>At the heart of the pineapple lies an attack method called Karma. It works by exploiting trusting devices to probe requests and responses. Our wireless devices, by default, constantly try to connect to the last networks they were on. To accomplish this they actively scan their neighbourhood by sending out probe requests. (A probe request is a special frame sent by a client station requesting information from either a specific access point, specified by SSID, or all access points in the area, specified with the broadcast SSID.)</p>

<p>Normally, access points (AP) that don’t broadcast the requested SSID just ignore the probe request. The <em>correct</em> AP responds with a probe response and the client initiates association with the AP again. That’s how we connect to our home or work network as soon as we arrive. That is convenient and user-friendly but the malicious devices running Karma attack can break this “honor-code” based system. The pineapple responds to whatever AP the device is asking for therefore deceiving it into believing they are home.</p>

<h3 id="whats-the-risk">What’s the risk</h3>

<p>Obviously these honeypots are set up for a reason: To get your traffic. Once you start sending your data through the attacker’s system you are opening yourself to all sorts of attacks. One of the most important ones is called sslstrip. (These “attacks” are called <em>infusions</em> in Pineapple parlance and they can be downloaded and installed in seconds to enhance its capabilities which makes the pineapple an even more powerful weapon)</p>

<p>sslstrip redirects your HTTPS traffic to HTTP equivalent (i.e. You land on http://www.google.com even though you requested https://www.google.com). So when you login to your favorite social network you essentially hand over your credentials to the attacker in plain text.</p>

<p>You can find a full list of available infusions <a href="https://www.wifipineapple.com/?infusions" target="_blank" rel="noopener noreferrer">here</a> which can give you an idea what types of attacks are possible.</p>

<h3 id="whats-new">What’s New</h3>

<p>As of Version 2 of the Pineapple firmware a new feature is introduced: <em>PineAP</em>. They define it as “the next-gen rogue AP”.</p>

<p>As Karma attack became more popular vendors started to increase security a little bit. Instead of sending out all the SSIDs that the device has connected in the past, the device simply sends a probe request that says “Broadcast” and the APs respond with a beacon with their information and what SSID(s) they are broadcasting. Then the client can decide which one to connect to. This method mitigates the regular Karma attack. To mitigate this mitigation (!) Pineapple team came up with PineAP.</p>

<p>PineAP has several modules:</p>

<ul>
  <li>
    <p><strong>Beacon Response</strong>      <br>
Similar to probe responses this module sends beacons. For example if the client is looking for “Home Sweet Home” network, Karma sends a probe response with this SSID and at Beacon Response module sends a beacon with the same SSID making the pineapple look more legitimate.</p>
  </li>
  <li>
    <p><strong>Dogma</strong>
This module sends out beacon frames of SSIDs selected by the attacker (defined in the PineAP SSID Pool). It also allows targeted attacks so you can set the target MAC address.</p>
  </li>
  <li>
    <p><strong>Auto Harvester</strong>
Since SSID names are more likely to be kept as a secret it helps to collect this information. Harvester collects leaking SSIDs from the potential clients. They are added to the SSID pool to be used by Dogma.</p>
  </li>
</ul>

<h3 id="further-improvements-and-new-features">Further Improvements and new features</h3>

<ul>
  <li><strong>Setup screen</strong></li>
</ul>

<p>A neat feature is, as an extra security step, when you first setup and connect to your pineapple you have to enter a random LED pattern.</p>

<p><img src="/images/vpblogimg/2015/02/wifi-pineapple-led-pattern.png" alt="LED Pattern"></p>

<p>As a fan of multi-factor authentication of all sorts I loved the idea of using the physical hardware to improve security.</p>

<ul>
  <li><strong>Management network</strong></li>
</ul>

<p>New Pineapple can setup a secure Wifi AP just for the owner so that you don’t have to connect via Ethernet. You can use your phone to check who is connected to the network and manage the pineapple completely by using the responsive UI.</p>

<ul>
  <li><strong>Recon mode</strong></li>
</ul>

<p>This is another neat feature that allows to scan all AP and clients around. You can even carry out a deauth attack by just clicking on a client.</p>

<h3 id="mitigations">Mitigations</h3>

<ul>
  <li>
    <p><strong>Never connect to open networks, NEVER!</strong>: If you are in the habit of using open wifi networks one day you might come across one of those pineapples in your coffee shop and hand over your data unknowingly to a guy sitting in the table next to you! Even without this risk you should never use networks that you have no control over but this kind of risk makes it even more important.</p>
  </li>
  <li>
    <p><strong>Verify SSL</strong>: SSL/TLS is still the most important security measure we have when connecting to websites. Always ensure that you are connected to the right website by checking the certificate. An attacker may not be able to break SSL certificate but they can simply bypass it completely by tools like sslstrip. It’s especially important in mobile devices since they tend to hide the address bar to make more room for the content so generally you never know the exact URL you are sending your requests to.</p>
  </li>
  <li>
    <p><strong>VPN</strong>: If you are using VPN your traffic is encrypted and sent through a secure channel. In this case, even if an attacker is able to get your traffic they will not be able to make any sense of it.</p>
  </li>
  <li>
    <p><strong>HSTS</strong>: This mechanism allows web servers to declare that web browsers (or other complying user agents) should only interact with it using secure HTTPS connections and never via the insecure HTTP protocol. It helps to mitigate the risks of tools like sslstrip. Downside is it’s not currently adopted by all browsers at the moment.</p>
  </li>
</ul>

<h3 id="conclusion">Conclusion</h3>
<p>Wireless networks provide great convenience to us but comes with risks and vulnerabilities (as all conveniences in IT). The hardware is getting smaller and more powerful everyday so the tools like Wifi Pineapple are getting more threatening. It’s important to keep an eye on what kind of risks are out there and learn how to avoid those risks.</p>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://www.wifipineapple.com/" target="_blank" rel="noopener noreferrer">Official website</a></li>
  <li><a href="http://hak5.org/category/episodes/pineapple-university" target="_blank" rel="noopener noreferrer">Hak5 Pineapple University</a></li>
  <li><a href="https://www.youtube.com/watch?v=40Igim3upL0" target="_blank" rel="noopener noreferrer">YouTube Video: WiFi Pineapple 2.0.2 Firmware - PineAP</a></li>
  <li><a href="https://scotthelme.co.uk/wifi-pineapple-karma-sslstrip/" target="_blank" rel="noopener noreferrer">Using Karma and SSLStrip to MitM Secure Connections</a></li>
  <li><a href="http://hak5.org/episodes/haktip-23" target="_blank" rel="noopener noreferrer">Haktip 23 – WiFi 101: Probe Requests and Responses</a></li>
  <li><a href="http://www.thoughtcrime.org/software/sslstrip/" target="_blank" rel="noopener noreferrer">BlackHat Presentation on SSL Stripping</a></li>
  <li><a href="http://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security" target="_blank" rel="noopener noreferrer">Wikipedia article on HSTS</a></li>
</ul>

		
		
	</div>


    </article>


</div>
<nav id="pagenavi">
    
        <a href="/page/27" class="prev">Prev</a>
    
    
        <a href="/page/29" class="next">Next</a>
    
    <div class="center"><a href="/archive">Blog Archives</a></div>
</nav>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright © 2021 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>

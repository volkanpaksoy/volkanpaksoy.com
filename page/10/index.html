<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/page/10/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <!-- <script data-ad-client="ca-pub-0414743900624675" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> -->
  <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996"
  crossorigin="anonymous"></script> -->

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-35583486-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@volkan_paksoy">
  <meta name="twitter:creator" content="@Volkan Paksoy">
  <meta name="twitter:title"   content="">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary">
  <meta name="twitter:image" content=""> -->
  
  <!-- end of Twitter cards -->


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
<br>
<br>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>

<!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0414743900624675"
     crossorigin="anonymous"></script> -->
<!-- AdUnit01 -->
<!-- <ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-0414743900624675"
     data-ad-slot="9604018233"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script> -->
</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">



    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2019/02/25/Dockerizing-Applications/" itemprop="url">Dockerizing Applications</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2019-02-25T06:00:00+00:00" itemprop="datePublished">February 25, 2019</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/dockerdevops">docker</a></span> -->

<!-- docker, devops -->




    <a href="/category/docker">docker</a>
    , 

    <a href="/category/devops">devops</a>
    
</span>
	<span class="tags">github, backup</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>A while back I created a PowerShell script to backup my GitHub account and blogged about it <a href="https://volkanpaksoy.com/archive/2017/11/30/Backing-up-GitHub-Account-with-PowerShell/">here</a>. It’s working fine but it requires some manual installation and setup and I didn’t want to do that every time I needed to deploy it to a new machine. That’s why I decided to Dockerize my script so that everything required can come in an image pre-installed.</p>

<p>TL;DR:</p>

<ul>
  <li>There’s a Powershell script that allows you to back up your GitHub account including private repositories here: <a href="https://github.com/volkanpaksoy/github-backup" target="_blank" rel="noopener noreferrer">Source Code</a>
</li>
  <li>There’s a Docker image that encapsulates the same script which can be found here: <a href="https://hub.docker.com/r/volkanpaksoy/github-backup" target="_blank" rel="noopener noreferrer">Docker Image</a>
</li>
  <li>Below are my notes on Docker that I’ve been taking while working on Docker-related projects. Proceed if are interested in some random tidbits about Docker.</li>
</ul>

<h2 id="lessons-learned-on-docker">Lessons Learned on Docker</h2>
<ul>
  <li>
    <p>Shortcut to leave container without stopping it: Ctrl P + Ctrl Q</p>
  </li>
  <li>
    <p>Build a new image from the contents of the current folder</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker image build -t {image_name} .
</code></pre></div>    </div>
  </li>
  <li>
    <p>Every RUN command creates a new layer in the image. Image layers are read-only.</p>
  </li>
  <li>
    <p>Connect to an already running container:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker attach {container id or name}
</code></pre></div>    </div>
  </li>
  <li>
    <p>Save a running container as an image:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker commit -p 78727078a04b container1
</code></pre></div>    </div>
  </li>
  <li>
    <p>Remove image</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker rmi {image name}
</code></pre></div>    </div>

    <p>This requires the image doesn’t have any containers created off of it. To delete multiple images based on name:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker rmi $(docker images | grep 'imagename')
</code></pre></div>    </div>
  </li>
  <li>
    <p>List running containers</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker container ls
</code></pre></div>    </div>
  </li>
  <li>
    <p>To list all containers including the stopped ones:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker ps -a
</code></pre></div>    </div>
  </li>
  <li>
    <p>Delete all stopped containers</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker container prune
</code></pre></div>    </div>
  </li>
  <li>
    <p>To delete all unused containers, images, volumes, networks:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker system prune
</code></pre></div>    </div>
  </li>
  <li>
    <p>Copy files to and from a container</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker cp foo.txt mycontainer:/foo.txt
  docker cp mycontainer:/foo.txt foo.txt
</code></pre></div>    </div>
  </li>
  <li>
    <p>To overwrite the entrypoint and get an interactive shell</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker run -it --entrypoint "/bin/sh" {image name}
</code></pre></div>    </div>
  </li>
  <li>
    <p>Tip to quickly operate on images/containers: Just enter the first few letters of the image/container. For example if your docker ps -a returns something like this</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  1184d20ee824        b2789ef1b26a                  "/bin/sh -c 'ssh-k..."   18 hours ago        Exited (1) 46 seconds ago                         happy_saha
  7823f76352e3        github-backup-04              "/bin/sh"                18 hours ago        Exited (255) 21 minutes ago                       objective_thompson
</code></pre></div>    </div>

    <p>you can start the first container by entering</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker start 11
</code></pre></div>    </div>

    <p>This is of course provided that there aren’t any other containers whose ID start with 11. So no need to enter the full ID as long as the beginning is unique.</p>
  </li>
  <li>
    <p>To get detailed info about an object</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker inspect {object id}
</code></pre></div>    </div>

    <p>This returns all the details. If you interested in specific details you can  tailor the output by using –format option. For example the following only returns the LogPath for the container:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>	
    docker inspect --format '{{ .LogPath  }}'  {container id}
	
</code></pre></div>    </div>
  </li>
  <li>
    <p>To get the logs of the container:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker logs --details --timestamps  {container id}
</code></pre></div>    </div>
  </li>
  <li>
    <p>Docker for Mac actually runs inside a Linux VM. All docker data is stored inside a file called Docker.qcow2. The paths that are returned are relative paths in this VM. For instance if you inspect the LogPath of a container it would look something like</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  /var/lib/docker/containers/{container-id}/{container-id}-json.log
</code></pre></div>    </div>

    <p>But if you check your host machine, there is no /var/lib/docker folder.</p>

    <p>In Docker preferences it shows where the disk image is located:</p>

    <p><img src="/images/vpblogimg/2019/02/dockerizing-applications-docker-image-location.png" alt=""></p>

    <p>This command let me to go into VM</p>
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  screen  ~/Library/Containers/com.docker.docker/Data/com.docker.driver.amd64-linux/tty
</code></pre></div>    </div>

    <p>Then I was able to navigate to /var/lib/docker and peek inside the volumes where the data is persisted. This virtualization does not exist in Linux and you can view everything on the host machine straight away.</p>
  </li>
  <li>
    <p>Enter a running container (Docker 1.3+):</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker exec -it {container-id} bash
</code></pre></div>    </div>
  </li>
  <li>
    <p>Copy an image from one host to another: Export vs Save</p>

    <p><strong>Save</strong>, saves a non-running container image to a file:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker save -o &lt;save image to path&gt; &lt;image name&gt;
  docker load -i &lt;path to image tar file&gt;
</code></pre></div>    </div>

    <p><strong>Export</strong>, saves a container’s running or paused instance to a file</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  docker export {container-id} | gzip &gt; {tar file path}
  docker import {tar file path}
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://github.com/volkanpaksoy/github-backup" target="_blank" rel="noopener noreferrer">Source Code</a></li>
  <li><a href="https://hub.docker.com/r/volkanpaksoy/github-backup" target="_blank" rel="noopener noreferrer">Docker Image</a></li>
  <li><a href="http://containertutorials.com/alpine/get_started.html" target="_blank" rel="noopener noreferrer">Getting Started with Alpine</a></li>
  <li><a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="noopener noreferrer">Best practices for writing Dockerfiles</a></li>
  <li><a href="https://github.com/wsargent/docker-cheat-sheet" target="_blank" rel="noopener noreferrer">Docker Cheat Sheet</a></li>
  <li><a href="https://www.pluralsight.com/courses/docker-deep-dive" target="_blank" rel="noopener noreferrer">PluralSight Course: Docker - Deep Dive</a></li>
  <li><a href="https://www.pluralsight.com/courses/docker-containers-big-picture" target="_blank" rel="noopener noreferrer">PluralSight Course: Docker and Containers - The Big Picture</a></li>
  <li><a href="http://www.starkandwayne.com/blog/bash-for-loop-over-json-array-using-jq/" target="_blank" rel="noopener noreferrer">Blog post: Bash for loop over json array using jq</a></li>
  <li><a href="https://www.tobetester.com/how-to-find-docker-volume-on-host-machine/" target="_blank" rel="noopener noreferrer">How to find Docker volume on host machine</a></li>
  <li><a href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/services/" target="_blank" rel="noopener noreferrer">How services work</a></li>
</ul>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2019/02/22/Setting-Up-New-EBS-Volume-in-EC2/" itemprop="url">Setting Up a New EC2 Linux Instance</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2019-02-22T06:00:00+00:00" itemprop="datePublished">February 22, 2019</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/linuxaws">linux</a></span> -->

<!-- linux, aws -->




    <a href="/category/linux">linux</a>
    , 

    <a href="/category/aws">aws</a>
    
</span>
	<span class="tags">ec2, ebs</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>I recently decided to purchase a reserved t3.nano instance to run some Docker containers and for general testing purposes. In addition to the default volume I decided to add a new one to separate my files from the OS. It required a few steps to get everything in place so I decided to post this mostly for future reference!</p>

<h2 id="attach-a-volume-during-creation">Attach a volume during creation</h2>
<p>First I added a new volume to the instance while creating it.</p>

<p><img src="/images/vpblogimg/2019/02/Setting-Up-New-EBS-Volume-in-EC2-Add-Storage.png" alt=""></p>

<h2 id="connecting-to-instance">Connecting to instance</h2>
<p>Now we have to connect to the instance to format the new volume. To achieve that we must have access to the private we generated while we created the instance. So to SSH into the machine we run this command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh -i {/Path/To/Key/file_name.pem} ec2-user@{public DNS name of the instance}
</code></pre></div></div>

<h2 id="format-the-volume">Format the volume</h2>
<p>I found some AWS documentation to achieve this which was very useful: <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-using-volumes.html" target="_blank" rel="noopener noreferrer">Making an Amazon EBS Volume Available for Use on Linux</a></p>

<p>No need to repeat every command in that documentation. It’s a simple step-by-step guide. Just follow it and you have a volume in use which is also mounted at start up.</p>

<h2 id="install-and-configure-docker">Install and configure Docker</h2>
<p>Installing Docker is as simple as running this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum update -y
sudo yum install -y docker
</code></pre></div></div>

<p>To be able to use Docker without sudoing everything ad ec2-user to docker group:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo usermod -aG docker ec2-user
</code></pre></div></div>

<p>We need to make sure that Docker daemon starts on reboot too. To achieve this run this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl enable docker
</code></pre></div></div>

<h2 id="copy-files-to-the-instance">Copy files to the instance</h2>
<p>To copy some files to the new instance I used SCP command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo scp -i {/Path/To/Key/file_name.pem} -r {/Path/To/Local/Folder/} ec2-user@{public DNS name of the instance}:/Remote/Folder
</code></pre></div></div>

<p>The issue was ec2-user didn’t initially have access to write on the remote folder. In that case you can run  the following command to have access:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setfacl -m u:ec2-user:rwx /Remote/Folder
</code></pre></div></div>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-using-volumes.html" target="_blank" rel="noopener noreferrer">Making an Amazon EBS Volume Available for Use on Linux</a></li>
</ul>


		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2019/01/22/Auditing-AWS-events-with-CloudTrail/" itemprop="url">Auditing AWS events with CloudTrail</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2019-01-22T06:00:00+00:00" itemprop="datePublished">January 22, 2019</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/awssecurity">aws</a></span> -->

<!-- aws, security -->




    <a href="/category/aws">aws</a>
    , 

    <a href="/category/security">security</a>
    
</span>
	<span class="tags">cloudtrail, audit</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Another important service under Management &amp; Governance category is CloudTrail.</p>

<p><img src="/images/vpblogimg/common/aws/aws-cloudtrail.png" alt=""></p>

<p>A nice thing about this service is that it’s already enabled by default with a limited capacity. You can view all AWS API calls made in your account within the last 90 days. This is completely free and enabled out of the box.</p>

<p><img src="/images/vpblogimg/2019/01/aws-cloudtrail-01-free.png" alt=""></p>

<p>To get more out of CloudTrail we need to create <em>trails</em></p>

<h2 id="inside-trails">Inside Trails</h2>

<p>A couple of options about trails:</p>

<ul>
  <li>It can apply to all regions</li>
  <li>It can apply to all accounts in an organization</li>
  <li>It can record all management events</li>
  <li>It can record data events from S3 and Lambda functions</li>
</ul>

<p>Just be mindful about the possible extra charges when you log every event for all organization accounts:</p>

<p><img src="/images/vpblogimg/2019/01/aws-cloudtrail-02-org-charges.png" alt=""></p>

<h2 id="testing-the-logs">Testing the logs</h2>
<p>I created a trail that logs all events for all organization accounts. I created an IAM user in another account in the organization. In the event history of the local account events look like this:</p>

<p><img src="/images/vpblogimg/2019/01/aws-cloudtrail-03-local-events.png" alt=""></p>

<p>These events now can be tracked from master account as well. In the S3 bucket these events are organized by account id and date and they are stored in JSON format:</p>

<p><img src="/images/vpblogimg/2019/01/aws-cloudtrail-04-viewing-logs.png" alt=""></p>

<h2 id="conclusion">Conclusion</h2>
<p>Having a central storage of all events in across all regions and accounts is a great tool to have. Having the raw data is a good start but making sense of that data is even more important. I’ll keep on exploring CloudTrail and getting more out of it to harden my accounts.</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://aws.amazon.com/cloudtrail/" target="_blank" rel="noopener noreferrer">AWS Official CloudTrail page</a></li>
</ul>

		
		
	</div>


    </article>


</div>
<nav id="pagenavi">
    
        <a href="/page/9" class="prev">Prev</a>
    
    
        <a href="/page/11" class="next">Next</a>
    
    <div class="center"><a href="/archive">Blog Archives</a></div>
</nav>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright © 2021 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>

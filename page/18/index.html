<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/page/18/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <script data-ad-client="ca-pub-0414743900624675" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-35583486-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
<br>
<br>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0414743900624675" crossorigin="anonymous"></script>
<!-- AdUnit01 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-0414743900624675" data-ad-slot="9604018233" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">



    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2016/04/12/swift-notes-the-basics/" itemprop="url">Swift Notes - The Basics</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2016-04-12T06:00:00+01:00" itemprop="datePublished">April 12, 2016</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/dev">dev</a></span> -->

<!-- dev -->




    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">ios, swift</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>When I started learning Swift for iOS development I also started to  compile some notes along the way. This post is the first instalment of my notes. First some basic concepts (in no particular order):</p>

<h2 id="repl">REPL</h2>
<ul>
  <li>Swift supports REPL (Read Evaluate Print Loop) and you can write code and get feedback very quickly this way by using XCode Playground or command line.</li>
</ul>

<p><img src="/images/vpblogimg/2016/04/swift-notes-the-basics-playground-repl.png" alt=""></p>

<p>As seen in the screenshot there is no need to explicitly print the values, they are automatically displayed on the right-hand side of the screen.</p>

<p><img src="/images/vpblogimg/2016/04/swift-notes-the-basics-command-line.png" alt=""></p>

<p>It can also be executed without specifying the interpreter by adding #!/usr/bin/swift at the top of the file.</p>

<h2 id="comments">Comments</h2>
<p>Swift supports C-style comments like // for single-line comments and /* */ for multi-line comments.</p>

<p>The great thing about the multi-line comments is that you can nest them. For example the following is a valid comment:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* This is a 
    /* valid mult-line */
    comment that is not available in C#
*/</span>
</code></pre></div></div>
<p>Considering how many times Visual Studio punished me while trying to comment out a block of code that had multi-line comments in it, this feature looks fantastic!</p>

<p>It also supports doc comments (///) and supports markdown. It even supports emojis (Ctrl + Cmd + Space for the emoji keyboard)</p>

<p><img src="/images/vpblogimg/2016/04/swift-notes-the-basics-comments.png" alt=""></p>

<h2 id="imports">Imports</h2>
<p>Standard libraries are imported automatically but the main frameworks such as Foundation, UIKit need to be imported explicitly.</p>

<p>Swift 2 supports a new type of import which is preceded by @testable keyword.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@testable</span> <span class="kd">import</span> <span class="kt">CustomFramework</span>
</code></pre></div></div>

<p>It allows to access non-public members of a class. So that you can access them externally from a unit test project. Before this they all needed to be public in order to be testable.</p>

<h2 id="strings">Strings</h2>
<p>Built-in string type is String. There is also NSString in the Foundation framework. They can be used interchangably sometimes, for example you can assign a String to a NSString but the opposite is not valid. You have cast it explicitly to String first:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="k">var</span> <span class="nv">string</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">"swiftString"</span>
<span class="k">var</span> <span class="nv">nsString</span> <span class="p">:</span> <span class="kt">NSString</span> <span class="o">=</span> <span class="s">"foundationString"</span>

<span class="n">nsString</span> <span class="o">=</span> <span class="n">string</span> <span class="c1">// Works fine</span>
<span class="n">string</span> <span class="o">=</span> <span class="n">nsString</span> <span class="k">as</span> <span class="kt">String</span> <span class="c1">// Wouldn't work without the cast</span>
</code></pre></div></div>

<ul>
  <li>startIndex is not an int but an object. To get the next character</li>
</ul>

<p>s[s.startIndex.successor()]</p>

<p>To get the last character</p>

<p>s[s.startIndex.predecessor()]</p>

<p>For a specific position s[advance(s.startIndex, 1)]</p>

<h2 id="let-vs-var">let vs. var</h2>
<p>Values created with <strong>let</strong> keyword are immutable. So let is used to create constants. Variables can be created with <strong>var</strong> keyword. If you create a value</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">x1</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">x1</span> <span class="o">=</span> <span class="mi">8</span> <span class="c1">// won't compile</span>

<span class="k">var</span> <span class="nv">x2</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">x2</span> <span class="o">=</span> <span class="mi">11</span> <span class="c1">// this works</span>
</code></pre></div></div>

<p>The same principle applies to arrays:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">x3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">x3</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="c1">// no go!</span>
</code></pre></div></div>

<h2 id="type-conversion">Type conversion</h2>

<p>Types are inferred and there is no need to declare them while declaring a variable.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">someInt</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">let</span> <span class="nv">someDouble</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="n">someDouble</span> <span class="o">+</span> <span class="kt">Double</span><span class="p">(</span><span class="n">someInt</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="structs-and-classes">Structs and Classes</h2>

<ul>
  <li>
    <p>Structs are value objects and a copy of the value is passed around. Classess are reference objects.</p>
  </li>
  <li>
    <p>Constructors are called initializers and they are special methods named <em>init</em>. Must specify an init method or default values when declaring the class.</p>
  </li>
</ul>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">Person</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>
  <span class="k">var</span> <span class="nv">age</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="nf">init</span> <span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">age</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>There is no <em>new</em> operator. So declaring a new object looks simply like this:</li>
</ul>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">p</span> <span class="o">=</span> <span class="kt">Person</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>The equivalent of <em>destructor</em> is <em>deinit</em> method. Only classes can have deinitializers.</li>
</ul>

<h2 id="collections">Collections</h2>

<h3 id="array-an-ordered-list-of-items">Array: An ordered list of items</h3>

<ul>
  <li>
    <p>An empty array xan be declared in a verbose way such as</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">n</span> <span class="o">=</span> <span class="kt">Array</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">()</span>
</code></pre></div>    </div>

    <p>or with the shorthand notation</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">n</span> <span class="o">=</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]()</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>An array with items can be intialized with</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">n</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Arrays can be concatenated with +=</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="n">n</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Items can be added by <em>append</em> method</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="n">n</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Items can be inserted to a specific index</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="n">n</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nv">atIndex</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c1">// -&gt; "[1, 2, 3, 8, 4, 5, 6, 7]"</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Items can be deleted by removeAtIndex</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="n">n</span><span class="o">.</span><span class="nf">removeAtIndex</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c1">// -&gt; "[1, 2, 3, 8, 4, 5, 7]"</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Items can be accessed by their index</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">let</span> <span class="nv">aNumber</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>A range of items can be replaced at once</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">n</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
  <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="o">...</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c1">// prints [1, 5, 6, 7, 4]"</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>2-dimensional arrays can be declared as elements as arrays and multiple subscripts can be used to access sub items</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">n</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="p">]</span>
  <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="c1">// value 2</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="dictionary-a-collection-of-key-value-pairs">Dictionary: A collection of key-value pairs</h3>

<ul>
  <li>
    <p>Can be initialized without items</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">dict</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span><span class="kt">Int</span><span class="p">]()</span>
</code></pre></div>    </div>

    <p>or with items</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">dict</span> <span class="o">=</span> <span class="p">[</span><span class="s">"key1"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">"key2"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">"key3"</span><span class="p">:</span> <span class="mi">4</span><span class="p">]</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>To add items, assign a value to a key using subscript syntax</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="n">dict</span><span class="p">[</span><span class="s">"key4"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">666</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>To remove an item, assign nil</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="n">dict</span><span class="p">[</span><span class="s">"key2"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">dict</span><span class="p">)</span> <span class="c1">// prints ["key1": 5, "key4": 666, "key3": 4]"</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>To update a value, subscript can be used as adding the item or <em>updateValue</em> method can be called.</p>

    <p><em>updateValue</em> returns an optional. If it didn‚Äôt update anything the optional has nil in it. So it can be used to check the value was actually updated or not.</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">result</span> <span class="o">=</span> <span class="n">dict</span><span class="o">.</span><span class="nf">updateValue</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"key2"</span><span class="p">)</span>
  <span class="k">if</span> <span class="k">let</span> <span class="nv">r</span> <span class="o">=</span> <span class="n">result</span> <span class="p">{</span>
      <span class="nf">print</span> <span class="p">(</span><span class="n">dict</span><span class="p">[</span><span class="s">"key2"</span><span class="p">])</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nf">print</span> <span class="p">(</span><span class="s">"could not update"</span><span class="p">)</span> <span class="c1">// --&gt; This line would be printed</span>
  <span class="p">}</span>	
</code></pre></div>    </div>

    <p>The interesting behaviour is that if it can‚Äôt update it, it will add the new value.</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">dict</span> <span class="o">=</span> <span class="p">[</span><span class="s">"key1"</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s">"key2"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s">"key3"</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
  <span class="k">var</span> <span class="nv">result</span> <span class="o">=</span> <span class="n">dict</span><span class="o">.</span><span class="nf">updateValue</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"key4"</span><span class="p">)</span>
  <span class="k">if</span> <span class="k">let</span> <span class="nv">r</span> <span class="o">=</span> <span class="n">result</span> <span class="p">{</span>
      <span class="nf">print</span> <span class="p">(</span><span class="n">dict</span><span class="p">[</span><span class="s">"key4"</span><span class="p">])</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nf">print</span> <span class="p">(</span><span class="s">"could not update"</span><span class="p">)</span>
  <span class="p">}</span>
	
  <span class="nf">print</span><span class="p">(</span><span class="n">dict</span><span class="p">)</span> <span class="c1">// prints "["key1": 5, "key4": 45, "key2": 3, "key3": 4]"</span>
                <span class="c1">// key4 has been added after calling updateValue</span>
</code></pre></div>    </div>

    <p>After a successful update it would return the old value</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="n">result</span> <span class="o">=</span> <span class="n">dict</span><span class="o">.</span><span class="nf">updateValue</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"key1"</span><span class="p">)</span>
  <span class="k">if</span> <span class="k">let</span> <span class="nv">r</span> <span class="o">=</span> <span class="n">result</span> <span class="p">{</span>
      <span class="nf">print</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="c1">// --&gt; This would run and print "5"</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nf">print</span> <span class="p">(</span><span class="s">"could not update"</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div>    </div>

    <p>This is consistent with the unsuccessful update returning nil. It always returns the former value.</p>
  </li>
  <li>
    <p>To get a value subscript syntax is used</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">i</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"key1"</span><span class="p">]</span> <span class="c1">// 45</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="set-an-unordered-list-of-distinct-values">Set: An unordered list of distinct values</h3>

<ul>
  <li>
    <p>Initialization notation is similar to the others</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">emo</span> <span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">Character</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[</span> <span class="s">"üò°"</span><span class="p">,</span> <span class="s">"üòé"</span><span class="p">,</span> <span class="s">"üò¨"</span> <span class="p">]</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>If duplicate items are added it doesn‚Äôt throw an error but prunes the list automatically</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">emo</span> <span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">Character</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[</span> <span class="s">"üò°"</span><span class="p">,</span> <span class="s">"üòé"</span><span class="p">,</span> <span class="s">"üò¨"</span><span class="p">,</span> <span class="s">"üò¨"</span> <span class="p">]</span>
  <span class="n">emo</span><span class="o">.</span><span class="n">count</span> <span class="c1">// prints 3</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>New items can be added with insert method</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">var</span> <span class="nv">emo</span> <span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">Character</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[</span> <span class="s">"üò°"</span><span class="p">,</span> <span class="s">"üòé"</span><span class="p">,</span> <span class="s">"üò¨"</span><span class="p">,</span> <span class="s">"üò¨"</span> <span class="p">]</span>
  <span class="n">emo</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="s">"üò±"</span><span class="p">)</span>
  <span class="n">emo</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="s">"ü§î"</span><span class="p">)</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">emo</span><span class="p">)</span> <span class="c1">// prints "["üò±", "üòé", "ü§î", "üò¨", "üò°"]"</span>
</code></pre></div>    </div>

    <p>There is no atIndex parameter like array and the index is unpredicatable as shown above</p>
  </li>
</ul>

<p>Among the three, only arrays have ordered and can have repeated values.</p>

<h2 id="miscellaneous">Miscellaneous</h2>

<ul>
  <li>
    <p>Semi-colons are not required at the end of each line</p>
  </li>
  <li>
    <p>Supports string interpolation</p>
  </li>
  <li>
    <p>Swift uses reference counting and there is garbage collection.</p>
  </li>
  <li>
    <p>Curly braces are required even if there is only one statement inside the body. For instance the following block wouldn‚Äôt compile:</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">10</span>
      <span class="nf">print</span><span class="p">(</span><span class="s">"Ten!"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><em>println</em> function has been renamed to <em>print</em>. <em>print</em> adds a new line to the end automatically. This behaviour can be overriden by explicitly specfying appendNewLine attribute</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="nf">print</span> <span class="p">(</span><span class="s">"Hello, world without a new line"</span><span class="p">,</span> <span class="nv">appendNewLine</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>#available can be used to check compatibility</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">if</span> <span class="kd">#available(iOS 9, *)</span> <span class="p">{</span>
      <span class="c1">// use NSDataAsset</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Panic!</span>
  <span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Range can be checked with ‚Ä¶ and ~= operators. For example:</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="mi">10</span>
	
  <span class="k">if</span> <span class="mi">1</span><span class="o">...</span><span class="mi">100</span> <span class="o">~=</span> <span class="n">x</span> <span class="p">{</span>
      <span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div>    </div>

    <p>The variable is on the right in this expression. It wouldn‚Äôt compile the other way around.</p>
  </li>
  <li>
    <p>There is Range object that can be used to define, well, ranges!</p>

    <div class="highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  var ageRange = 18...45
  print(ageRange) // prints "18..&lt;46"
  print(ageRange.count) // prints "28"
</code></pre></div>    </div>

    <p>The other range operator is ..&lt; which doesn‚Äôt include the end value</p>

    <div class="highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  var ageRange = 18..&lt;45
  ageRange.contains(45) // prints "false"
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="http://swiftlang.eu/" target="_blank" rel="noopener noreferrer">Official Swift Programming Language Book</a></li>
  <li><a href="https://www.pluralsight.com/courses/swift-in-depth" target="_blank" rel="noopener noreferrer">Pluralsight Course: Swift in Depth</a></li>
  <li><a href="https://www.udacity.com/course/learn-swift-programming-syntax--ud902" target="_blank" rel="noopener noreferrer">Udacity Course: Learn Swift Programming Syntax</a></li>
</ul>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2016/03/30/checking-domain-availability-with-aws-route53-part-4/" itemprop="url">Checking domain availability with AWS Route 53 Part 4: AngularJS Client</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2016-03-30T11:00:00+01:00" itemprop="datePublished">March 30, 2016</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/devaws">dev</a></span> -->

<!-- dev, aws -->




    <a href="/category/dev">dev</a>
    ,¬†

    <a href="/category/aws">aws</a>
    
</span>
	<span class="tags">route53, angularjs</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Previously in this series:</p>

<ul>
  <li><a href="https://volkanpaksoy.com/archive/2015/08/04/checking-domain-availability-with-aws-route53-part-1">Part 1: Getting TLD List</a></li>
  <li><a href="https://volkanpaksoy.com/archive/2015/08/06/checking-domain-availability-with-aws-route53-part-2">Part 2: Implementing API for TLD service</a></li>
  <li><a href="https://volkanpaksoy.com/archive/2015/08/08/checking-domain-availability-with-aws-route53-part-3">Part 3: Consuming the APIs with Console Client</a></li>
</ul>

<p>So far I was using the console client but I thought I chould use a prettier web-based-UI and came up with this:</p>

<p><a href="https://domchk53.com" target="_blank" rel="noopener noreferrer"><img src="/images/vpblogimg/2016/03/domchk53-mainview.png" alt="DomChk53 AngularJS Client"></a></p>

<p>It‚Äôs using AngularJS and Bootstrap which significantly improved the development process.</p>

<p>API in the backend is AWS API Gateway on a custom domain (api.domchk53.com) and using Lambda functions to do the actual work. One great thing about API Gatewayis that it‚Äôs very easy to set requests rates:</p>

<p><img src="/images/vpblogimg/2016/03/domchk53-APIGatewayLimits.png" alt=""></p>

<p>Currently I set it to max 5 requests per second. I chose this value because of the limitation on AWS API as stated <a href="http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/DNSLimitations.html" target="_blank" rel="noopener noreferrer">here</a>:</p>

<blockquote>
  <p>All requests ‚Äì Five requests per second per AWS account. If you submit more than five requests per second, Amazon Route 53 returns an HTTP 400 error (Bad request). The response header also includes a Code element with a value of Throttling and a Message element with a value of Rate exceeded.</p>
</blockquote>

<p>Of course limiting this on the client side assumes a single client so you may still get ‚ÄúRate exceeded‚Äù errors even if running single query at a time. I‚Äôm planning to implement a Node server using SQS to move the queue to server side but that‚Äôs not one of my priorities right now.</p>

<p>The Lambda function is straightforward enough. Just calls the checkDomainAvailability API method with the supplied parameters:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">AWS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'aws-sdk'</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
	    <span class="na">region</span><span class="p">:</span> <span class="s2">"us-east-1"</span>
	<span class="p">}</span>
	
	<span class="kd">var</span> <span class="nx">route53domains</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">Route53Domains</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">DomainName</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">domain</span> <span class="o">+</span> <span class="s1">'.'</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">tld</span>
    <span class="p">};</span>

    <span class="nx">route53domains</span><span class="p">.</span><span class="nx">checkDomainAvailability</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">context</span><span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="na">Domain</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">domain</span><span class="p">,</span>
                <span class="na">Tld</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">tld</span><span class="p">,</span>
                <span class="na">CheckDate</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
                <span class="na">RequestResult</span><span class="p">:</span> <span class="s2">"OK"</span><span class="p">,</span>
                <span class="na">Availability</span><span class="p">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">Availability</span>
            <span class="p">};</span>
            
            <span class="nx">context</span><span class="p">.</span><span class="nx">succeed</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>  
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="usage">Usage</h2>
<p>I wanted this tool as an improvement to AWS already provides. What you can do with Management Console is search a single domain and it searches it against the popular 13 TLDs. If you need anything outside these 13 you have to pick them manually.</p>

<p>In DomChk53 you can search multiple domain names at once against all supported TLDs (293 as of this writing).</p>

<p><img src="/images/vpblogimg/2016/03/domchk53-multipledomainsandTLDs.png" alt=""></p>

<p>Also you can group TLDs into lists so you can for example search the most common ones (com, net, co.uk etc.) and say finance related ones (money, cash, finance etc.). Depending on the domain name one group may be more relevant.</p>

<p><img src="/images/vpblogimg/2016/03/domchk53-NewList.PNG" alt=""></p>

<p>You can cancel a query at any time to avoid wasting precious requests if you change your mind about the domain.</p>

<p><img src="/images/vpblogimg/2016/03/domchk53-CancelWaitingRequests.png" alt=""></p>

<h2 id="whats-missing">What‚Äôs missing</h2>
<p>For a while I‚Äôm planning to leave it as is but when I have it in me to revisit the project I will implement:</p>

<ul>
  <li>Server-side queueing of requests</li>
  <li>The option to export/email the results in PDF format</li>
</ul>

<p>I‚Äôm also open to other suggestions‚Ä¶</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://github.com/volkanpaksoy/domchk53" target="_blank" rel="noopener noreferrer">DomChk53 Source Code</a></li>
  <li><a href="https://domchk53.com" target="_blank" rel="noopener noreferrer">DomChk53 Live Site</a></li>
  <li><a href="http://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-custom-domains.html" target="_blank" rel="noopener noreferrer">Use a Custom Domain Name in API Gateway</a></li>
  <li><a href="http://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-cors.html" target="_blank" rel="noopener noreferrer">Enable CORS for a Method in API Gateway</a></li>
  <li><a href="http://docs.aws.amazon.com/Route53/latest/DeveloperGuide/DNSLimitations.html" target="_blank" rel="noopener noreferrer">AWS Documentation on account limits</a></li>
</ul>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2016/03/18/dynamic-dns-with-aws-route-53-part-2-angular-client/" itemprop="url">Dynamic DNS with AWS Route 53 - Part 2: AngularJS Client</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2016-03-18T13:00:00+00:00" itemprop="datePublished">March 18, 2016</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/awsdev">aws</a></span> -->

<!-- aws, dev -->




    <a href="/category/aws">aws</a>
    ,¬†

    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">route53, angularjs</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>I‚Äôve been using my own dynamic DNS application (which I named <a href="https://dyndns53.com" target="_blank" rel="noopener noreferrer">DynDns53</a> and blogged about it <a href="https://volkanpaksoy.com/archive/2015/08/12/dynamic-dns-with-aws-route53/">here</a>). So far it had a WPF application and I was happy with it but I thought if I could develop a web-based application I wouldn‚Äôt have to install anything (which is what I‚Äôm shooting for these days) and achieve the same results.</p>

<p>So I built a JavaScript client with AngularJS framework. The idea is exactly the same, the only difference is it‚Äôs all happening inside the browser.</p>

<p><img src="/images/vpblogimg/2016/03/dyndns53-angularjs-client-overview.png" alt="DynDns53 web client"></p>

<h2 id="ingredients">Ingredients</h2>
<p>To have a dynamic DNS client you need to have the following</p>

<ol>
  <li>A way to get your external IP address</li>
  <li>A way to update your DNS record</li>
  <li>An application that performs Step 1 &amp; 2 perpetually</li>
</ol>

<h2 id="step-1-getting-the-ip-address">Step 1: Getting the IP Address</h2>
<p>I have done and blogged about this several times now. (Feels like I‚Äôm repeating myself a bit, I guess I have to find something original to work with. But first I have to finish this project and have closure!)</p>

<p>Since it‚Äôs a simple GET request it sounds easy but I quickly hit the <a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing" target="_blank" rel="noopener noreferrer">CORS</a> wall when I tried the following bit:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">'ExternalIP'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$http</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$http</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'http://checkip.amazonaws.com'</span><span class="p">,</span> <span class="p">{</span> <span class="na">cache</span><span class="p">:</span> <span class="kc">false</span> <span class="p">});</span>
<span class="p">});</span> 
</code></pre></div></div>

<p>In my WPF client I can call whatever service I want whenever I want but when running inside the browser things are a bit different. So I decided to take a detour and create my own service that allowed cross-origin resource sharing.</p>

<h2 id="aws-lambda--api-gateway">AWS Lambda &amp; API Gateway</h2>

<p>First I thought I could do it even without Lambda function by using the HTTP proxy integration. I could return what the external site returns:</p>

<p><img src="/images/vpblogimg/2016/03/dyndns53-external-ip-http-proxy.png" alt=""></p>

<p>Unfortunately this didn‚Äôt work because it was returning the IP of the AWS machine that‚Äôs actually running the API gateway. So I had to get the client‚Äôs IP from the request and send it back in my own Lambda function.</p>

<p><img src="/images/vpblogimg/2016/03/dyndns53-external-ip-api.png" alt=""></p>

<p>Turns out in order to get HTTP headers you need to fiddle with some <a href="http://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-mapping-template-reference.html" target="_blank" rel="noopener noreferrer">template mapping</a> and assign the client‚Äôs IP address to a variable:</p>

<p><img src="/images/vpblogimg/2016/03/dyndns53-external-ip-template-mapping.png" alt=""></p>

<p>This can be later referred to in the Lambda function through <em>event</em> parameter:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">succeed</span><span class="p">({</span>
        <span class="s2">"ip"</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">ip</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And now that we have our own service we can allow CORS and be able call it from our client inside the browser:</p>

<p><img src="/images/vpblogimg/2016/03/dyndns53-external-ip-enable-cors.png" alt=""></p>

<h2 id="step-2-updating-dns">Step 2: Updating DNS</h2>
<p>This bit is very similar to WPF version. Instead of using the AWS .NET SDK I just used the JavaScript SDK. AWS has a great <a href="https://sdk.amazonaws.com/builder/js/" target="_blank" rel="noopener noreferrer">SDK builder</a> which lets you to select the pieces you need:</p>

<p><img src="/images/vpblogimg/2016/03/dyndns53-update-dns-sdk-builder.png" alt=""></p>

<p>It also shows if the service supports CORS. It‚Äôs a relief that Route53 does so we can keep going.</p>

<p>The whole source code is on <a href="https://github.com/volkanpaksoy/dyndns53" target="_blank" rel="noopener noreferrer">GitHub</a> but here‚Äôs the gist of it: Loop through all the subdomains, get all the resource records in the zone, find the matching record and update it with the new IP:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">updateAllDomains</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">angular</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">$rootScope</span><span class="p">.</span><span class="nx">domainList</span><span class="p">.</span><span class="nx">domains</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$scope</span><span class="p">.</span><span class="nx">updateDomainInfo</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">.</span><span class="nx">zoneId</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">}</span> 
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">updateDomainInfo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">domainName</span><span class="p">,</span> <span class="nx">zoneId</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">'accessKeyId'</span><span class="p">:</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">accessKey</span><span class="p">,</span>
      <span class="s1">'secretAccessKey'</span><span class="p">:</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">secretKey</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">route53</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">Route53</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">HostedZoneId</span><span class="p">:</span> <span class="nx">zoneId</span>
    <span class="p">};</span>

    <span class="nx">route53</span><span class="p">.</span><span class="nx">listResourceRecordSets</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> 
          <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">'rootScope:log'</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">angular</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">ResourceRecordSets</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">Name</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nx">domainName</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">externalIPAddress</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
                <span class="nx">ExternalIP</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
                     <span class="nx">externalIPAddress</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">ip</span><span class="p">;</span>
                     <span class="nx">$scope</span><span class="p">.</span><span class="nx">changeIP</span><span class="p">(</span><span class="nx">domainName</span><span class="p">,</span> <span class="nx">zoneId</span><span class="p">,</span> <span class="nx">externalIPAddress</span><span class="p">)</span>
                 <span class="p">});</span>
              <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">changeIP</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">domainName</span><span class="p">,</span> <span class="nx">zoneId</span><span class="p">,</span> <span class="nx">newIPAddress</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">'accessKeyId'</span><span class="p">:</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">accessKey</span><span class="p">,</span>
      <span class="s1">'secretAccessKey'</span><span class="p">:</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">secretKey</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">route53</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">Route53</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">ChangeBatch</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">Changes</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">Action</span><span class="p">:</span> <span class="s1">'UPSERT'</span><span class="p">,</span>
            <span class="na">ResourceRecordSet</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">Name</span><span class="p">:</span> <span class="nx">domainName</span><span class="p">,</span>
              <span class="na">Type</span><span class="p">:</span> <span class="s1">'A'</span><span class="p">,</span>
              <span class="na">TTL</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
              <span class="na">ResourceRecords</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span>
                  <span class="na">Value</span><span class="p">:</span> <span class="nx">newIPAddress</span>
                <span class="p">}</span>
              <span class="p">]</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="na">HostedZoneId</span><span class="p">:</span> <span class="nx">zoneId</span>
    <span class="p">};</span>

    <span class="nx">route53</span><span class="p">.</span><span class="nx">changeResourceRecordSets</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> 
        <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">'rootScope:log'</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span> 
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span> 
        <span class="kd">var</span> <span class="nx">logMessage</span> <span class="o">=</span> <span class="s2">"Updated domain: "</span> <span class="o">+</span> <span class="nx">domainName</span> <span class="o">+</span> <span class="s2">" ZoneID: "</span> <span class="o">+</span> <span class="nx">zoneId</span> <span class="o">+</span> <span class="s2">" with IP Address: "</span> <span class="o">+</span> <span class="nx">externalIPAddress</span><span class="p">;</span>
        <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">'rootScope:log'</span><span class="p">,</span> <span class="nx">logMessage</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>The only part that trippped me up was that I wasn‚Äôt setting the TTL in the changeResourceRecordSets parameters and I was getting an error but found a <a href="http://stackoverflow.com/questions/31559137/getting-invalidinput-error-on-changeresourcerecordsets" target="_blank" rel="noopener noreferrer">StackOverflow question</a> that helped to get past the issue.</p>

<h2 id="step-3-a-tool-to-bind-them">Step 3: A tool to bind them</h2>
<p>Now the fun part: An AngularJS client to call these services. I guess the UI is straight-forward. Basically it just requires the user to enter AWS IAM keys and domains to update.</p>

<p>I didn‚Äôt want to deal with the hassle of sending the keys to a remote server and host them securely. Instead I thought it would be simpler just to use browser‚Äôs local storage with HTML5. This way the keys never leave the browser.</p>

<p>It also only updates the IP address if it has changed so saves unnecessary API calls.</p>

<p>Also it‚Äôs possible to view what‚Äôs going on in the event log area.</p>

<p><img src="/images/vpblogimg/2015/08/dyndns53-angularjs-client-settings-and-event-log.png" alt=""></p>

<p>I guess I can have my closure now and move on!</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://github.com/volkanpaksoy/dyndns53" target="_blank" rel="noopener noreferrer">DynDns53 Source code</a></li>
  <li><a href="http://stackoverflow.com/questions/31559137/getting-invalidinput-error-on-changeresourcerecordsets" target="_blank" rel="noopener noreferrer">StackOverflow question regarding TTL</a></li>
  <li><a href="https://sdk.amazonaws.com/builder/js/" target="_blank" rel="noopener noreferrer">AWS JavaScript SDK Builder</a></li>
  <li><a href="http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/Route53.html" target="_blank" rel="noopener noreferrer">AWS Route53 SDK Documentation</a></li>
  <li><a href="http://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-mapping-template-reference.html" target="_blank" rel="noopener noreferrer">API Gateway Mapping Template Reference</a></li>
  <li><a href="https://volkanpaksoy.com/archive/2015/08/12/dynamic-dns-with-aws-route53/">DynDns53 introduction blog post</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing" target="_blank" rel="noopener noreferrer">CORS Wikipedia article</a></li>
</ul>

		
		
	</div>


    </article>


</div>
<nav id="pagenavi">
    
        <a href="/page/17" class="prev">Prev</a>
    
    
        <a href="/page/19" class="next">Next</a>
    
    <div class="center"><a href="/archive">Blog Archives</a></div>
</nav>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright ¬© 2021 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>

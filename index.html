<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996"
  crossorigin="anonymous"></script>

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-35583486-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@volkan_paksoy">
  <meta name="twitter:creator" content="@Volkan Paksoy">
  <meta name="twitter:title"   content="">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary">
  <meta name="twitter:image" content=""> -->
  
  <!-- end of Twitter cards -->


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
<br>
<br>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
<!-- vp.com - default -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5266062674794996" data-ad-slot="6750480330" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">



    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2021/09/06/Using-Raspberry-Pi-as-Plex-Server/" itemprop="url">Using Raspberry Pi as Plex Server</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2021-09-06T07:00:00+01:00" itemprop="datePublished">September  6, 2021</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/hobby">hobby</a></span> -->

<!-- hobby -->




    <a href="/category/hobby">hobby</a>
    
</span>
	<span class="tags">raspberry_pi, plex, media_server</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p><img src="/images/vpblogimg/2021/09/plex-server/01-required-hardware-01.jpg" alt=""></p>

<p>Raspberry Pis these days are powerful computers that can run a lot of tasks at home with very efficient electricity usage. In this post I’m going to show how to use a Raspberry Pi 4 8GB as a Plex server and serve your own media files in your own network.</p>

<h2 id="hardware">Hardware</h2>
<ul>
  <li>Raspberry Pi 4 (8 GB)</li>
  <li>Argon ONE case (with M.2 adapter)</li>
  <li>M.2 SATA SSD (1TB)</li>
  <li>Standard pi power supply</li>
</ul>

<p><img src="/images/vpblogimg/2021/09/plex-server/02-required-hardware-02.jpg" alt=""></p>

<h2 id="getting-started">Getting Started</h2>
<p>In this project I used an <a href="https://www.argon40.com/argon-one-m-2-case-for-raspberry-pi-4.html" target="_blank" rel="noopener noreferrer">Argon ONE M.2 Case for Raspberry Pi 4</a> as it allowed me to use an SSD drive with the Pi which is a lot faster than a microSD card.</p>

<p>Argon ONE comes with a comprehensive used guide and take about 10 minutes to put everything together so it’s not too different than using a regular Pi case. The added benefits are:</p>

<ul>
  <li>You get to use a M.2 SATA SSD (Be mindful about the SATA here. It doesn’t work with NVMe SSDs even though it fits. So make sure to buy a M.2 SATA SSD)</li>
  <li>You get 2 full-sized HDMI ports instead of the micro ones that come with a Pi 4</li>
</ul>

<p>The final build looks like this with a 5-bay YottaMaster enclosure attached to it:</p>

<p><img src="/images/vpblogimg/2021/09/plex-server/03-final-build-with-external-sata-enclosure.jpg" alt=""></p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5266062674794996" data-ad-slot="9650311114"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h2 id="software-installation">Software Installation</h2>
<p>The easiest installation way I could find is downloading the Plex Media Server for Linux package from <a href="https://www.plex.tv/media-server-downloads/#plex-media-server" target="_blank" rel="noopener noreferrer">Plex Downloads Page</a></p>

<p>First choose Linux from the OS list</p>

<p><img src="/images/vpblogimg/2021/09/plex-server/04-plex-download-01.png" alt=""></p>

<p>and click Choose Distribution</p>

<p><img src="/images/vpblogimg/2021/09/plex-server/05-plex-download-02.png" alt=""></p>

<p>Once you’ve downloaded the installation package right click and select <em>Package install</em></p>

<p>After the installation open http://localhost:32400/web and you’re ready to go!</p>

<h2 id="plex-account">Plex Account</h2>
<p>I already had an account so I just logged in with my credentials. This automatically adds the new server to your account so you can see the libraries in other server instances in your account as well.</p>

<h2 id="file-share">File Share</h2>
<p>Because I attached a 5-bay hard drive enclosure to the Pi, I wanted to use it for a general file server as well. This also helps if your media files are located somewhere else on the network and you want to copy them over the network if you’re not able to attach the source drive directly to the Plex Server Pi.</p>

<p>To create the file server I followed this guide to install Samba on my Pi: <a href="https://magpi.raspberrypi.org/articles/samba-file-server" target="_blank" rel="noopener noreferrer">Samba: Set up a Raspberry Pi as a File Server for your local network</a></p>

<h2 id="troubleshoot-file-permission-issue">Troubleshoot File Permission Issue</h2>
<p>One issue I had when I tried to add some test folders was that Plex wasn’t able to list the folders in a selected drive. I found the solution here: <a href="https://unix.stackexchange.com/questions/559299/plex-media-server-cannot-see-sub-folders-permissions-issue" target="_blank" rel="noopener noreferrer">Plex Media Server cannot see sub folders.. Permissions issue?</a></p>

<p>Basically added the permissions to the folders in the path as shown in the accepted answer:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo chmod a+rX /mnt
sudo chmod a+rX /mnt/sda
sudo chmod a+rX /mnt/sda/will
</code></pre></div></div>

<h2 id="client">Client</h2>
<p>I’m not going to go into much detail on the client side as there are a vast number of ways to consume content from a Plex Server. In my case, I’m using a Kodi on another Raspberry Pi and as soon as I added the new Plex Server to my Plex account I was able to view the content on my client Kodi Pi.</p>

<h2 id="conclusion">Conclusion</h2>
<p>Overall it was quite straightforward as the server package came ready to install. The only issue I had was to figure out the folder permission issue and after that’s been resolved I was able to enjoy a brand new Plex Server instance in my own network. Hope this helps if you’re after similar results.</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://www.argon40.com/argon-one-m-2-case-for-raspberry-pi-4.html" target="_blank" rel="noopener noreferrer">Argon ONE M.2 Case for Raspberry Pi 4</a></li>
  <li><a href="https://www.plex.tv/media-server-downloads/#plex-media-server" target="_blank" rel="noopener noreferrer">Plex Downloads Page</a></li>
  <li><a href="https://magpi.raspberrypi.org/articles/samba-file-server" target="_blank" rel="noopener noreferrer">Samba: Set up a Raspberry Pi as a File Server for your local network</a></li>
  <li><a href="https://unix.stackexchange.com/questions/559299/plex-media-server-cannot-see-sub-folders-permissions-issue" target="_blank" rel="noopener noreferrer">Plex Media Server cannot see sub folders.. Permissions issue?</a></li>
</ul>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2021/08/31/Using-Dymo-LabelWriter-450-with-a-Raspberry-Pi/" itemprop="url">Using Dymo LabelWriter 450 with a Raspberry Pi</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2021-08-31T07:00:00+01:00" itemprop="datePublished">August 31, 2021</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/hobby">hobby</a></span> -->

<!-- hobby -->




    <a href="/category/hobby">hobby</a>
    
</span>
	<span class="tags">raspberry_pi, productivity, dymo, labelwriter_450</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>I have a Dymo LabelWriter 450 for years and I love using it. Especially it worked a miracle recently when I organised all ny shelves and bagged and labelled everything. To have the ability of keeping the printer online all the time and print easily I decided to plug it in a Raspberry Pi and share over the network. The steps below explain how it can be done easily:</p>

<h2 id="step-01-plug-in-the-printer-to-the-pi-via-usb">Step 01: Plug in the printer to the Pi via USB</h2>
<p>Simply plug it in and power it on.</p>

<h2 id="step-02">Step 02:</h2>
<ul>
  <li>Click Pi -&gt; Preferences -&gt; Add / Remove Software</li>
  <li>Search “dymo”</li>
  <li>Tick the checkbox next to “printer driver for DYMO label printers”</li>
  <li>Click Apply and wait for the installation to complete</li>
</ul>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/01-add-drivers.jpg" alt=""></p>

<h2 id="step-03-configure-printer">Step 03: Configure printer</h2>
<ul>
  <li>On the Pi itself, open a browser and go to “http://localhost:631”</li>
</ul>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/02-configure-printer.jpg" alt=""></p>

<ul>
  <li>Click Administration and Add Printer. In the username/password prompt, use the account you used to log in (most likely username “pi”)</li>
</ul>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/03-printer-administration.jpg" alt=""></p>

<ul>
  <li>You should see DYMO printer in the list of Local Printers</li>
</ul>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/04-local-printer-list.jpg" alt=""></p>

<ul>
  <li>Change the name of the printer if you like and click Continue</li>
</ul>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/05-add-printer-step-01.jpg" alt=""></p>

<ul>
  <li>Change the drivers if it’s incorrect and click Add Printer</li>
</ul>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/06-add-printer-step-02.jpg" alt=""></p>

<ul>
  <li>Accept or modify the default options and click Set Default Options</li>
</ul>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/07-add-printer-step-03.jpg" alt=""></p>

<ul>
  <li>Confirm the printer is listed in the printers list</li>
</ul>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/08-add-printer-confirm.jpg" alt=""></p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5266062674794996" data-ad-slot="9650311114"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h2 id="step-04-share-the-printer">Step 04: Share the printer</h2>
<ul>
  <li>Click Pi -&gt; Preferences -&gt; Print Settings</li>
</ul>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/09-share-printer-step-01.jpg" alt=""></p>

<ul>
  <li>From Printer menu select Shared to share it over the network</li>
</ul>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/10-share-printer-step-02.jpg" alt=""></p>

<h2 id="step-05-setup-client-machine">Step 05: Setup client machine</h2>

<h3 id="option-1-add-network-printer">Option 1: Add network printer</h3>

<ul>
  <li>Download and install DYMO software</li>
  <li>Upon first run, application asks to run Add Network Printer Utility</li>
  <li>Click Yes</li>
</ul>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/11-add-network-printer-utility.png" alt=""></p>

<p>For me, this method did work on one machine and did not work on another one. So for the other machine I used Option 2</p>

<h3 id="option-2-add-printer-using-oss-add-printer-functionality">Option 2: Add printer using OS’s add printer functionality</h3>

<p>I used a Mac for this but should be similar on Windows.</p>

<ul>
  <li>Search for Printers &amp; Scanners</li>
  <li>Click + button</li>
  <li>It should show the printer on the network:</li>
</ul>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/12-add-printer.png" alt=""></p>

<h2 id="step-06-test">Step 06: Test</h2>

<p>Now that printer is recognized on the client machine, just design your labels and print using DYMO Label app.</p>

<p><img src="/images/vpblogimg/2021/08/dymo-labelwriter-450-on-raspberry-pi/13-print-results.jpg" alt=""></p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://www.dymo.com/support?cfid=user-guide" target="_blank" rel="noopener noreferrer">Official DYMO site to download drivers and software</a></li>
</ul>

		
		
	</div>


    </article>




    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        
	<h1 class="title" itemprop="name"><a href="/archive/2020/03/18/Migrating-EC2-Instance-to-a-Different-Account/" itemprop="url">Migrating an EC2 Instance to a Different AWS Account</a></h1>
	<div class="meta">
	<span class="date">




<time datetime="2020-03-18T06:00:00+00:00" itemprop="datePublished">March 18, 2020</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/aws">aws</a></span> -->

<!-- aws -->




    <a href="/category/aws">aws</a>
    
</span>
	<span class="tags">ec2, migration</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
		<p>Recently I needed to migrate an EC2 instance to a different AWS account. There’s no built-in functionality to handle this. The solution is creating an AMI from the instance and sharing it with the target account. I scripted my solution with Powershell and AWS Tools for Powershell as below.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Since the operation involves a source account and a target account, first create 2 profiles with EC2 access. credentials files should look like this</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[source_profile]
aws_access_key_id = xxxxxxxxx
aws_secret_access_key = xxxxxxxxx

[target_profile]
aws_access_key_id = xxxxxxxxx
aws_secret_access_key = xxxxxxxxx
</code></pre></div></div>

<h2 id="step-00-configuration">Step 00: Configuration</h2>
<p>I put all the variables in a Powershell script file which I include in the following steps. To use the scripts you need to provide the values first. Hopefully the variable names are self-explanatory:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$sourceAccountAwsProfileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="nv">$sourceRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="nv">$sourceAccountId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="nv">$instanceId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="nv">$amiName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="nv">$amiDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="nv">$targetAccountAwsProfileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="nv">$targetAccountId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span><span class="nv">$targetRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span></code></pre></div></div>

<h2 id="step-01-create-ami">Step 01: Create AMI</h2>
<p>First step to migrate EC2 instance is to create an AMi from the instance.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="w"> </span><span class="o">.</span><span class="n">\</span><span class="s2">"00. configuration.ps1"</span><span class="w">

</span><span class="c"># Create AMI</span><span class="w">
</span><span class="nv">$imageId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-EC2Image</span><span class="w"> </span><span class="nt">-InstanceId</span><span class="w"> </span><span class="nv">$instanceId</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nv">$amiName</span><span class="w"> </span><span class="nt">-Description</span><span class="w"> </span><span class="nv">$amiDescription</span><span class="w"> </span><span class="nt">-ProfileName</span><span class="w"> </span><span class="nv">$sourceAccountAwsProfileName</span><span class="w"> </span><span class="nt">-Region</span><span class="w"> </span><span class="nv">$sourceRegion</span><span class="w">

</span><span class="n">Set-Variable</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">global</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">AMI_ID</span><span class="w"> </span><span class="nt">-Value</span><span class="w"> </span><span class="nv">$imageId</span><span class="w">
</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"AMI_ID: ["</span><span class="w"> </span><span class="nv">$AMI_ID</span><span class="w"> </span><span class="s2">"]"</span><span class="w">
</span></code></pre></div></div>

<p>This operation takes a few minutes. The image has to become available before we can proceed to the next step.</p>

<h2 id="step-02-share-ami">Step 02: Share AMI</h2>
<p>Now the image is ready we have to share it with the target account. The script below shares the AMI and allows new volumes created from this AMI.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="w"> </span><span class="o">.</span><span class="n">\</span><span class="s2">"00. configuration.ps1"</span><span class="w">

</span><span class="nv">$imageId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Variable</span><span class="w"> </span><span class="nx">AMI_ID</span><span class="w"> </span><span class="nt">-valueOnly</span><span class="w">
</span><span class="n">Edit-EC2ImageAttribute</span><span class="w"> </span><span class="nt">-ImageId</span><span class="w"> </span><span class="nv">$imageId</span><span class="w"> </span><span class="nt">-Attribute</span><span class="w"> </span><span class="nx">launchPermission</span><span class="w"> </span><span class="nt">-OperationType</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="nv">$targetAccountId</span><span class="w"> </span><span class="nt">-ProfileName</span><span class="w"> </span><span class="nv">$sourceAccountAwsProfileName</span><span class="w"> </span><span class="nt">-Region</span><span class="w"> </span><span class="nv">$sourceRegion</span><span class="w">

</span><span class="nv">$imageSnapshots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-EC2Snapshot</span><span class="w"> </span><span class="nt">-OwnerId</span><span class="w"> </span><span class="nv">$sourceAccountId</span><span class="w"> </span><span class="nt">-ProfileName</span><span class="w"> </span><span class="nv">$sourceAccountAwsProfileName</span><span class="w"> </span><span class="nt">-Region</span><span class="w"> </span><span class="nv">$sourceRegion</span><span class="w">
                </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">Description</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"*</span><span class="nv">$imageId</span><span class="s2">*"</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$snapshot</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$imageSnapshots</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Edit-EC2SnapshotAttribute</span><span class="w"> </span><span class="nt">-SnapshotId</span><span class="w"> </span><span class="nv">$snapshot</span><span class="o">.</span><span class="nf">SnapshotId</span><span class="w"> </span><span class="nt">-Attribute</span><span class="w"> </span><span class="nx">createVolumePermission</span><span class="w"> </span><span class="nt">-OperationType</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nt">-UserId</span><span class="w"> </span><span class="nv">$targetAccountId</span><span class="w"> </span><span class="nt">-ProfileName</span><span class="w"> </span><span class="nv">$sourceAccountAwsProfileName</span><span class="w"> </span><span class="nt">-Region</span><span class="w"> </span><span class="nv">$sourceRegion</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5266062674794996" data-ad-slot="9650311114"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h2 id="step-03-copy-ami">Step 03: Copy AMI</h2>
<p>At this point, if you go to the target account you should be able to see the image when you choose “Private images” category. Make sure to choose the same region as the source account to be able to see the image.</p>

<p>We have access to this image but we want to have our own copy which we accomplish with the script below:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="w"> </span><span class="o">.</span><span class="n">\</span><span class="s2">"00. configuration.ps1"</span><span class="w">

</span><span class="nv">$imageId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Variable</span><span class="w"> </span><span class="nx">AMI_ID</span><span class="w"> </span><span class="nt">-valueOnly</span><span class="w">
</span><span class="n">Copy-EC2Image</span><span class="w"> </span><span class="nt">-SourceImageId</span><span class="w"> </span><span class="nv">$imageId</span><span class="w"> </span><span class="nt">-SourceRegion</span><span class="w"> </span><span class="nv">$sourceRegion</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nv">$amiName</span><span class="w"> </span><span class="nt">-ProfileName</span><span class="w"> </span><span class="nv">$targetAccountAwsProfileName</span><span class="w"> </span><span class="nt">-Region</span><span class="w"> </span><span class="nv">$targetRegion</span><span class="w">
</span></code></pre></div></div>

<p>In my experience the whole copying process took about 5 minutes.</p>

<p>Now that we have our own copy of the AMI we can launch instances as we please. Job (almost) done!</p>

<h2 id="step-04-clean-up">Step 04: Clean Up</h2>

<p>Final step is to clean up after ourselves. Since this AMI was created to migrate to the new account only I assume we won’t need it anymore in the source account. The following script deregisters the AMI and deletes all the associated snapshots.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="w"> </span><span class="o">.</span><span class="n">\</span><span class="s2">"00. configuration.ps1"</span><span class="w">

</span><span class="c"># Create image script writes the AMI ID to a variable. If it doesn't exist get the image id from AWS Management Console</span><span class="w">
</span><span class="nv">$imageId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Variable</span><span class="w"> </span><span class="nx">AMI_ID</span><span class="w"> </span><span class="nt">-valueOnly</span><span class="w">

</span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Unregistering image: ["</span><span class="w"> </span><span class="nv">$imageId</span><span class="w"> </span><span class="s2">"]"</span><span class="w">
</span><span class="n">Unregister-EC2Image</span><span class="w"> </span><span class="nt">-ImageId</span><span class="w"> </span><span class="nv">$imageId</span><span class="w"> </span><span class="nt">-ProfileName</span><span class="w"> </span><span class="nv">$sourceAccountAwsProfileName</span><span class="w"> </span><span class="nt">-Region</span><span class="w"> </span><span class="nv">$sourceRegion</span><span class="w">

</span><span class="nv">$imageSnapshots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-EC2Snapshot</span><span class="w"> </span><span class="nt">-OwnerId</span><span class="w"> </span><span class="nv">$sourceAccountId</span><span class="w"> </span><span class="nt">-ProfileName</span><span class="w"> </span><span class="nv">$sourceAccountAwsProfileName</span><span class="w"> </span><span class="nt">-Region</span><span class="w"> </span><span class="nv">$sourceRegion</span><span class="w">
                </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">Description</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"*</span><span class="nv">$imageId</span><span class="s2">*"</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$snapshot</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$imageSnapshots</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Removing snapshot: ["</span><span class="w"> </span><span class="nv">$snapshot</span><span class="o">.</span><span class="nf">SnapshotId</span><span class="w"> </span><span class="s2">"]"</span><span class="w">
    </span><span class="n">Remove-EC2Snapshot</span><span class="w"> </span><span class="nt">-SnapshotId</span><span class="w"> </span><span class="nv">$snapshot</span><span class="o">.</span><span class="nf">SnapshotId</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-ProfileName</span><span class="w"> </span><span class="nv">$sourceAccountAwsProfileName</span><span class="w"> </span><span class="nt">-Region</span><span class="w"> </span><span class="nv">$sourceRegion</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># Delete variable</span><span class="w">
</span><span class="n">Remove-Variable</span><span class="w"> </span><span class="nx">AMI_ID</span><span class="w"> </span><span class="nt">-Scope</span><span class="w"> </span><span class="nx">global</span><span class="w">
</span></code></pre></div></div>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://github.com/volkanpaksoy/lab/tree/master/blog/migrate-ec2-instance-to-another-account" target="_blank" rel="noopener noreferrer">Source Code</a></li>
  <li><a href="https://aws.amazon.com/premiumsupport/knowledge-center/account-transfer-ec2-instance/" target="_blank" rel="noopener noreferrer">How do I transfer an Amazon EC2 instance to a different AWS account?</a></li>
  <li><a href="https://alestic.com/2014/02/ec2-create-image-reboot/" target="_blank" rel="noopener noreferrer">EC2 create-image Does Not Fully “Stop” The Instance</a></li>
</ul>

		
		
	</div>


    </article>


</div>
<nav id="pagenavi">
    
    
        <a href="/page/2" class="next">Next</a>
    
    <div class="center"><a href="/archive">Blog Archives</a></div>
</nav>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright © 2021 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>

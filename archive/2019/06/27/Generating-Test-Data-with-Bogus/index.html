<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Generating Test Data with Bogus - Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/archive/2019/06/27/Generating-Test-Data-with-Bogus/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996"
  crossorigin="anonymous"></script>

  

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y3V7V2XX9Q"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y3V7V2XX9Q');
</script>

<!-- <script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'G-Y3V7V2XX9Q']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script> -->



  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@volkan_paksoy">
  <meta name="twitter:creator" content="@Volkan Paksoy">
  <meta name="twitter:title"   content="Generating Test Data with Bogus">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary">
  <meta name="twitter:image" content=""> -->
  
  <!-- end of Twitter cards -->


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
<br>
<br>

<!-- <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="volkanpaksoy" data-color="#005050" data-emoji=""  data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#ffffff" data-font-color="#ffffff" data-coffee-color="#FFDD00" ></script> -->

<a href="https://www.buymeacoffee.com/volkanpaksoy" target="_blank" rel="noopener noreferrer"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-green.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a>

<div id="ezoic-pub-ad-placeholder-102">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
  <!-- vp.com - default -->
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5266062674794996" data-ad-slot="6750480330" data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Generating Test Data with Bogus</h1>
	<div class="meta">
	<span class="date">




<time datetime="2019-06-27T07:00:00+01:00" itemprop="datePublished">June 27, 2019</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/"></a></span> -->

<!-- dev -->




    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">csharp, fake, test, data</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
<p>Generating high-quality test data can have an impact on the accuracy of the tests overall. In this post I’ll show using a helpful C# library called <a href="https://github.com/bchavez/Bogus" target="_blank" rel="noopener noreferrer">Bogus</a></p>

<h2 id="showcase-project-bank-statement-generator">Showcase project: Bank Statement Generator</h2>
<p>In this example I’ll generate fake bank statements. Normally they come in CSV files and have the following model:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">BankStatementLine</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">TransactionDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">TransactionType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">SortCode</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">AccountNumber</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">TransactionDescription</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">decimal</span><span class="p">?</span> <span class="n">DebitAmount</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">decimal</span><span class="p">?</span> <span class="n">CreditAmount</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Balance</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I’ll use Bogus to generate realistic fake statement lines and finally save it as a CSV and see if it looks real.</p>

<h2 id="rules-and-restrictions">Rules and restrictions</h2>
<p>I want the fields in the model above conform to certain set of rules to be realistic:</p>

<ul>
  <li>Transaction Date must be within a certain range I provide as bank statements are generated for a date range.</li>
  <li>Dates should be incremental and not random</li>
  <li>Sort Code must be in the following format: NN-NN-NN and must be the same for the entire statement.</li>
  <li>Account number must be an 8-digit number and same for the entire statement.</li>
  <li>Transaction Description must be free text</li>
  <li>Debit Amount and Credit Amount must be decimal numbers but only one of them can be present at any given line</li>
  <li>Transaction Type must be one of the pre-defined values and also some types can be for credit and some for debit only.</li>
  <li>Balance should be sum of all debit and credit amounts plus the first balance in the statement. So this value is dependent on the values that come before it.</li>
  <li>The number of lines in a statement should be random.</li>
</ul>

<div id="ezoic-pub-ad-placeholder-101">
  <script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
  <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5266062674794996" data-ad-slot="9650311114"></ins>
  <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

<h2 id="rule-implementations">Rule implementations</h2>
<p>Some rules stated above are very straightforward and easy to implement. These are some samples of what Bogus is capable of. For the full documentation check out the GitHub repository.</p>

<h3 id="date-range-support">Date range support</h3>
<p>Generating a date between a range is simple:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">TransactionDate</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span> <span class="n">f</span><span class="p">.</span><span class="n">Date</span><span class="p">.</span><span class="nf">Between</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span> <span class="n">endDate</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="enum-and-array-support">Enum and array support</h3>
<p>For Transaction Type I want to select a random value from a list of set values. This can be done in 2 ways: By using an enum or an IEnumerable.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">transactionTypes</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="s">"FPO"</span><span class="p">,</span> <span class="s">"DEB"</span><span class="p">,</span> <span class="s">"DB"</span><span class="p">,</span> <span class="s">"FPI"</span> <span class="p">};</span>
</code></pre></div></div>

<p>and in the rule description it can be used as</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">TransactionType</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span> <span class="n">f</span><span class="p">.</span><span class="nf">PickRandom</span><span class="p">(</span><span class="n">transactionTypes</span><span class="p">)</span> <span class="p">)</span>
</code></pre></div></div>

<p>Another way is using enums such as:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">enum</span> <span class="n">TransactionType</span>
<span class="p">{</span>
    <span class="n">FPO</span><span class="p">,</span>
    <span class="n">DEB</span><span class="p">,</span>
    <span class="n">DB</span><span class="p">,</span>
    <span class="n">FPI</span>
<span class="p">}</span>
</code></pre></div></div>

<p>and the rule becomes:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">TransactionType</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span> <span class="n">f</span><span class="p">.</span><span class="n">PickRandom</span><span class="p">&lt;</span><span class="n">TransactionType</span><span class="p">&gt;().</span><span class="nf">ToString</span><span class="p">())</span>
</code></pre></div></div>

<p>In my final implementation I used selecting from a list of objects. You can check out the <a href="https://github.com/volkanpaksoy/lab/tree/master/blog/GeneratingTestDataWithBogus" target="_blank" rel="noopener noreferrer">sample code</a> to see that version.</p>

<h3 id="number-range">Number range</h3>
<p>For the account number I need an 8-digit number which can be achieved with something like this rule:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">AccountNumber</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span> <span class="n">f</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="nf">Long</span><span class="p">(</span><span class="m">100000000</span><span class="p">,</span> <span class="m">99999999</span><span class="p">).</span><span class="nf">ToString</span><span class="p">())</span>
</code></pre></div></div>

<p>Bogus API also has builtin support for account number so the following is a more elegant and expressive way of achieving the same:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">AccountNumber</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span> <span class="n">f</span><span class="p">.</span><span class="n">Finance</span><span class="p">.</span><span class="nf">Account</span><span class="p">())</span>
</code></pre></div></div>

<h3 id="formatting-string">Formatting string</h3>
<p>Formatting Sort Code can be achieved by Field.Random.Replace method</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">SortCode</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span> <span class="n">f</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s">"##-##-##"</span><span class="p">))</span>
</code></pre></div></div>

<p>Similar to account number, it also has built-in support for sort code:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">SortCode</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span> <span class="n">f</span><span class="p">.</span><span class="n">Finance</span><span class="p">.</span><span class="nf">SortCode</span><span class="p">())</span>
</code></pre></div></div>

<h3 id="null-values">Null values</h3>
<p>In my case in some fields I’d like to have null values too. This can be achieved by <em>OrNull</em> extension method. For example, in the code below it generates %20 of DebitAmount values null.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">DebitAmount</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span> <span class="n">f</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="nf">Decimal</span><span class="p">(</span><span class="m">0.00</span><span class="n">m</span><span class="p">,</span> <span class="m">9999.00</span><span class="n">m</span><span class="p">).</span><span class="nf">OrNull</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="m">0.2f</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="common-fields">Common fields</h3>
<p>In my case some values in each statement line repeat throughout the entire statement such as account number and sort code. To achieve that I created a “base” statement line and every fake statement line used these shared fields instead of generating new ones.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">commonFields</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Faker</span><span class="p">&lt;</span><span class="n">BankStatementLine</span><span class="p">&gt;()</span>
    <span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">AccountNumber</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span> <span class="n">f</span><span class="p">.</span><span class="n">Finance</span><span class="p">.</span><span class="nf">Account</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">SortCode</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span> <span class="n">f</span><span class="p">.</span><span class="n">Finance</span><span class="p">.</span><span class="nf">SortCode</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">Generate</span><span class="p">();</span>


<span class="kt">var</span> <span class="n">fakeTransactions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Faker</span><span class="p">&lt;</span><span class="n">BankStatementLine</span><span class="p">&gt;()</span>
    <span class="p">.</span><span class="nf">StrictMode</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">AccountNumber</span><span class="p">,</span> <span class="n">commonFields</span><span class="p">.</span><span class="n">AccountNumber</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">SortCode</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span> <span class="n">commonFields</span><span class="p">.</span><span class="n">SortCode</span><span class="p">)</span>
	<span class="p">...</span>
	<span class="p">...</span>
</code></pre></div></div>

<h3 id="random-number-of-objects">Random number of objects</h3>
<p>It’s more realistic to have varying number of lines in statements. With Generate method you can specify the exact number of items you want to generate which is good for unit tests. For my purposes I just wanted to create random of rows in each statement as I only needed the data to be imported. This can be achieved by GenerateBetween:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">statementLines</span> <span class="p">=</span> <span class="n">fakeTransactions</span><span class="p">.</span><span class="nf">GenerateBetween</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">20</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="dependent-values">Dependent values</h3>
<p>The tricky part in this scenario was the dependent values. Normally when you use RuleFor extension method it generates the value for that field alone in isolation. In my case, one restriction was Debit Amount and Credit Amount could not both have values in the same line. Also Balance depends on these values and needs to be calculated in each line.</p>

<p>As far as I can tell there’s no built-in support to define these dependencies. Based on my tests I was able to achieve this in 2 ways</p>

<ol>
  <li>Update the values accordingly in <strong>FinishWith</strong> extension method</li>
  <li>Use <strong>Rules</strong> extension method to define multiple rules at once and implement the restrictions inside it.</li>
</ol>

<p>I think the latter is a better solution as FinishWith sounds more like clean up, logging or similar extra activity where Rules sound more like actual business logic implementation.</p>

<p>So with that in mind my rules for Debit Amount, Credit Amount and Balance fields looked like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">Rules</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">debitAmount</span> <span class="p">=</span> <span class="p">(</span><span class="kt">decimal</span><span class="p">?)</span><span class="n">f</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="nf">Decimal</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">100</span><span class="p">).</span><span class="nf">OrNull</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="m">1.0f</span> <span class="p">-</span> <span class="n">statementconfig</span><span class="p">.</span><span class="n">DebitTransactionRatio</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">debitAmount</span><span class="p">.</span><span class="n">HasValue</span><span class="p">)</span> <span class="c1">// Is it a debit transaction?</span>
    <span class="p">{</span>
        <span class="n">x</span><span class="p">.</span><span class="n">CreditAmount</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="n">x</span><span class="p">.</span><span class="n">DebitAmount</span> <span class="p">=</span> <span class="n">debitAmount</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
        <span class="n">balance</span> <span class="p">-=</span> <span class="n">x</span><span class="p">.</span><span class="n">DebitAmount</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>

        <span class="n">x</span><span class="p">.</span><span class="n">TransactionType</span> <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">PickRandom</span><span class="p">(</span><span class="n">TransactionType</span><span class="p">.</span><span class="n">AllTransactionTypes</span>
            <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">tt</span> <span class="p">=&gt;</span> <span class="n">tt</span><span class="p">.</span><span class="n">Direction</span> <span class="p">==</span> <span class="n">TransactionDirection</span><span class="p">.</span><span class="n">Debit</span> <span class="p">||</span> <span class="n">tt</span><span class="p">.</span><span class="n">Direction</span> <span class="p">==</span> <span class="n">TransactionDirection</span><span class="p">.</span><span class="n">DebitOrCredit</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">tt</span> <span class="p">=&gt;</span> <span class="n">tt</span><span class="p">.</span><span class="n">Code</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">creditAmount</span> <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="nf">Decimal</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">100</span><span class="p">);</span>
        <span class="n">x</span><span class="p">.</span><span class="n">DebitAmount</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="n">x</span><span class="p">.</span><span class="n">CreditAmount</span> <span class="p">=</span> <span class="n">creditAmount</span><span class="p">;</span>

        <span class="n">balance</span> <span class="p">+=</span> <span class="n">x</span><span class="p">.</span><span class="n">CreditAmount</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>

        <span class="n">x</span><span class="p">.</span><span class="n">TransactionType</span> <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">PickRandom</span><span class="p">(</span><span class="n">TransactionType</span><span class="p">.</span><span class="n">AllTransactionTypes</span>
            <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">tt</span> <span class="p">=&gt;</span> <span class="n">tt</span><span class="p">.</span><span class="n">Direction</span> <span class="p">==</span> <span class="n">TransactionDirection</span><span class="p">.</span><span class="n">Credit</span> <span class="p">||</span> <span class="n">tt</span><span class="p">.</span><span class="n">Direction</span> <span class="p">==</span> <span class="n">TransactionDirection</span><span class="p">.</span><span class="n">DebitOrCredit</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">tt</span> <span class="p">=&gt;</span> <span class="n">tt</span><span class="p">.</span><span class="n">Code</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="n">x</span><span class="p">.</span><span class="n">Balance</span> <span class="p">=</span> <span class="n">balance</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<p>A caveat with this approach is that I cannot use <strong>StrictMode</strong> anymore as it complains about those 3 fields having null values. It specifically mentions that in the exception. If you use Rules you’re on your own to ensure that all fields are populated properly.</p>

<p>Another drawback of setting multiple rules at once is that it can easily make the code harder to read. Fortunately for me, the author of the library <a href="https://bchavez.bitarmory.com/" target="_blank" rel="noopener noreferrer">Brian Chavez</a> kindly reviewed the code and suggested some refactorings one of which proved it was still possible to use <strong>RuleFor</strong> method and strict mode. I’ve updated the final source code with these refactorings. So with individual rules the implementation looks like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">DebitAmount</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">decimal</span><span class="p">?)</span><span class="n">f</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="nf">Decimal</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">100</span><span class="p">).</span><span class="nf">OrNull</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="m">1.0f</span> <span class="p">-</span> <span class="n">statementconfig</span><span class="p">.</span><span class="n">DebitTransactionRatio</span><span class="p">);</span>
<span class="p">})</span>
<span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">CreditAmount</span><span class="p">,</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">.</span><span class="nf">IsCredit</span><span class="p">()</span> <span class="p">?</span> <span class="p">(</span><span class="kt">decimal</span><span class="p">?)</span><span class="n">f</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="nf">Decimal</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">100</span><span class="p">)</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>
<span class="p">})</span>
<span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">TransactionType</span><span class="p">,</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">IsCredit</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">RandomTxCode</span><span class="p">(</span><span class="n">TransactionDirection</span><span class="p">.</span><span class="n">Credit</span><span class="p">);</span> <span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">RandomTxCode</span><span class="p">(</span><span class="n">TransactionDirection</span><span class="p">.</span><span class="n">Debit</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">string</span> <span class="nf">RandomTxCode</span><span class="p">(</span><span class="n">TransactionDirection</span> <span class="n">direction</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="nf">PickRandom</span><span class="p">(</span><span class="n">TransactionType</span><span class="p">.</span><span class="n">AllTransactionTypes</span>
            <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">tt</span> <span class="p">=&gt;</span> <span class="n">tt</span><span class="p">.</span><span class="n">Direction</span> <span class="p">==</span> <span class="n">direction</span> <span class="p">||</span> <span class="n">tt</span><span class="p">.</span><span class="n">Direction</span> <span class="p">==</span> <span class="n">TransactionDirection</span><span class="p">.</span><span class="n">DebitOrCredit</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">tt</span> <span class="p">=&gt;</span> <span class="n">tt</span><span class="p">.</span><span class="n">Code</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">})</span>
<span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Balance</span><span class="p">,</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">IsCredit</span><span class="p">())</span>
        <span class="n">balance</span> <span class="p">+=</span> <span class="n">x</span><span class="p">.</span><span class="n">CreditAmount</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">balance</span> <span class="p">-=</span> <span class="n">x</span><span class="p">.</span><span class="n">DebitAmount</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">balance</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<p>IsDebit and IsCredit methods referred to above are extension methods defined like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Extensions</span>
<span class="p">{</span>
   <span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">IsCredit</span><span class="p">(</span><span class="k">this</span> <span class="n">BankStatementLine</span> <span class="n">bsl</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="k">return</span> <span class="n">bsl</span><span class="p">.</span><span class="n">DebitAmount</span> <span class="k">is</span> <span class="k">null</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">IsDebit</span><span class="p">(</span><span class="k">this</span> <span class="n">BankStatementLine</span> <span class="n">bsl</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="k">return</span> <span class="p">!</span><span class="nf">IsCredit</span><span class="p">(</span><span class="n">bsl</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="random-text">Random text</h3>
<p>For the transaction description for now I’ll go with random Lorem Ipsum texts. Bogus has support for this too</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">TransactionDescription</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span> <span class="n">f</span><span class="p">.</span><span class="n">Lorem</span><span class="p">.</span><span class="nf">Sentence</span><span class="p">(</span><span class="m">3</span><span class="p">))</span>
</code></pre></div></div>

<p>I probably will need to use a fixed list of descriptions soon but for the time being it’s fine. Also as shown below it’s very easy to switch to that too.</p>

<h3 id="incremental-values">Incremental values</h3>
<p>Similar to balance being dependent on the previous values, transaction date is also dependent as it needs to go in an incremental fashion. I couldn’t find built-in support for this so implemented it using my own shared variable like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">RuleFor</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">TransactionDate</span><span class="p">,</span> <span class="n">f</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">lastDate</span> <span class="p">=</span> <span class="n">lastDate</span><span class="p">.</span><span class="nf">AddDays</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="nf">Double</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">statementconfig</span><span class="p">.</span><span class="n">TransactionDateInterval</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lastDate</span><span class="p">.</span><span class="n">Date</span> <span class="p">&gt;</span> <span class="n">statementconfig</span><span class="p">.</span><span class="n">EndDate</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">lastDate</span> <span class="p">=</span> <span class="n">statementconfig</span><span class="p">.</span><span class="n">EndDate</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">lastDate</span><span class="p">;</span>
<span class="p">})</span>
</code></pre></div></div>

<h2 id="putting-it-all-together">Putting It All Together</h2>
<p>So let’s see the output with the help of another nice library called <a href="https://github.com/khalidabuhakmeh/ConsoleTables" target="_blank" rel="noopener noreferrer">Console Tables</a></p>

<p><img src="/images/vpblogimg/2019/06/generating-test-data-with-bogus-output.png" alt=""></p>

<h2 id="source-code">Source Code</h2>
<p></p>
<div class="github-widget" data-repo="volkanpaksoy/lab"></div>

<p>Sample application can be found under blog/GeneratingTestDataWithBogus folder in the repository.</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://github.com/bchavez/Bogus" target="_blank" rel="noopener noreferrer">Bogus GitHub repository</a></li>
  <li><a href="https://github.com/khalidabuhakmeh/ConsoleTables" target="_blank" rel="noopener noreferrer">Console Tables repository</a></li>
  <li><a href="https://github.com/volkanpaksoy/lab/tree/master/blog/GeneratingTestDataWithBogus" target="_blank" rel="noopener noreferrer">Sample source code</a></li>
  <li><a href="https://bchavez.bitarmory.com/" target="_blank" rel="noopener noreferrer">Author Brian Chavez’s website</a></li>
</ul>
</div>

</article>

<div id="page-navigation"> 
        <div class="previous"> 
         
                <a href="/archive/2019/06/10/Docker-in-Depth/" title="Previous Post: 
Docker in Depth">« Docker in Depth</a>
         
        </div>

        <div class="next"> 
         
               <a href="/archive/2019/07/05/ElasticSearch-Workout/" title="next Post: 
Elasticsearch Workout">Elasticsearch Workout » </a> 
         
        </div>
</div> 


</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright © 2022 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>

<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Playing with TFL API with C#, Xamarin and Swift - Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/archive/2015/11/13/playing-with-tfl-api-with-csharp-xamarin-and-swift/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996"
  crossorigin="anonymous"></script>

  

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y3V7V2XX9Q"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y3V7V2XX9Q');
</script>

<!-- <script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'G-Y3V7V2XX9Q']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script> -->



  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@volkan_paksoy">
  <meta name="twitter:creator" content="@Volkan Paksoy">
  <meta name="twitter:title"   content="Playing with TFL API with C#, Xamarin and Swift">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary">
  <meta name="twitter:image" content=""> -->
  
  <!-- end of Twitter cards -->


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
<br>
<br>

<!-- <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="volkanpaksoy" data-color="#005050" data-emoji=""  data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#ffffff" data-font-color="#ffffff" data-coffee-color="#FFDD00" ></script> -->

<a href="https://www.buymeacoffee.com/volkanpaksoy" target="_blank" rel="noopener noreferrer"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-green.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a>

<div id="ezoic-pub-ad-placeholder-102">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
  <!-- vp.com - default -->
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5266062674794996" data-ad-slot="6750480330" data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Playing with TFL API with C#, Xamarin and Swift</h1>
	<div class="meta">
	<span class="date">




<time datetime="2015-11-13T11:00:00+00:00" itemprop="datePublished">November 13, 2015</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/"></a></span> -->

<!-- dev -->




    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">csharp, ios, swift, wpf, xamarin, tfl_api</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
<p>Recently I discovered that Transport for London (TFL) has some great APIs that I can play around with some familiar data. It’s very to use as an API key is not even mandatory. My main goal here is to discover what I can do with this data and build a few user interfaces consuming it. All source code is available on <a href="https://github.com/volkanpaksoy/tube-status-fetcher" target="_blank" rel="noopener noreferrer">GitHub</a></p>

<h2 id="tube-status">Tube status</h2>
<p>The <a href="https://api.tfl.gov.uk/line/mode/tube/status?detail=true" target="_blank" rel="noopener noreferrer">API endpoint</a> I will use returns the current status of tube lines, an array of the following JSON objects:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"$type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tfl.Api.Presentation.Entities.Line, Tfl.Api.Presentation.Entities"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"central"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Central"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"modeName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tube"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-10-14T10:31:00.39"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"modified"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-10-14T10:31:00.39"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lineStatuses"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"$type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tfl.Api.Presentation.Entities.LineStatus, Tfl.Api.Presentation.Entities"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"statusSeverity"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
            </span><span class="nl">"statusSeverityDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Good Service"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0001-01-01T00:00:00"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"validityPeriods"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"routeSections"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"serviceTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"$type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tfl.Api.Presentation.Entities.LineServiceTypeInfo, Tfl.Api.Presentation.Entities"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Regular"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/Line/Route?ids=Central&amp;serviceTypes=Regular"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div id="ezoic-pub-ad-placeholder-101">
  <script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
  <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5266062674794996" data-ad-slot="9650311114"></ins>
  <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

<h2 id="visualizing-the-data---line-colours">Visualizing the data - line colours</h2>
<p>TFL have standard colours for tube lines which are documented <a href="http://content.tfl.gov.uk/tfl-colour-standard.pdf" target="_blank" rel="noopener noreferrer">here</a>. So I created a small lookup json using that reference:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bakerloo"</span><span class="p">,</span><span class="w"> </span><span class="nl">"CMYK"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"M"</span><span class="p">:</span><span class="w"> </span><span class="mi">58</span><span class="p">,</span><span class="w"> </span><span class="nl">"Y"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nl">"K"</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"RGB"</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nl">"R"</span><span class="p">:</span><span class="w"> </span><span class="mi">137</span><span class="p">,</span><span class="w"> </span><span class="nl">"G"</span><span class="p">:</span><span class="w"> </span><span class="mi">78</span><span class="p">,</span><span class="w"> </span><span class="nl">"B"</span><span class="p">:</span><span class="w"> </span><span class="mi">36</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"central"</span><span class="p">,</span><span class="w"> </span><span class="nl">"CMYK"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"M"</span><span class="p">:</span><span class="w"> </span><span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="nl">"Y"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"RGB"</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nl">"R"</span><span class="p">:</span><span class="w"> </span><span class="mi">220</span><span class="p">,</span><span class="w"> </span><span class="nl">"G"</span><span class="p">:</span><span class="w"> </span><span class="mi">36</span><span class="p">,</span><span class="w"> </span><span class="nl">"B"</span><span class="p">:</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"circle"</span><span class="p">,</span><span class="w">  </span><span class="nl">"CMYK"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"M"</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="nl">"Y"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"RGB"</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nl">"R"</span><span class="p">:</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="nl">"G"</span><span class="p">:</span><span class="w"> </span><span class="mi">206</span><span class="p">,</span><span class="w"> </span><span class="nl">"B"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"district"</span><span class="p">,</span><span class="w"> </span><span class="nl">"CMYK"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"C"</span><span class="p">:</span><span class="w">  </span><span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="nl">"Y"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nl">"K"</span><span class="p">:</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"RGB"</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nl">"R"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nl">"G"</span><span class="p">:</span><span class="w"> </span><span class="mi">114</span><span class="p">,</span><span class="w"> </span><span class="nl">"B"</span><span class="p">:</span><span class="w"> </span><span class="mi">41</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hammersmith-city"</span><span class="p">,</span><span class="w"> </span><span class="nl">"CMYK"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"M"</span><span class="p">:</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="nl">"Y"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"RGB"</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nl">"R"</span><span class="p">:</span><span class="w"> </span><span class="mi">215</span><span class="p">,</span><span class="w"> </span><span class="nl">"G"</span><span class="p">:</span><span class="w"> </span><span class="mi">153</span><span class="p">,</span><span class="w"> </span><span class="nl">"B"</span><span class="p">:</span><span class="w"> </span><span class="mi">175</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jubilee"</span><span class="p">,</span><span class="w"> </span><span class="nl">"CMYK"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"C"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nl">"K"</span><span class="p">:</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"RGB"</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nl">"R"</span><span class="p">:</span><span class="w"> </span><span class="mi">134</span><span class="p">,</span><span class="w"> </span><span class="nl">"G"</span><span class="p">:</span><span class="w"> </span><span class="mi">143</span><span class="p">,</span><span class="w"> </span><span class="nl">"B"</span><span class="p">:</span><span class="w"> </span><span class="mi">152</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"metropolitan"</span><span class="p">,</span><span class="w"> </span><span class="nl">"CMYK"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"C"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nl">"M"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nl">"K"</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"RGB"</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nl">"R"</span><span class="p">:</span><span class="w"> </span><span class="mi">117</span><span class="p">,</span><span class="w"> </span><span class="nl">"G"</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="nl">"B"</span><span class="p">:</span><span class="w"> </span><span class="mi">86</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"northern"</span><span class="p">,</span><span class="w"> </span><span class="nl">"CMYK"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"K"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"RGB"</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nl">"R"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nl">"G"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nl">"B"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"piccadilly"</span><span class="p">,</span><span class="w"> </span><span class="nl">"CMYK"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"C"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nl">"M"</span><span class="p">:</span><span class="w"> </span><span class="mi">88</span><span class="p">,</span><span class="w"> </span><span class="nl">"K"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"RGB"</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nl">"R"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nl">"G"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="nl">"B"</span><span class="p">:</span><span class="w"> </span><span class="mi">168</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"victoria"</span><span class="p">,</span><span class="w"> </span><span class="nl">"CMYK"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"C"</span><span class="p">:</span><span class="w"> </span><span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="nl">"M"</span><span class="p">:</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"RGB"</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nl">"R"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nl">"G"</span><span class="p">:</span><span class="w"> </span><span class="mi">160</span><span class="p">,</span><span class="w"> </span><span class="nl">"B"</span><span class="p">:</span><span class="w"> </span><span class="mi">226</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"waterloo-city"</span><span class="p">,</span><span class="w"> </span><span class="nl">"CMYK"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"C"</span><span class="p">:</span><span class="w"> </span><span class="mi">47</span><span class="p">,</span><span class="w"> </span><span class="nl">"Y"</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"RGB"</span><span class="p">:</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nl">"R"</span><span class="p">:</span><span class="w"> </span><span class="mi">118</span><span class="p">,</span><span class="w"> </span><span class="nl">"G"</span><span class="p">:</span><span class="w"> </span><span class="mi">208</span><span class="p">,</span><span class="w"> </span><span class="nl">"B"</span><span class="p">:</span><span class="w"> </span><span class="mi">189</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>I was hoping to map status values to colours as well (i.e. “Severe delays” to red) but there is no official guide to that. The status codes and values can be retrieved from this endpoint: <a href="https://api.tfl.gov.uk/line/meta/severity" target="_blank" rel="noopener noreferrer">https://api.tfl.gov.uk/line/meta/severity</a> which returns a collection of objects like this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"$type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tfl.Api.Presentation.Entities.StatusSeverity, Tfl.Api.Presentation.Entities"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"modeName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tube"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Suspended"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>I simplified it for my purposes (just the values for tube):</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Special Service"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Closed"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Suspended"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Part Suspended"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Planned Closure"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Part Closure"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Severe Delays"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Reduced Service"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bus Service"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Minor Delays"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Good Service"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Part Closed"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Exist Only"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Step Free Access"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Change of frequency"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Diverted"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Not Running"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Issues Reported"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"No Issues"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Information"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"severityLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Service Closed"</span><span class="w"> </span><span class="p">},</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>I will keep it around but in this initial version I won’t use it as description is returned with the status query anyway. But it was still a useful exercise to figure out there is no “official” colour for status values. After all what’s the colour of “No Step Free Access” or “Exist Only”? There is a also reason field that explains the effects of any delays etc. which should ne displayed along with the severity especially when there are some disruptions in the service.</p>

<p>‘Nuff said about the data! Let’s start building something with it!</p>

<h2 id="core-library">Core library</h2>
<p>As I will build several API call to retrieve tube status is encapsulated in the core library which basically has sends the HTTP request, parses the JSON and returns the <em>LineInfo</em> list:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Fetcher</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">_apiEndPoint</span> <span class="p">=</span> <span class="s">"https://api.tfl.gov.uk/line/mode/tube/status?detail=true"</span><span class="p">;</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">LineInfo</span><span class="p">&gt;</span> <span class="nf">GetTubeInfo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RestClient</span><span class="p">(</span><span class="n">_apiEndPoint</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">request</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RestRequest</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">Method</span><span class="p">.</span><span class="n">GET</span><span class="p">);</span>
        <span class="n">request</span><span class="p">.</span><span class="nf">AddHeader</span><span class="p">(</span><span class="s">"Content-Type"</span><span class="p">,</span> <span class="s">"application/json"</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">response</span> <span class="p">=</span> <span class="p">(</span><span class="n">RestResponse</span><span class="p">)</span><span class="n">client</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">content</span> <span class="p">=</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">tflResponse</span> <span class="p">=</span> <span class="n">JsonConvert</span><span class="p">.</span><span class="n">DeserializeObject</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="n">TflLineInfo</span><span class="p">&gt;&gt;(</span><span class="n">content</span><span class="p">);</span>

        <span class="kt">var</span> <span class="n">lineInfoList</span> <span class="p">=</span> <span class="n">tflResponse</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">t</span> <span class="p">=&gt;</span>
            <span class="k">new</span> <span class="nf">LineInfo</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">Id</span> <span class="p">=</span> <span class="n">t</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">Name</span> <span class="p">=</span> <span class="n">t</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">Reason</span> <span class="p">=</span> <span class="n">t</span><span class="p">.</span><span class="n">lineStatuses</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">reason</span><span class="p">,</span>
                <span class="n">StatusSeverityDescription</span> <span class="p">=</span> <span class="n">t</span><span class="p">.</span><span class="n">lineStatuses</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">statusSeverityDescription</span><span class="p">,</span>
                <span class="n">StatusSeverity</span> <span class="p">=</span> <span class="n">t</span><span class="p">.</span><span class="n">lineStatuses</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">statusSeverity</span>
            <span class="p">}).</span><span class="nf">ToList</span><span class="p">();</span>

        <span class="k">return</span> <span class="n">lineInfoList</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>LineInfo class contains the current status with the description. It also contains the colour defined by TFL for that tube line:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">LineInfo</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">StatusSeverity</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">StatusSeverityDescription</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Reason</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">RGB</span> <span class="n">LineColour</span>
    <span class="p">{</span>
        <span class="k">get</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">TubeColourHelper</span><span class="p">.</span><span class="nf">GetRGBColour</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As the line colours aren’t returned by the service I have to populate it by a helper class:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">TubeColourHelper</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">RGB</span><span class="p">&gt;</span> <span class="n">_tubeColorRGBDictionary</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">RGB</span><span class="p">&gt;();</span>

    <span class="k">static</span> <span class="nf">TubeColourHelper</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">_tubeColorRGBDictionary</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">RGB</span><span class="p">&gt;();</span>

        <span class="kt">string</span> <span class="n">json</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="nf">ReadAllText</span><span class="p">(</span><span class="s">"./data/colours.json"</span><span class="p">);</span>
        <span class="kt">var</span> <span class="n">tubeColors</span> <span class="p">=</span> <span class="n">JArray</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">json</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">tubeColor</span> <span class="k">in</span> <span class="n">tubeColors</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_tubeColorRGBDictionary</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">tubeColor</span><span class="p">[</span><span class="s">"id"</span><span class="p">].</span><span class="n">Value</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(),</span> <span class="k">new</span> <span class="nf">RGB</span><span class="p">(</span>
                <span class="n">tubeColor</span><span class="p">[</span><span class="s">"RGB"</span><span class="p">][</span><span class="s">"R"</span><span class="p">]?.</span><span class="n">Value</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;()</span> <span class="p">??</span> <span class="m">0</span><span class="p">,</span>
                <span class="n">tubeColor</span><span class="p">[</span><span class="s">"RGB"</span><span class="p">][</span><span class="s">"G"</span><span class="p">]?.</span><span class="n">Value</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;()</span> <span class="p">??</span> <span class="m">0</span><span class="p">,</span>
                <span class="n">tubeColor</span><span class="p">[</span><span class="s">"RGB"</span><span class="p">][</span><span class="s">"B"</span><span class="p">]?.</span><span class="n">Value</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;()</span> <span class="p">??</span> <span class="m">0</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">static</span> <span class="n">RGB</span> <span class="nf">GetRGBColour</span><span class="p">(</span><span class="kt">string</span> <span class="n">lineId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">_tubeColorRGBDictionary</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="n">lineId</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">$"Colour for line [</span><span class="p">{</span><span class="n">lineId</span><span class="p">}</span><span class="s">] could not be found in RGB colour map"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">_tubeColorRGBDictionary</span><span class="p">[</span><span class="n">lineId</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The static constructor runs only the first time it is accessed, reads the <em>colours.json</em> and populates the dictionary. From then on it’s just a lookup in memory.</p>

<h2 id="first-client-c-console-application-on-windows">First client: C# Console Application on Windows</h2>
<p>Time to develop our first client and see some actual results. As it’s generally the case with console applications this one is pretty simple and hassle-free. I decided to start with that one just to see the core library is working as expected.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">fetcher</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Fetcher</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">viewer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConsoleViewer</span><span class="p">();</span>

        <span class="kt">bool</span> <span class="n">exit</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="n">viewer</span><span class="p">.</span><span class="nf">DisplayTubeStatus</span><span class="p">(</span><span class="n">fetcher</span><span class="p">.</span><span class="nf">GetTubeInfo</span><span class="p">());</span>

        <span class="k">do</span>
        <span class="p">{</span>
            <span class="n">ConsoleKeyInfo</span> <span class="n">key</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="nf">ReadKey</span><span class="p">();</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">Key</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="n">ConsoleKey</span><span class="p">.</span><span class="n">F5</span><span class="p">:</span>
                    <span class="n">viewer</span><span class="p">.</span><span class="nf">DisplayTubeStatus</span><span class="p">(</span><span class="n">fetcher</span><span class="p">.</span><span class="nf">GetTubeInfo</span><span class="p">());</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">case</span> <span class="n">ConsoleKey</span><span class="p">.</span><span class="n">Q</span><span class="p">:</span>
                    <span class="n">exit</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">default</span><span class="p">:</span>
                    <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Unknown command"</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="p">(!</span><span class="n">exit</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Displays the results when it’s first run. You can refresh by pressing F5 or quit by pressing Q. The output looks like this:</p>

<p><img src="/images/vpblogimg/2015/11/playing-with-tfl-api-console-output.png" alt=""></p>

<p>The problem with console application is that I wasn’t able to use RGB values directly as the console only supports an enumeration called <em>ConsoleColor</em>.</p>

<h2 id="second-client-wpf-application-on-windows">Second client: WPF Application on Windows</h2>
<p>Now let’s look at a more <em>graphical</em> UI, a WPF client:</p>

<p><img src="/images/vpblogimg/2015/11/playing-with-tfl-api-wpf-output.png" alt=""></p>

<p>Same idea, display the results upon first run then call the service again on Refresh button’s click event.</p>

<h2 id="third-client-ios-app-with-xamarin">Third client: iOS App with Xamarin</h2>
<p>I’ve recently subscribed to Xamarin and one of the main reasons for starting this project was to see it in action. What I was mostly curious about was if I could use my C# libraries using NuGet packages on an iOS application developed with Xamarin. This would allow me build apps significantly faster.</p>

<p>It didn’t work out of the box because I used C# 6.0 and .NET Framework 4.5.2 on the Windows side but it wasn’t available on the Mac.</p>

<p><img src="/images/vpblogimg/2015/11/playing-with-tfl-api-xamarin-framework-selection.png" alt=""></p>

<p>But wasn’t too hard to change the framework and make some small modifications to make it work. Good news is that it supports NuGet and most common libraries have Mono support including RestSharp and Newtonsoft.Json which I used in this project</p>

<p><img src="/images/vpblogimg/2015/11/playing-with-tfl-api-xamarin-add-nuget-packages.png" alt=""></p>

<p>I had to remove and add them but finally they worked fine so I didn’t have to change anything in the code.</p>

<p><img src="/images/vpblogimg/2015/11/playing-with-tfl-api-xamarin-output.png" alt=""></p>

<p>I won’t go into implementation details as there’s not much change. The app has one table view controller and it calls the core library to get the results and assigns them to the table’s data source. It’s a relief that I could have the same functionality as Windows with just minor changes.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">ViewDidLoad</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">base</span><span class="p">.</span><span class="nf">ViewDidLoad</span><span class="p">();</span>

    <span class="kt">var</span> <span class="n">fetcher</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Fetcher</span><span class="p">();</span>
    <span class="kt">var</span> <span class="n">lineInfoList</span> <span class="p">=</span> <span class="n">fetcher</span><span class="p">.</span><span class="nf">GetTubeInfo</span><span class="p">();</span>
    <span class="n">TableView</span><span class="p">.</span><span class="n">Source</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TubeStatusTableViewControllerSource</span><span class="p">(</span><span class="n">lineInfoList</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">());</span>
    <span class="n">TableView</span><span class="p">.</span><span class="nf">ReloadData</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Anyway, more on Xamarin later after I cover the Swift version.</p>

<h2 id="fourth-client-ios-app-with-swift">Fourth client: iOS App with Swift</h2>
<p>Last but not least, here comes Swift client built with XCode. Naturally this one cannot use the core library that the first 3 clients shared (which is good because I was looking for a chance to practice handling HTTP requests and parsinng JSON with Swift anyway).</p>

<p>I didn’t use any external libraries so the implementation is a bit long but mainly it sends the request using NSURLSession and  NSSessionDataTask.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">getTubeStatus</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="p">(</span><span class="nv">result</span><span class="p">:</span> <span class="p">[</span><span class="kt">LineInfo</span><span class="p">]?,</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">NSError</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s">"detail"</span> <span class="p">:</span> <span class="s">"true"</span><span class="p">]</span>
    <span class="k">let</span> <span class="nv">mutableMethod</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="kt">Methods</span><span class="o">.</span><span class="kt">TubeStatus</span>
    
    <span class="nf">taskForGETMethod</span><span class="p">(</span><span class="n">mutableMethod</span><span class="p">,</span> <span class="nv">parameters</span><span class="p">:</span> <span class="n">parameters</span><span class="p">)</span> <span class="p">{</span> <span class="kt">JSONResult</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
            <span class="nf">completionHandler</span><span class="p">(</span><span class="nv">result</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">error</span><span class="p">:</span> <span class="n">error</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">results</span> <span class="o">=</span> <span class="kt">JSONResult</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">AnyObject</span><span class="p">]</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">lineStatus</span> <span class="o">=</span> <span class="kt">LineInfo</span><span class="o">.</span><span class="nf">lineStatusFromResults</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
                <span class="nf">completionHandler</span><span class="p">(</span><span class="nv">result</span><span class="p">:</span> <span class="n">lineStatus</span><span class="p">,</span> <span class="nv">error</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
            <span class="p">}</span>
       <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Then constructs the LineInfo objects by calling the static <em>lineStatusFromResults</em> method:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">static</span> <span class="kd">func</span> <span class="nf">lineStatusFromResults</span><span class="p">(</span><span class="nv">results</span><span class="p">:</span> <span class="p">[</span><span class="kt">AnyObject</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">LineInfo</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">lineStatus</span> <span class="o">=</span> <span class="p">[</span><span class="kt">LineInfo</span><span class="p">]()</span>
    <span class="k">for</span> <span class="n">result</span> <span class="k">in</span> <span class="n">results</span> <span class="p">{</span>
        <span class="n">lineStatus</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">LineInfo</span><span class="p">(</span><span class="nv">status</span><span class="p">:</span> <span class="n">result</span><span class="p">))</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">lineStatus</span>
<span class="p">}</span>
</code></pre></div></div>

<p>which creates a new LineInfo and adds to resultset:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">init</span><span class="p">(</span><span class="nv">status</span><span class="p">:</span> <span class="kt">AnyObject</span><span class="p">)</span> <span class="p">{</span>

    <span class="kt">Id</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span> <span class="k">as!</span> <span class="kt">String</span>
    <span class="kt">Name</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="k">as!</span> <span class="kt">String</span>
    <span class="kt">StatusSeverity</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="s">"lineStatuses"</span><span class="p">]</span><span class="o">!!</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!</span><span class="p">[</span><span class="s">"statusSeverity"</span><span class="p">]</span> <span class="k">as!</span> <span class="kt">Int</span>
    <span class="kt">StatusSeverityDescription</span> <span class="o">=</span> <span class="n">status</span><span class="p">[</span><span class="s">"lineStatuses"</span><span class="p">]</span><span class="o">!!</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!</span><span class="p">[</span><span class="s">"statusSeverityDescription"</span><span class="p">]</span> <span class="k">as!</span> <span class="kt">String</span>
    <span class="kt">LineColour</span> <span class="o">=</span> <span class="kt">RGB</span><span class="p">(</span><span class="kt">R</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">G</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">B</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>JSON parsing is a bit nasy because of unwrapping the optionals. I’ll look into SwiftyJSON later on which is a popular JSON library for Swift.</p>

<p>Finally the controller displays the results:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">viewWillAppear</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewWillAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
    
    <span class="kt">TFLClient</span><span class="o">.</span><span class="nf">sharedInstance</span><span class="p">()</span><span class="o">.</span><span class="n">getTubeStatus</span> <span class="p">{</span> <span class="n">lineStatus</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        
        <span class="k">if</span> <span class="k">let</span> <span class="nv">lineStatus</span> <span class="o">=</span> <span class="n">lineStatus</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">lineInfoList</span> <span class="o">=</span> <span class="n">lineStatus</span>
            <span class="nf">dispatch_async</span><span class="p">(</span><span class="nf">dispatch_get_main_queue</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">tableView</span><span class="o">!.</span><span class="nf">reloadData</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And the custom cells are created when data is loaded and the text and colours are set:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">cellForRowAtIndexPath</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">NSIndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">cell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCellWithIdentifier</span><span class="p">(</span><span class="s">"TubeInfoCell"</span><span class="p">,</span> <span class="nv">forIndexPath</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span> <span class="k">as!</span> <span class="kt">TubeInfoTableViewCell</span>
    <span class="k">let</span> <span class="nv">lineStatus</span> <span class="o">=</span> <span class="n">lineInfoList</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">]</span>
    
    <span class="n">cell</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="n">colourHelper</span><span class="o">.</span><span class="nf">getTubeColor</span><span class="p">(</span><span class="n">lineStatus</span><span class="o">.</span><span class="kt">Id</span><span class="p">)</span>
    
    <span class="n">cell</span><span class="o">.</span><span class="n">lineName</span><span class="p">?</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">lineStatus</span><span class="o">.</span><span class="kt">Name</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">lineName</span><span class="p">?</span><span class="o">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="nf">whiteColor</span><span class="p">()</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">severityDescription</span><span class="p">?</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">lineStatus</span><span class="o">.</span><span class="kt">StatusSeverityDescription</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">severityDescription</span><span class="p">?</span><span class="o">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="nf">whiteColor</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">cell</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And here’s the output:</p>

<p><img src="/images/vpblogimg/2015/11/playing-with-tfl-api-swift-output.png" alt=""></p>

<h2 id="xamarin-vs-swift">Xamarin vs Swift</h2>

<p>Here’s a quick overview and comparison of both platforms based on my (limited) experiences with this toy project:</p>

<ul>
  <li>XCode is much faster when building and deploying</li>
  <li>XamarinStudio doesn’t seem to be very intuitive at times. For examples the code snippets use Java-notation</li>
  <li>
    <p>The more I use Swift the more I like it and it doesn’t slow me down terribly. Once you get used to it the difference is syntax more or less. For example the following two methods do the same thing:</p>

    <p>Xamarin:</p>

    <div class="language-csharp highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">public</span> <span class="k">override</span> <span class="n">nint</span> <span class="nf">RowsInSection</span> <span class="p">(</span><span class="n">UITableView</span> <span class="n">tableview</span><span class="p">,</span> <span class="n">nint</span> <span class="n">section</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">return</span> <span class="n">lineInfoList</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div>    </div>

    <p>Swift:</p>

    <div class="language-swift highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">override</span> <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span> <span class="n">numberOfRowsInSection</span> <span class="nv">section</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">lineInfoList</span><span class="o">.</span><span class="n">count</span>
      <span class="p">}</span>
</code></pre></div>    </div>

    <p>I can even argue I’d be more comfortable with the Swift version here as I have no idea what a “nint” is as it’s an input parameter in the Xamarin version.</p>
  </li>
  <li>The idea behind Xamarin subscription was to develop iOS apps quickly as I’m a seasoned C# developer and feel comfortable with it. But turns it, I can’t move as fast as I expected. With the Indie subscription you can only use Xamarin Studio. Enabling Visual Studio is only allowed with the business version which costs $1000/year. And Xamarin Studio is a brand new IDE for me so it definitely has a learning curve. Also I’m getting used to XCode now (besides the fact that it crashes hundred times a day on average!)</li>
</ul>

<h2 id="conclusion">Conclusion</h2>
<p>This was just a reconnaisance mission to explore the TFL API, iOS development with Xamarin and Swift. It was a fun exercise for me, I hope anyone who reads this can benefit from it too.</p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://github.com/volkanpaksoy/tube-status-fetcher" target="_blank" rel="noopener noreferrer">TubeStatusFetcher source code</a></li>
  <li><a href="https://api-portal.tfl.gov.uk/docs" target="_blank" rel="noopener noreferrer">TFL API Docs</a></li>
  <li><a href="http://content.tfl.gov.uk/tfl-colour-standard.pdf" target="_blank" rel="noopener noreferrer">TFL Colour Standards</a></li>
</ul>

</div>

</article>

<div id="page-navigation"> 
        <div class="previous"> 
         
                <a href="/archive/2015/11/11/building-a-simple-http-server-with-nancy/" title="Previous Post: 
Building a simple HTTP server with Nancy">« Building a simple HTTP server with Nancy</a>
         
        </div>

        <div class="next"> 
         
               <a href="/archive/2015/11/19/diy-pdf-viewer/" title="next Post: 
A DIY PDF Reader">A DIY PDF Reader » </a> 
         
        </div>
</div> 


</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright © 2022 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>

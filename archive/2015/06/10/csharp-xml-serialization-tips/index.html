<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>C# XML Serialization Tips - Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/archive/2015/06/10/csharp-xml-serialization-tips/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996"
  crossorigin="anonymous"></script>

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-35583486-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@volkan_paksoy">
  <meta name="twitter:creator" content="@Volkan Paksoy">
  <meta name="twitter:title"   content="C# XML Serialization Tips">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary">
  <meta name="twitter:image" content=""> -->
  
  <!-- end of Twitter cards -->


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
<br>
<br>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
<!-- vp.com - default -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5266062674794996" data-ad-slot="6750480330" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">C# XML Serialization Tips</h1>
	<div class="meta">
	<span class="date">




<time datetime="2015-06-10T14:00:00+01:00" itemprop="datePublished">June 10, 2015</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/"></a></span> -->

<!-- dev -->




    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">xml, csharp</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
<p>Even though it’s a noisy data format it’s still commonly used and I happen to end up in situations that I need to use .NET to serialize and deserialize to and from XML documents. Here are a few problems that I had to tackle in the past. All the sample  source code can be found in a <a href="https://github.com/volkanpaksoy/xml-serialization-workout" target="_blank" rel="noopener noreferrer">GitHub repository</a>.</p>

<h2 id="01-skip-serializing-unassigned-values">01. Skip serializing unassigned values</h2>

<p>Let’s assume we have a hypothetical <em>Player</em> class that has a few fields that looks like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Player</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">TotalGoalsScored</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">AverageGoalsPerGame</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">Team</span> <span class="n">Team</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Team</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">YearEstablished</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>So it contains both value and reference fields.</p>

<p>Now let’s create two random players and serialize them:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">XmlSerializer</span> <span class="n">serializer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlSerializer</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Player</span><span class="p">&gt;));</span>
<span class="n">Player</span> <span class="n">player1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Player</span><span class="p">()</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"John"</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Smith"</span><span class="p">,</span> <span class="n">TotalGoalsScored</span> <span class="p">=</span> <span class="m">50</span><span class="p">,</span> <span class="n">AverageGoalsPerGame</span> <span class="p">=</span> <span class="m">0.7</span><span class="p">,</span> <span class="n">Team</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Team</span><span class="p">()</span> <span class="p">{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Arsenal"</span> <span class="p">}</span> <span class="p">};</span>
<span class="n">Player</span> <span class="n">player2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Player</span><span class="p">()</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Jack"</span> <span class="p">};</span>
<span class="k">using</span> <span class="p">(</span><span class="n">StringWriter</span> <span class="n">writer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringWriter</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Player</span><span class="p">&gt;()</span> <span class="p">{</span> <span class="n">player1</span><span class="p">,</span> <span class="n">player2</span> <span class="p">});</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">writer</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This code yields the following XML:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-16"?&gt;</span>
<span class="nt">&lt;ArrayOfPlayer</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xsd=</span><span class="s">"
http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Player&gt;</span>
    <span class="nt">&lt;Id&gt;</span>1<span class="nt">&lt;/Id&gt;</span>
    <span class="nt">&lt;FirstName&gt;</span>John<span class="nt">&lt;/FirstName&gt;</span>
    <span class="nt">&lt;LastName&gt;</span>Smith<span class="nt">&lt;/LastName&gt;</span>
    <span class="nt">&lt;TotalGoalsScored&gt;</span>50<span class="nt">&lt;/TotalGoalsScored&gt;</span>
    <span class="nt">&lt;AverageGoalsPerGame&gt;</span>0.7<span class="nt">&lt;/AverageGoalsPerGame&gt;</span>
    <span class="nt">&lt;Team&gt;</span>
      <span class="nt">&lt;Name&gt;</span>Arsenal<span class="nt">&lt;/Name&gt;</span>
      <span class="nt">&lt;YearEstablished&gt;</span>0<span class="nt">&lt;/YearEstablished&gt;</span>
    <span class="nt">&lt;/Team&gt;</span>
  <span class="nt">&lt;/Player&gt;</span>
  <span class="nt">&lt;Player&gt;</span>
    <span class="nt">&lt;Id&gt;</span>2<span class="nt">&lt;/Id&gt;</span>
    <span class="nt">&lt;FirstName&gt;</span>Jack<span class="nt">&lt;/FirstName&gt;</span>
    <span class="nt">&lt;TotalGoalsScored&gt;</span>0<span class="nt">&lt;/TotalGoalsScored&gt;</span>
    <span class="nt">&lt;AverageGoalsPerGame&gt;</span>0<span class="nt">&lt;/AverageGoalsPerGame&gt;</span>
  <span class="nt">&lt;/Player&gt;</span>
<span class="nt">&lt;/ArrayOfPlayer&gt;</span>
</code></pre></div></div>

<p>The thing to note here is that reference types were not serialized when they were unassigned, i.e <em>Team</em> object and <em>LastName</em> field in <em>Player2</em>. But same didn’t go for values fields. <em>TotalScore</em>, <em>AverageScorePerGame</em> and <em>YearEstablished</em> fields were serialized as 0. Of course this might be the desired outcome depending on your business requirements but in my case I didn’t want this because it might mislead the client consuming this data. At the very least I find it inconsistent as some unassigned values are serialized and some aren’t.</p>

<p>So to change the behaviour all we have to do is set the <strong><em>DefaultValue</em></strong> attribute for the numeric values like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Player</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DefaultValue</span><span class="p">(</span><span class="m">0</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">TotalGoalsScored</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DefaultValue</span><span class="p">(</span><span class="m">0</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">AverageGoalsPerGame</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    
    <span class="k">public</span> <span class="n">Team</span> <span class="n">Team</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Team</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DefaultValue</span><span class="p">(</span><span class="m">0</span><span class="p">)]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">YearEstablished</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With this change the output becomes:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-16"?&gt;</span>
<span class="nt">&lt;ArrayOfPlayer</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xsd=</span><span class="s">"
http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Player&gt;</span>
    <span class="nt">&lt;Id&gt;</span>1<span class="nt">&lt;/Id&gt;</span>
    <span class="nt">&lt;FirstName&gt;</span>John<span class="nt">&lt;/FirstName&gt;</span>
    <span class="nt">&lt;LastName&gt;</span>Smith<span class="nt">&lt;/LastName&gt;</span>
    <span class="nt">&lt;TotalGoalsScored&gt;</span>50<span class="nt">&lt;/TotalGoalsScored&gt;</span>
    <span class="nt">&lt;AverageGoalsPerGame&gt;</span>0.7<span class="nt">&lt;/AverageGoalsPerGame&gt;</span>
    <span class="nt">&lt;Team&gt;</span>
      <span class="nt">&lt;Name&gt;</span>Arsenal<span class="nt">&lt;/Name&gt;</span>
    <span class="nt">&lt;/Team&gt;</span>
  <span class="nt">&lt;/Player&gt;</span>
  <span class="nt">&lt;Player&gt;</span>
    <span class="nt">&lt;Id&gt;</span>2<span class="nt">&lt;/Id&gt;</span>
    <span class="nt">&lt;FirstName&gt;</span>Jack<span class="nt">&lt;/FirstName&gt;</span>
  <span class="nt">&lt;/Player&gt;</span>
<span class="nt">&lt;/ArrayOfPlayer&gt;</span>
</code></pre></div></div>

<p>So as the <em>int</em> and <em>double</em> values defaulted to 0 and we explicitly set the default value they won’t be serialized unless they are assigned a value other than zero.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5266062674794996" data-ad-slot="9650311114"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>In case you are wondering making the <em>int</em> and <em>double</em> nullable doesn’t produce the same result. In that case they are serialized with null values:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;TotalScore</span> <span class="na">xsi:nil=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;AverageScorePerGame</span> <span class="na">xsi:nil=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>I think this if-you-set-it-you-get-it-back approach is consistent and makes most sense to me. I created a test project to fiddle with these classes. It has all 3 versions of the classes under different names and a console application displaying the outputs. If you want to play around you can get the source code <a href="github...">here</a></p>

<h2 id="02-deserialize-straight-to-list">02. Deserialize straight to list</h2>

<p>Sometimes what you get in an XML document is just a list of items and the list is just a container so that the XML is well-formed. For example in the following example we have a list of players:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;PlayerList&gt;</span>
  <span class="nt">&lt;Player&gt;</span>
    <span class="nt">&lt;Id&gt;</span>1<span class="nt">&lt;/Id&gt;</span>
    <span class="nt">&lt;FirstName&gt;</span>John<span class="nt">&lt;/FirstName&gt;</span>
    <span class="nt">&lt;LastName&gt;</span>Smith<span class="nt">&lt;/LastName&gt;</span>
    <span class="nt">&lt;TotalGoalsScored&gt;</span>50<span class="nt">&lt;/TotalGoalsScored&gt;</span>
    <span class="nt">&lt;AverageGoalsPerGame&gt;</span>0.7<span class="nt">&lt;/AverageGoalsPerGame&gt;</span>
    <span class="nt">&lt;Team&gt;</span>
      <span class="nt">&lt;Name&gt;</span>Arsenal<span class="nt">&lt;/Name&gt;</span>
      <span class="nt">&lt;YearEstablished&gt;</span>0<span class="nt">&lt;/YearEstablished&gt;</span>
    <span class="nt">&lt;/Team&gt;</span>
  <span class="nt">&lt;/Player&gt;</span>
  <span class="nt">&lt;Player&gt;</span>
    <span class="nt">&lt;Id&gt;</span>2<span class="nt">&lt;/Id&gt;</span>
    <span class="nt">&lt;FirstName&gt;</span>Jack<span class="nt">&lt;/FirstName&gt;</span>
    <span class="nt">&lt;TotalGoalsScored&gt;</span>0<span class="nt">&lt;/TotalGoalsScored&gt;</span>
    <span class="nt">&lt;AverageGoalsPerGame&gt;</span>0<span class="nt">&lt;/AverageGoalsPerGame&gt;</span>
  <span class="nt">&lt;/Player&gt;</span>
<span class="nt">&lt;/PlayerList&gt;</span>
</code></pre></div></div>

<p>The sole purpose of PlayerList tag is to act as root and contain multiple objects. Other than that it has no function. When we deserialize this to C# objects we would  normally need 2 objects like this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Player</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">TotalGoalsScored</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">AverageGoalsPerGame</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>and</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">XmlRoot</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">PlayerList</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">XmlElement</span><span class="p">(</span><span class="s">"Player"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Player</span><span class="p">&gt;</span> <span class="n">Players</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>and we can get the list of objects by:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>string inputXmlPath1 = @".\InputXml.xml";
using (StreamReader reader = new StreamReader(inputXmlPath1))
{
    XmlSerializer playerListSerializer = new XmlSerializer(typeof(PlayerList));
    PlayerList playerList = (PlayerList)playerListSerializer.Deserialize(reader);
}
</code></pre></div></div>

<p>In such cases I generally tend to eliminate the “middle man”. I don’t want a container class which only holds a List. So I’d like to deserialize this XML directly into List<player>.</player></p>

<p>What I want to do is actually this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="p">(</span><span class="n">StreamReader</span> <span class="n">reader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">inputXmlPath1</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">XmlSerializer</span> <span class="n">playerListSerializer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlSerializer</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">FinalPlayer</span><span class="p">&gt;));</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="n">FinalPlayer</span><span class="p">&gt;</span> <span class="n">playerList</span> <span class="p">=</span> <span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">FinalPlayer</span><span class="p">&gt;)</span><span class="n">playerListSerializer</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">reader</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>But without any modifications to our classes it throws an exception:</p>

<p><img src="/images/vpblogimg/2015/06/xml-serialization-exception-01.png" alt=""></p>

<p>By eliminating PlayerList class we actually stopped providing XmlRoot info to the serializer. But that can quickly be remedied by using a constructor overload of XmlSerializer:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="p">(</span><span class="n">StreamReader</span> <span class="n">reader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">inputXmlPath1</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">XmlSerializer</span> <span class="n">playerListSerializer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlSerializer</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">FinalPlayer</span><span class="p">&gt;),</span> <span class="k">new</span> <span class="nf">XmlRootAttribute</span><span class="p">(</span><span class="s">"PlayerList"</span><span class="p">));</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="n">FinalPlayer</span><span class="p">&gt;</span> <span class="n">playerList</span> <span class="p">=</span> <span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">FinalPlayer</span><span class="p">&gt;)</span><span class="n">playerListSerializer</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">reader</span><span class="p">);</span>
<span class="p">}</span>     
</code></pre></div></div>

<p>This works when the class name matches the <em>XmlElement</em> name. If you need to customize your class’s name (like <em>FinalPlayer</em> in my example) you need to decorate the class with <em>XmlType</em> and supply the element name so that the serializer can do the mapping.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">XmlType</span><span class="p">(</span><span class="s">"Player"</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">FinalPlayer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">TotalGoalsScored</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">AverageGoalsPerGame</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>So now we can have any class name mapping to corresponding elements and deserialized straight to a List.</p>

<h2 id="03-remove-namespaces">03. Remove namespaces</h2>

<p>I know using namespaces is considered a good practice as it helps avoid name conflicts but honestly I never suffered from such a problem before so I don’t mind removing them from my XML documents and clean the clutter. XML is already a noisy data format no need to bloat it any further. I think it might help when you are working with data from different sources but if you are only working with your own classes and data structures name conflict is generally not something to worry about (assuming you name your objects properly)</p>

<p>So say you have a simple Player class and you serialize it with a out-of-the-box XmlSerializer:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Player</span> <span class="n">player</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Player</span><span class="p">()</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">102</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Danny"</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"TopScorer"</span><span class="p">,</span> <span class="n">AverageGoalsPerGame</span> <span class="p">=</span> <span class="m">3.5</span><span class="p">,</span> <span class="n">TotalGoalsScored</span> <span class="p">=</span> <span class="m">150</span> <span class="p">};</span>
<span class="n">XmlSerializer</span> <span class="n">serializer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlSerializer</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Player</span><span class="p">));</span>
<span class="n">XmlWriterSettings</span> <span class="n">settings</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlWriterSettings</span><span class="p">()</span> <span class="p">{</span> <span class="n">OmitXmlDeclaration</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">Indent</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">Encoding</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span> <span class="p">};</span>
<span class="n">StringBuilder</span> <span class="n">output</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
<span class="n">XmlWriter</span> <span class="n">writer</span> <span class="p">=</span> <span class="n">XmlWriter</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">settings</span><span class="p">);</span>
<span class="n">serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">player</span><span class="p">);</span>
<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
</code></pre></div></div>

<p>This yields the following output:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Player</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xsd=</span><span class="s">"http://
www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Id&gt;</span>102<span class="nt">&lt;/Id&gt;</span>
  <span class="nt">&lt;FirstName&gt;</span>Danny<span class="nt">&lt;/FirstName&gt;</span>
  <span class="nt">&lt;LastName&gt;</span>TopScorer<span class="nt">&lt;/LastName&gt;</span>
  <span class="nt">&lt;TotalGoalsScored&gt;</span>150<span class="nt">&lt;/TotalGoalsScored&gt;</span>
  <span class="nt">&lt;AverageGoalsPerGame&gt;</span>3.5<span class="nt">&lt;/AverageGoalsPerGame&gt;</span>
<span class="nt">&lt;/Player&gt;</span>
</code></pre></div></div>

<p>So in order to get rid of namespaces we have to specify our custom namespaces, which is empty in this case and use the overloaded XmlSerializer constructor to pass it in:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">XmlSerializerNamespaces</span> <span class="n">xns</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlSerializerNamespaces</span><span class="p">();</span>
<span class="n">xns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">,</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
<span class="n">serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">xns</span><span class="p">);</span>
</code></pre></div></div>

<p>to get the XML without any namespaces:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Player&gt;</span>
  <span class="nt">&lt;Id&gt;</span>102<span class="nt">&lt;/Id&gt;</span>
  <span class="nt">&lt;FirstName&gt;</span>Danny<span class="nt">&lt;/FirstName&gt;</span>
  <span class="nt">&lt;LastName&gt;</span>TopScorer<span class="nt">&lt;/LastName&gt;</span>
  <span class="nt">&lt;TotalGoalsScored&gt;</span>150<span class="nt">&lt;/TotalGoalsScored&gt;</span>
  <span class="nt">&lt;AverageGoalsPerGame&gt;</span>3.5<span class="nt">&lt;/AverageGoalsPerGame&gt;</span>
<span class="nt">&lt;/Player&gt;</span>
</code></pre></div></div>

<h2 id="04-change-output-encoding">04. Change output encoding</h2>

<p>When you serialize with the default options and with the XML declaration the encoding is UTF-16. Oddly enough there is no option to specify the output encoding. In order to achieve that and sometimes you may need to change it. For example a 3rd party was expecting UTF-8 in my case so the default value didn’t cut it for me.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-5266062674794996" data-ad-slot="9650311114"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>So using the same Player class from the last example the following code produces an output with UTF-16</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Player</span> <span class="n">player</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Player</span><span class="p">()</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">102</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Danny"</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"TopScorer"</span><span class="p">,</span> <span class="n">AverageGoalsPerGame</span> <span class="p">=</span> <span class="m">3.5</span><span class="p">,</span> <span class="n">TotalGoalsScored</span> <span class="p">=</span> <span class="m">150</span> <span class="p">};</span>
<span class="n">XmlSerializer</span> <span class="n">serializer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlSerializer</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Player</span><span class="p">));</span>
<span class="n">XmlWriterSettings</span> <span class="n">settings</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlWriterSettings</span><span class="p">()</span> <span class="p">{</span> <span class="n">OmitXmlDeclaration</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="n">Indent</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">Encoding</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span> <span class="p">};</span>
<span class="n">StringBuilder</span> <span class="n">output</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
<span class="n">XmlWriter</span> <span class="n">writer</span> <span class="p">=</span> <span class="n">XmlWriter</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">settings</span><span class="p">);</span>
<span class="n">XmlSerializerNamespaces</span> <span class="n">xns</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlSerializerNamespaces</span><span class="p">();</span>
<span class="n">xns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">,</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
<span class="n">serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">xns</span><span class="p">);</span>
<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
</code></pre></div></div>

<p>Output:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-16"?&gt;</span>
<span class="nt">&lt;Player&gt;</span>
  <span class="nt">&lt;Id&gt;</span>102<span class="nt">&lt;/Id&gt;</span>
  <span class="nt">&lt;FirstName&gt;</span>Danny<span class="nt">&lt;/FirstName&gt;</span>
  <span class="nt">&lt;LastName&gt;</span>TopScorer<span class="nt">&lt;/LastName&gt;</span>
  <span class="nt">&lt;TotalGoalsScored&gt;</span>150<span class="nt">&lt;/TotalGoalsScored&gt;</span>
  <span class="nt">&lt;AverageGoalsPerGame&gt;</span>3.5<span class="nt">&lt;/AverageGoalsPerGame&gt;</span>
<span class="nt">&lt;/Player&gt;</span>
</code></pre></div></div>

<p>I found the solution <a href="http://stackoverflow.com/questions/427725/how-to-put-an-encoding-attribute-to-xml-other-that-utf-16-with-xmlwriter/427737#427737" target="_blank" rel="noopener noreferrer">here</a> on StackOverflow.</p>

<p>So the solution is to extend from StringWriter and add a new constructor that accepts Encoding. StringWriter already has an Encoding property as shown below, but unfortunately it doesn’t have a public setter so we need a subclass to fiddle with it.</p>

<p><img src="/images/vpblogimg/2015/06/dotnet-stringwriter-encoding.png" alt=""></p>

<p>StringWriterWithEncoding simply overrides th encoding field:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">StringWriterWithEncoding</span> <span class="p">:</span> <span class="n">StringWriter</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Encoding</span> <span class="n">encoding</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">StringWriterWithEncoding</span><span class="p">(</span><span class="n">Encoding</span> <span class="n">encoding</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">encoding</span> <span class="p">=</span> <span class="n">encoding</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="n">Encoding</span> <span class="n">Encoding</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">encoding</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>By using the new class the following code produces the desired outcome:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">StringWriterWithEncoding</span> <span class="n">utf8StringWriter</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringWriterWithEncoding</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">);</span>
<span class="n">Player</span> <span class="n">player</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Player</span><span class="p">()</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">102</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Danny"</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"TopScorer"</span><span class="p">,</span> <span class="n">AverageGoalsPerGame</span> <span class="p">=</span> <span class="m">3.5</span><span class="p">,</span> <span class="n">TotalGoalsScored</span> <span class="p">=</span> <span class="m">150</span> <span class="p">};</span>
<span class="n">XmlSerializer</span> <span class="n">serializer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlSerializer</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Player</span><span class="p">));</span>
<span class="n">XmlWriterSettings</span> <span class="n">settings</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlWriterSettings</span><span class="p">()</span> <span class="p">{</span> <span class="n">OmitXmlDeclaration</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="n">Indent</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">Encoding</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span> <span class="p">};</span>
<span class="n">XmlWriter</span> <span class="n">writer</span> <span class="p">=</span> <span class="n">XmlWriter</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">utf8StringWriter</span><span class="p">,</span> <span class="n">settings</span><span class="p">);</span>
<span class="n">XmlSerializerNamespaces</span> <span class="n">xns</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlSerializerNamespaces</span><span class="p">();</span>
<span class="n">xns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">,</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
<span class="n">serializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">xns</span><span class="p">);</span>
<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">utf8StringWriter</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
<span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
</code></pre></div></div>

<p>Output:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;Player&gt;</span>
  <span class="nt">&lt;Id&gt;</span>102<span class="nt">&lt;/Id&gt;</span>
  <span class="nt">&lt;FirstName&gt;</span>Danny<span class="nt">&lt;/FirstName&gt;</span>
  <span class="nt">&lt;LastName&gt;</span>TopScorer<span class="nt">&lt;/LastName&gt;</span>
  <span class="nt">&lt;TotalGoalsScored&gt;</span>150<span class="nt">&lt;/TotalGoalsScored&gt;</span>
  <span class="nt">&lt;AverageGoalsPerGame&gt;</span>3.5<span class="nt">&lt;/AverageGoalsPerGame&gt;</span>
<span class="nt">&lt;/Player&gt;</span>
</code></pre></div></div>

<h2 id="05-fail-deserialization-when-unexpected-elements-are-encountered">05. Fail deserialization when unexpected elements are encountered</h2>

<p>By default XMLSerializer is very fault tolerant. It just salvages whatever it can and leaves alone the unmatching values. Sometimes you may need to be stricter. For example I had a case when the external source returned a whole different XML when there was an error on its end. So when that happened I wanted to be notified about it instead of getting null objects quietly.</p>

<p>For example, assume we have the usual PlayerList that we are deserializing to List<player>. If for some reason we get a weird Player list like this:</player></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;PlayerList&gt;</span>
  <span class="nt">&lt;Customer&gt;</span>
    <span class="nt">&lt;Id&gt;</span>1<span class="nt">&lt;/Id&gt;</span>
    <span class="nt">&lt;FirstName&gt;</span>John<span class="nt">&lt;/FirstName&gt;</span>
    <span class="nt">&lt;LastName&gt;</span>Smith<span class="nt">&lt;/LastName&gt;</span>
    <span class="nt">&lt;TotalGoalsScored&gt;</span>50<span class="nt">&lt;/TotalGoalsScored&gt;</span>
    <span class="nt">&lt;AverageGoalsPerGame&gt;</span>0.7<span class="nt">&lt;/AverageGoalsPerGame&gt;</span>
  <span class="nt">&lt;/Customer&gt;</span>
<span class="nt">&lt;/PlayerList&gt;</span>
</code></pre></div></div>

<p>When we deserialize it with the following code block</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">MemoryStream</span> <span class="n">memoryStream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MemoryStream</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">rawXml</span><span class="p">)))</span>
    <span class="p">{</span>
        <span class="n">XmlSerializer</span> <span class="n">serializer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlSerializer</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Player</span><span class="p">&gt;),</span> <span class="k">new</span> <span class="nf">XmlRootAttribute</span><span class="p">(</span><span class="s">"PlayerList"</span><span class="p">));</span>
        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Player</span><span class="p">&gt;)</span><span class="n">serializer</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">memoryStream</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">InnerException</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">InnerException</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>    
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>XmlSerializer doesn’t complain at all. Instead it just returns an empty list because it cannot find any Player objects. In order to change this behaviour we can use the events it exposes such as UnknownNode, UnknownElement, UnknownAttribute. UnknownNode is just the combination of the first two events. In my case I didn’t want to be too strict so I didn’t want an exception in case of a missing attribute but hooked into the UnknownElement event:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">MemoryStream</span> <span class="n">memoryStream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MemoryStream</span><span class="p">(</span><span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">rawXml</span><span class="p">)))</span>
    <span class="p">{</span>
        <span class="n">XmlSerializer</span> <span class="n">serializer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlSerializer</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Player</span><span class="p">&gt;),</span> <span class="k">new</span> <span class="nf">XmlRootAttribute</span><span class="p">(</span><span class="s">"PlayerList"</span><span class="p">));</span>
        <span class="n">serializer</span><span class="p">.</span><span class="n">UnknownElement</span> <span class="p">+=</span> <span class="n">serializer_UnknownElement</span><span class="p">;</span>
        <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Player</span><span class="p">&gt;)</span><span class="n">serializer</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">memoryStream</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">InnerException</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">InnerException</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>and added the event handler:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">void</span> <span class="nf">serializer_UnknownElement</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">XmlElementEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"Unknown element: {0}"</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">Element</span><span class="p">.</span><span class="n">LocalName</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>So now at least I can distinguish a weird list from a really empty list.</p>

<p><img src="/images/vpblogimg/2015/06/unknown-node-exception.png" alt=""></p>

<h2 id="resources">Resources</h2>
<ul>
  <li><a href="https://github.com/volkanpaksoy/xml-serialization-workout" target="_blank" rel="noopener noreferrer">Github repository for sample applications</a></li>
  <li><a href="https://msdn.microsoft.com/en-us/library/system.componentmodel.defaultvalueattribute(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">MSDN Article: DefaultValueAttribute</a></li>
  <li><a href="http://stackoverflow.com/questions/427725/how-to-put-an-encoding-attribute-to-xml-other-that-utf-16-with-xmlwriter/427737#427737" target="_blank" rel="noopener noreferrer">StackOverflow answer for changing output encoding</a></li>
</ul>
</div>

</article>

<div id="page-navigation"> 
        <div class="previous"> 
         
                <a href="/archive/2015/05/11/debugging-bindingfailure-exception/" title="Previous Post: 
Debugging a BindingFailure Exception in Visual Studio">« Debugging a BindingFailure Exception in Visual Studio</a>
         
        </div>

        <div class="next"> 
         
               <a href="/archive/2015/07/11/rss-feed-generation-with-csharp/" title="next Post: 
RSS Feed Generation with C#">RSS Feed Generation with C# » </a> 
         
        </div>
</div> 


</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright © 2022 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>

<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Study Notes for 70-461: Querying Microsoft SQL Server 2012 – Part 2 - Playground for the mind</title>
	<meta name="author" content="Volkan Paksoy">

	
	<meta name="description" content="
		
	">
	

	<!-- http://t.co/dKP3o1e -->
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="https://feeds.feedburner.com/PlaygroundForTheMind" rel="alternate" title="Playground for the mind" type="application/atom+xml">
	
	<link rel="canonical" href="https://volkanpaksoy.com/archive/2013/07/07/study-notes-for-70-461-querying-microsoft-sql-server-2012-part-2/">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,400italic,600,700,800' rel='stylesheet' type='text/css'>
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="/css/code.css" type="text/css">
  <link rel="stylesheet" href="/css/w3.css" type="text/css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="/js/slash.js" async></script>
	<script src="/js/GithubRepoWidget.min.js" async></script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996"
  crossorigin="anonymous"></script>

  

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y3V7V2XX9Q"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y3V7V2XX9Q');
</script>

<!-- <script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'G-Y3V7V2XX9Q']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script> -->



  <!-- Twitter cards -->
  <meta name="twitter:site"    content="@volkan_paksoy">
  <meta name="twitter:creator" content="@Volkan Paksoy">
  <meta name="twitter:title"   content="Study Notes for 70-461: Querying Microsoft SQL Server 2012 – Part 2">

  
  <meta name="twitter:description" content="">
  

  
  <meta name="twitter:card"  content="summary">
  <meta name="twitter:image" content=""> -->
  
  <!-- end of Twitter cards -->


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner"><div class="profilepic">
	
	<a href="/">
		<img src="https://s.gravatar.com/avatar/760bf518408c38ebb0f0e5adb8089e30?s=80?s=160" alt="Profile Picture" style="width: 160px;">
	</a>	
	
</div>
<hgroup>
  <h1 class="site-title" style="font-size: 2.4em;">
		<a style="color: rgba(255, 165, 0, 0.8);" href="/">Playground for the mind</a>
	</h1>
  
    <h2>It's all about the journey, not the destination</h2>
  
</hgroup>

<nav id="sub-nav">
	<div class="social">
		
			<a class="rss" href="https://feeds.feedburner.com/PlaygroundForTheMind" title="RSS" target="_blank" rel="noopener noreferrer">RSS</a>
		
		
			<a class="github" href="https://github.com/volkanpaksoy" title="GitHub" target="_blank" rel="noopener noreferrer">GitHub</a>
		
		
			<a class="stackoverflow" href="https://stackoverflow.com/users/3093396/volkan-paksoy" title="StackOverflow" target="_blank" rel="noopener noreferrer">StackOverflow</a>
		
	</div>
</nav>

<nav id="main-nav">
<ul class="main-navigation">
  <li><a href="/archive">posts</a></li>
  <li><a href="/category">categories</a></li>
</ul>
<br>
<br>

<!-- <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="volkanpaksoy" data-color="#005050" data-emoji=""  data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#ffffff" data-font-color="#ffffff" data-coffee-color="#FFDD00" ></script> -->

<a href="https://www.buymeacoffee.com/volkanpaksoy" target="_blank" rel="noopener noreferrer"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-green.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a>

<div id="ezoic-pub-ad-placeholder-102">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
<!-- ezoic-00 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5266062674794996" data-ad-slot="4902272427" data-ad-format="auto"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

</nav></header>				
			</div>
		</div>
		<div class="mid-col">
			<div class="mid-col-container">
				<div id="content" class="inner">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Study Notes for 70-461: Querying Microsoft SQL Server 2012 – Part 2</h1>
	<div class="meta">
	<span class="date">




<time datetime="2013-07-07T18:46:51+01:00" itemprop="datePublished">July  7, 2013</time></span>
	<span class="categories"><!-- <span class="category-link"><a href="/category/"></a></span> -->

<!-- dev -->




    <a href="/category/dev">dev</a>
    
</span>
	<span class="tags">certification, sql_server</span>
	
</div>
	<div class="entry-content" itemprop="articleBody">
<p>This the Part 2 of my Study notes for 70-461 exam. You can find the Part 1 <a href="https://volkanpaksoy.com/archive/2013/07/06/study-notes-for-70-461-querying-microsoft-sql-server-2012/">here</a></p>

<h3 id="04-aggregate-functions">04. Aggregate Functions</h3>

<ol>
  <li>
    <p>GROUPING SETS
 Using GROUPING SETS operator returns the same result set generated by using a GROUP BY, ROLLUP and CUBE operator. For example, this query generates the following result set:</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> SELECT o.TerritoryID, YEAR(OrderDate) AS SaleYear, SUM(SubTotal) AS Total
 FROM Sales.SalesOrderHeader o
 GROUP BY GROUPING SETS ((), o.TerritoryID, YEAR(OrderDate))
 ORDER BY SaleYear ASC, o.TerritoryID ASC, Total ASC
</code></pre></div>    </div>

    <p>Output:
 <img src="/images/vpblogimg/2013/07/QueryOutput03.png" alt="Query Output"></p>

    <p>Source: <a href="http://technet.microsoft.com/en-us/library/bb522495(v=sql.105).aspx" target="_blank" rel="noopener noreferrer">http://technet.microsoft.com/en-us/library/bb522495(v=sql.105).aspx</a></p>
  </li>
  <li>
    <p>RANK / DENSE_RANK / NTILE / ROW_NUMBER
 These functions may be quite helpful for reporting queries.</p>

    <p>RANK – DENSE_RANK: These functions help to order rows by assigning an incrementing number based on the criteria used in ORDER BY clause. The difference between them is rank skips the next value when there are two of the same one and dense_rank doesn’t.</p>

    <p><em>Example:</em></p>
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> SELECT o.TerritoryID, YEAR(OrderDate) AS SaleYear, SUM(SubTotal) AS Total,
 RANK() OVER(ORDER BY SUM(SubTotal) DESC) AS Rank
 FROM Sales.SalesOrderHeader o
 GROUP BY o.TerritoryID, YEAR(OrderDate)
 ORDER BY Rank, SaleYear ASC, o.TerritoryID ASC, Total ASC
</code></pre></div>    </div>

    <p><em>Output:</em></p>

    <p><img src="/images/vpblogimg/2013/07/QueryOutput04.png" alt="Query Output"></p>
  </li>
</ol>

<div id="ezoic-pub-ad-placeholder-101">
<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5266062674794996" crossorigin="anonymous"></script>
<!-- ezoic-00 -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5266062674794996" data-ad-slot="4902272427" data-ad-format="auto"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<ol>
  <li>NTILE
 Works like rank but it takes an integer parameter (n) and partitions the results to n-pieces. For example, the query below with NTILE returns 40 rows. As n is 4 in this example, the first 10 rows got rank 1 and 11 – 20 got rank 2 and so forth.
 Example:
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> SELECT o.TerritoryID, YEAR(OrderDate) AS SaleYear, SUM(SubTotal) AS Total,
 NTILE(4) OVER(ORDER BY SUM(SubTotal) DESC) AS Rank
 FROM Sales.SalesOrderHeader o
 GROUP BY o.TerritoryID, YEAR(OrderDate)
 ORDER BY Rank, SaleYear ASC, o.TerritoryID ASC, Total ASC
</code></pre></div>    </div>

    <p><em>Output:</em></p>

    <p><img src="/images/vpblogimg/2013/07/QueryOutput05.png" alt="Query Output"></p>

    <p><em>ROW_NUMBER:</em> Just increments the rank no matter what.
 <em>Example:</em></p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> SELECT o.TerritoryID, YEAR(OrderDate) AS SaleYear, SUM(SubTotal) AS Total,
 ROW_NUMBER() OVER(ORDER BY SUM(SubTotal) DESC) AS Rank
 FROM Sales.SalesOrderHeader o
 GROUP BY o.TerritoryID, YEAR(OrderDate)
 ORDER BY Rank, SaleYear ASC, o.TerritoryID ASC, Total ASC
</code></pre></div>    </div>

    <p><em>Output:</em></p>

    <p><img src="/images/vpblogimg/2013/07/QueryOutput06.png" alt="Query Output"></p>
  </li>
</ol>

<p>Source: <a href="http://msdn.microsoft.com/en-us/library/ms189798.aspx" target="_blank" rel="noopener noreferrer">http://msdn.microsoft.com/en-us/library/ms189798.aspx</a></p>

<h3 id="05-analytic-functions">05. Analytic Functions</h3>
<p>LAG / LEAD: When I first saw these I instantly loved them! They prevent an unnecessary costly self-join to access previous and next rows in a result set.</p>

<p>So for example check out the following query and its output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT o.TerritoryID, YEAR(OrderDate) AS SaleYear, SUM(SubTotal) AS Total,
LAG(SUM(SubTotal)) OVER(ORDER BY YEAR(OrderDate)) AS PrevYear,
LEAD(SUM(SubTotal)) OVER(ORDER BY YEAR(OrderDate))  AS NextYear
FROM Sales.SalesOrderHeader o
WHERE o.TerritoryID = 1
GROUP BY o.TerritoryID, YEAR(OrderDate)
ORDER BY SaleYear ASC, o.TerritoryID ASC, Total ASC
</code></pre></div></div>

<p><em>Output:</em></p>

<p><img src="/images/vpblogimg/2013/07/QueryOutput07.png" alt="Query Output"></p>

<p>Notice that every row has the previous row’s current value in its PrevYear column. Except the first one obviously as it doesn’t have a previous year. And the same logic applies to the NextYear value with the difference that LEAD function is used to obtain those values.</p>

<p>Source: <a href="http://msdn.microsoft.com/en-us/library/hh213234.aspx" target="_blank" rel="noopener noreferrer">http://msdn.microsoft.com/en-us/library/hh213234.aspx</a></p>

<h3 id="06-transaction-tips">06. TRANSACTION TIPS</h3>
<p>One important topic to grasp is transaction isolation levels. I had a few questions related to this topic. Also it is crucial to create high-performance queries.
The isolation levels you need to pay attention are:</p>

<p>READ UNCOMMITTED: This one is most loose one as it allows dirty reads. But much faster than the others as it doesn’t lock the rows.</p>

<p>READ COMMITTED: It doesn’t allow reading uncommitted data. This is the default level.</p>

<p>REPEATABLE READ: Prevents dirty reads. Concurrent operations cannot modify or delete data.</p>

<p>SERIALIZABLE: This level takes it one step further: In  addition to REPEATABLE READ it prevents concurrent operations from inserting data too.</p>

<p>SNAPSHOT: Specifies that data read by any statement in a transaction will be the transactionally consistent version of the data that existed at the start of the transaction.</p>

<p>Source: <a href="http://msdn.microsoft.com/en-us/library/ms173763.aspx" target="_blank" rel="noopener noreferrer">http://msdn.microsoft.com/en-us/library/ms173763.aspx</a></p>
</div>

</article>

<div id="page-navigation"> 
        <div class="previous"> 
         
                <a href="/archive/2013/07/06/study-notes-for-70-461-querying-microsoft-sql-server-2012/" title="Previous Post: 
Study Notes for 70-461: Querying Microsoft SQL Server 2012 – Part 1">« Study Notes for 70-461: Querying Microsoft SQL Server 2012 – Part 1</a>
         
        </div>

        <div class="next"> 
         
               <a href="/archive/2013/07/10/hardening-windows-with-emet/" title="next Post: 
Hardening Windows with EMET">Hardening Windows with EMET » </a> 
         
        </div>
</div> 


</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright © 2022 - Volkan Paksoy Blog content licensed under the Creative Commons <a href="http://creativecommons.org/licenses/by/2.5/" target="_blank" rel="noopener noreferrer">CC BY 2.5</a> | Site design based on the <a href="https://github.com/shashankmehta/greyshade" target="_blank" rel="noopener noreferrer">Greyshade theme</a> under the <a href="http://sm.mit-license.org/" target="_blank" rel="noopener noreferrer">MIT license</a>
</p>
</footer>
		</div>
	</div>
</body>
</html>
